<!DOCTYPE html><html><head><meta charset="utf-8"><title>OpenIddict RC3 is out | Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="OpenIddict RC3 is now available on NuGet.org:OpenIddict – 1.0.0-rc3-final (for ASP.NET Core 1.x)OpenIddict – 2.0.0-rc3-final (for ASP.NET Core 2.x)What&#39;s new in this release?The OpenIddict service"><meta property="og:type" content="article"><meta property="og:title" content="OpenIddict RC3 is out"><meta property="og:url" content="https://kevinchalet.com/2018/06/20/openiddict-rc3-is-out/index.html"><meta property="og:site_name" content="Kévin Chalet&#39;s blog"><meta property="og:description" content="OpenIddict RC3 is now available on NuGet.org:OpenIddict – 1.0.0-rc3-final (for ASP.NET Core 1.x)OpenIddict – 2.0.0-rc3-final (for ASP.NET Core 2.x)What&#39;s new in this release?The OpenIddict service"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://kevinchalet.com/2018/06/20/openiddict-rc3-is-out/main-builder.png"><meta property="og:image" content="https://kevinchalet.com/2018/06/20/openiddict-rc3-is-out/specialized-builders.png"><meta property="og:image" content="https://kevinchalet.com/2018/06/20/openiddict-rc3-is-out/core-builder-entities.png"><meta property="article:published_time" content="2018-06-20T14:00:00.000Z"><meta property="article:modified_time" content="2018-07-04T01:42:43.000Z"><meta property="article:author" content="Kévin Chalet"><meta property="article:tag" content="asp.net core"><meta property="article:tag" content="aspnet-contrib"><meta property="article:tag" content="authentication"><meta property="article:tag" content="jwt"><meta property="article:tag" content="oauth"><meta property="article:tag" content="openid connect"><meta property="article:tag" content="openiddict"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://kevinchalet.com/2018/06/20/openiddict-rc3-is-out/main-builder.png"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="/css/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">38 <span>posts</span></div><div class="article-info-block">29 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-openiddict-rc3-is-out" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">OpenIddict RC3 is out</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2018/06/20/openiddict-rc3-is-out/"><time datetime="2018-06-20T14:00:00.000Z" itemprop="datePublished">2018-06-20</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>OpenIddict RC3 is now available on NuGet.org:</p><ul><li><a href="https://www.nuget.org/packages/OpenIddict/1.0.0-rc3-final" target="_blank" rel="external">OpenIddict – 1.0.0-rc3-final</a> (for ASP.NET Core 1.x)</li><li><a href="https://www.nuget.org/packages/OpenIddict/2.0.0-rc3-final" target="_blank" rel="external">OpenIddict – 2.0.0-rc3-final</a> (for ASP.NET Core 2.x)</li></ul><h2 id="What-39-s-new-in-this-release"><a href="#What-39-s-new-in-this-release" class="headerlink" title="What&#39;s new in this release?"></a>What&#39;s new in this release?</h2><h3 id="The-OpenIddict-services-registration-APIs-have-been-revamped"><a href="#The-OpenIddict-services-registration-APIs-have-been-revamped" class="headerlink" title="The OpenIddict services registration APIs have been revamped"></a>The OpenIddict services registration APIs have been revamped</h3><p>In this release, <strong>we focused on reworking the OpenIddict registration APIs to offer a better user experience</strong>.</p><p>As part of this change, <strong>we split the OpenIddict services into three areas</strong> - <code>Core</code>, <code>Server</code> and <code>Validation</code> - and the <code>IServiceCollection</code> APIs have been updated to reflect that:</p><img src="/2018/06/20/openiddict-rc3-is-out/main-builder.png" alt="main-builder.png"><p>Each specialized builder only exposes the options that are relevant to its specific area:</p><img src="/2018/06/20/openiddict-rc3-is-out/specialized-builders.png" alt="specialized-builders.png"><p>Of course, the calls to <code>AddCore()</code>, <code>AddServer()</code> and <code>AddValidation()</code> can be chained:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict core services.</span></div><div class="line">    .AddCore(options =&gt;</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Register the Entity Framework stores and models.</span></div><div class="line">        options.UseEntityFrameworkCore()</div><div class="line">               .UseDbContext&lt;ApplicationDbContext&gt;();</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict server handler.</span></div><div class="line">    .AddServer(options =&gt;</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Register the ASP.NET Core MVC binder used by OpenIddict.</span></div><div class="line">        <span class="comment">// Note: if you don't call this method, you won't be able to</span></div><div class="line">        <span class="comment">// bind OpenIdConnectRequest or OpenIdConnectResponse parameters.</span></div><div class="line">        options.UseMvc();</div><div class="line"></div><div class="line">        <span class="comment">// Enable the authorization, logout, token and userinfo endpoints.</span></div><div class="line">        options.EnableAuthorizationEndpoint(<span class="string">"/connect/authorize"</span>)</div><div class="line">               .EnableLogoutEndpoint(<span class="string">"/connect/logout"</span>)</div><div class="line">               .EnableTokenEndpoint(<span class="string">"/connect/token"</span>)</div><div class="line">               .EnableUserinfoEndpoint(<span class="string">"/api/userinfo"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Note: the Mvc.Client sample only uses the code flow and the password flow, but you</span></div><div class="line">        <span class="comment">// can enable the other flows if you need to support implicit or client credentials.</span></div><div class="line">        options.AllowAuthorizationCodeFlow()</div><div class="line">               .AllowPasswordFlow()</div><div class="line">               .AllowRefreshTokenFlow();</div><div class="line"></div><div class="line">        <span class="comment">// During development, you can disable the HTTPS requirement.</span></div><div class="line">        options.DisableHttpsRequirement();</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict validation handler.</span></div><div class="line">    <span class="comment">// Note: the OpenIddict validation handler is only compatible with the</span></div><div class="line">    <span class="comment">// default token format or with reference tokens and cannot be used with</span></div><div class="line">    <span class="comment">// JWT tokens. For JWT tokens, use the Microsoft JWT bearer handler.</span></div><div class="line">    .AddValidation();</div></pre></td></tr></table></figure><p><strong>Introducing these specialized builders was also a great opportunity to revisit how the OpenIddict entities are registered</strong>. In the RC2 bits, this is controlled by the <code>services.AddOpenIddict&lt;...&gt;()</code> method, that determines which entities are used depending on the overload.</p><p>In RC3, the generic <code>services.AddOpenIddict&lt;...&gt;()</code> methods have been removed and replaced by a more explicit pattern:</p><img src="/2018/06/20/openiddict-rc3-is-out/core-builder-entities.png" alt="core-builder-entities.png"><a id="more"></a><hr><h3 id="OpenIddict-now-has-its-own-validation-handler-compatible-with-reference-tokens"><a href="#OpenIddict-now-has-its-own-validation-handler-compatible-with-reference-tokens" class="headerlink" title="OpenIddict now has its own validation handler, compatible with reference tokens"></a>OpenIddict now has its own validation handler, compatible with reference tokens</h3><p>Thanks to <a href="https://github.com/openiddict/openiddict-core/pull/589" target="_blank" rel="external">a great contribution from Chino Chang</a>, OpenIddict now has its dedicated validation handler, based on <a href="https://www.nuget.org/packages/AspNet.Security.OAuth.Validation/" target="_blank" rel="external">the aspnet-contrib handler</a>.</p><p><strong>This handler supports both the default token format (opaque) and reference tokens</strong>. Like the aspnet-contrib handler, you can use it as a standalone handler (i.e without having to register the OpenIddict core or server services):</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Register the OpenIddict validation handler.</span></div><div class="line">services.AddOpenIddict()</div><div class="line">    .AddValidation();</div></pre></td></tr></table></figure><p>Resource servers that use reference tokens will have to configure the core services and register the appropriate stores to be able to use it:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Register the OpenIddict services.</span></div><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict core services.</span></div><div class="line">    .AddCore(options =&gt;</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Register the Entity Framework entities and stores.</span></div><div class="line">        options.UseEntityFrameworkCore()</div><div class="line">               .UseDbContext&lt;ApplicationDbContext&gt;();</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict validation handler.</span></div><div class="line">    .AddValidation(options =&gt; options.UseReferenceTokens());</div></pre></td></tr></table></figure><p>The aspnet-contrib handler will continue to be fully supported and will still be usable with OpenIddict so existing applications can keep using <code>services.AddAuthentication().AddOAuthValidation()</code> instead of <code>services.AddOpenIddict().AddValidation()</code> for opaque token validation.</p><div class="note tip"><p>Note: <code>OpenIddictValidationHandler</code> lives in the <code>OpenIddict.Validation</code> package, which is referenced by the <code>OpenIddict</code> metapackage. <strong>You don&#39;t have to add a new <code>PackageReference</code> to be able to use it</strong>.</p></div><hr><h3 id="MongoDB-is-now-officially-supported"><a href="#MongoDB-is-now-officially-supported" class="headerlink" title="MongoDB is now officially supported"></a>MongoDB is now officially supported</h3><p><strong>OpenIddict now natively supports MongoDB</strong>, one of the most popular NoSQL/document-oriented databases.</p><p>To configure OpenIddict to use MongoDB, reference the <code>OpenIddict.MongoDb</code> package and call the <code>options.UseMongoDb()</code> extension:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict core services.</span></div><div class="line">    .AddCore(options =&gt;</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Configure OpenIddict to use the MongoDB stores and models.</span></div><div class="line">        options.UseMongoDb();</div><div class="line">    &#125;);</div></pre></td></tr></table></figure><p>By default, the MongoDB stores will resolve the <code>IMongoDatabase</code> service from the DI container so you&#39;ll have to register it using the usual ASP.NET Core DI extensions. E.g:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">services.AddSingleton(<span class="keyword">new</span> MongoClient().GetDatabase(<span class="string">"main-db"</span>));</div></pre></td></tr></table></figure><p>Alternatively, developers who work with multiple MongoDB databases in the same application will be able to explicitly set the one they want to use in the OpenIddict options:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict core services.</span></div><div class="line">    .AddCore(options =&gt;</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Configure OpenIddict to use the MongoDB stores and models.</span></div><div class="line">        options.UseMongoDb()</div><div class="line">               .UseDatabase(<span class="keyword">new</span> MongoClient().GetDatabase(<span class="string">"openiddict-db"</span>));</div><div class="line">    &#125;)</div></pre></td></tr></table></figure><p>If no database can be resolved, an exception will be automatically thrown at runtime.</p><p>Other helpers are available to allow you to customize the default entities or the collection names:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict core services.</span></div><div class="line">    .AddCore(options =&gt;</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Configure OpenIddict to use the MongoDB stores and models.</span></div><div class="line">        options.UseMongoDb()</div><div class="line">               .ReplaceDefaultApplicationEntity&lt;MyApp&gt;()</div><div class="line">               .ReplaceDefaultAuthorizationEntity&lt;MyAuth&gt;()</div><div class="line">               .ReplaceDefaultScopeEntity&lt;MyScope&gt;()</div><div class="line">               .ReplaceDefaultTokenEntity&lt;MyToken&gt;()</div><div class="line">               .SetApplicationsCollectionName(<span class="string">"my-apps"</span>)</div><div class="line">               .SetAuthorizationsCollectionName(<span class="string">"my-auths"</span>)</div><div class="line">               .SetScopesCollectionName(<span class="string">"my-scopes"</span>)</div><div class="line">               .SetTokensCollectionName(<span class="string">"my-tokens"</span>);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure><hr><h3 id="OpenIddict-no-longer-comes-with-a-default-set-of-entities-and-stores-base-classes"><a href="#OpenIddict-no-longer-comes-with-a-default-set-of-entities-and-stores-base-classes" class="headerlink" title="OpenIddict no longer comes with a default set of entities and stores base classes"></a>OpenIddict no longer comes with a default set of entities and stores base classes</h3><p><strong>In the previous iterations of OpenIddict, an important effort was made to create a shared set of entities</strong> (contained in the <code>OpenIddict.Models</code> package) that could be used not only by the official Entity Framework 6.x and Entity Framework Core stores, but also by third-party/custom stores.</p><p>This pattern had many pros - like avoiding code duplication or having base classes that simplify the development of custom stores (which is why it was also eventually adopted by the ASP.NET team for ASP.NET Core Identity in 2.0).</p><p>Unfortunately, this approach had also a major issue: we had to design the default entities as &quot;lowest common denominators&quot;, so that they could be used by all/most ORMs or document databases. In practice, this meant that things like <code>OpenIddictApplication.RedirectUris</code> or <code>OpenIddictApplication.PostLogoutRedirectUris</code> had to be represented as JSON-serialized <code>strings</code> for SQL-oriented ORMs like EF 6.x and EF Core to work natively.</p><p><strong>In RC3, each stores package will come with its own models</strong> you&#39;ll be able to use exactly like in the previous iterations.</p><div class="note info"><p><strong>Make sure you don&#39;t reference the obsolete <code>OpenIddict.Models</code> or <code>OpenIddict.Stores</code> packages</strong>. The new models are automatically referenced by the stores packages they belong to and you don&#39;t need to add any reference to use them.</p></div><hr><h3 id="Application-permissions-have-been-reworked-to-be-simpler"><a href="#Application-permissions-have-been-reworked-to-be-simpler" class="headerlink" title="Application permissions have been reworked to be simpler"></a>Application permissions have been reworked to be simpler</h3><p>In RC2, we introduced application permissions. <strong>To make the migration from RC1 to RC2 smoother, application permissions were mostly optional</strong> and OpenIddict had a fallback mechanism called &quot;implicit permissions&quot; it used to determine whether an application could perform the requested action. For instance, if no permission was explicitly attached to the application, it was considered fully trusted and was granted all the permissions.</p><p>Similarly, if you granted the &quot;token endpoint&quot; permission to an application but NO &quot;grant type&quot; permission, it was assumed the client application was allowed to use the password or client credentials grants.</p><p><strong>Retrospectively, this logic was too complex and I decided to remove it in RC3.</strong></p><p><strong>Starting with RC3, permissions are no longer optional nor implicit</strong>: if you don&#39;t explicitly grant an application the necessary permissions, it will be blocked by OpenIddict.</p><p>To attach permissions to an application, use <code>OpenIddictApplicationManager</code>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> descriptor = <span class="keyword">new</span> OpenIddictApplicationDescriptor</div><div class="line">&#123;</div><div class="line">    ClientId = <span class="string">"mvc"</span>,</div><div class="line">    ClientSecret = <span class="string">"901564A5-E7FE-42CB-B10D-61EF6A8F3654"</span>,</div><div class="line">    DisplayName = <span class="string">"MVC client application"</span>,</div><div class="line">    PostLogoutRedirectUris = &#123; <span class="keyword">new</span> Uri(<span class="string">"http://localhost:53507/signout-callback-oidc"</span>) &#125;,</div><div class="line">    RedirectUris = &#123; <span class="keyword">new</span> Uri(<span class="string">"http://localhost:53507/signin-oidc"</span>) &#125;,</div><div class="line">    Permissions =</div><div class="line">    &#123;</div><div class="line">        OpenIddictConstants.Permissions.Endpoints.Authorization,</div><div class="line">        OpenIddictConstants.Permissions.Endpoints.Logout,</div><div class="line">        OpenIddictConstants.Permissions.Endpoints.Token,</div><div class="line">        OpenIddictConstants.Permissions.GrantTypes.AuthorizationCode,</div><div class="line">        OpenIddictConstants.Permissions.GrantTypes.RefreshToken,</div><div class="line">        OpenIddictConstants.Permissions.Scopes.Email,</div><div class="line">        OpenIddictConstants.Permissions.Scopes.Profile,</div><div class="line">        OpenIddictConstants.Permissions.Scopes.Roles</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">await</span> _applicationManager.CreateAsync(descriptor);</div></pre></td></tr></table></figure><p>If you don&#39;t care about permissions (e.g because you don&#39;t have third-party clients), you can instead disable them:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict server handler.</span></div><div class="line">    .AddServer(options =&gt;</div><div class="line">    &#123;</div><div class="line">        options.IgnoreEndpointPermissions()</div><div class="line">               .IgnoreGrantTypePermissions()</div><div class="line">               .IgnoreScopePermissions();</div><div class="line">    &#125;);</div></pre></td></tr></table></figure><hr><h3 id="Scope-validation-and-anonymous-clients-rejection-are-now-enabled-by-default"><a href="#Scope-validation-and-anonymous-clients-rejection-are-now-enabled-by-default" class="headerlink" title="Scope validation and anonymous clients rejection are now enabled by default"></a>Scope validation and anonymous clients rejection are now enabled by default</h3><p>Starting with RC3, <strong>OpenIddict will now enforce scope validation and reject token and revocation requests that don&#39;t specify a <code>client_id</code></strong>. In RC2, these checks were opt-in (enabled via <code>options.EnableScopeValidation()</code> and <code>options.RequireClientIdentification()</code>) ; <strong>in RC3, they are now opt-out</strong>.</p><p>If, after migrating to RC3, you see errors similar to these ones:</p><blockquote><p><strong>invalid_scope</strong> : The specified &#39;scope&#39; parameter is not valid.</p></blockquote><p>Simply add the scopes you want to use to the list of registered scopes:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict server handler.</span></div><div class="line">    .AddServer(options =&gt;</div><div class="line">    &#123;</div><div class="line">        options.RegisterScopes(OpenIdConnectConstants.Scopes.Email,</div><div class="line">                               OpenIdConnectConstants.Scopes.Profile,</div><div class="line">                               OpenIddictConstants.Scopes.Roles);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure><blockquote><p><strong>invalid_request</strong> : The mandatory &#39;client_id&#39; parameter is missing.</p></blockquote><p>Add an application entry for the client application and send the corresponding <code>client_id</code> as part of the token request:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> descriptor = <span class="keyword">new</span> OpenIddictApplicationDescriptor</div><div class="line">&#123;</div><div class="line">    ClientId = <span class="string">"postman"</span>,</div><div class="line">    DisplayName = <span class="string">"Postman"</span>,</div><div class="line">    Permissions =</div><div class="line">    &#123;</div><div class="line">        OpenIddictConstants.Permissions.Endpoints.Token,</div><div class="line">        OpenIddictConstants.Permissions.GrantTypes.Password,</div><div class="line">        OpenIddictConstants.Permissions.GrantTypes.RefreshToken,</div><div class="line">        OpenIddictConstants.Permissions.Scopes.Email,</div><div class="line">        OpenIddictConstants.Permissions.Scopes.Profile,</div><div class="line">        OpenIddictConstants.Permissions.Scopes.Roles</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">await</span> _applicationManager.CreateAsync(descriptor);</div></pre></td></tr></table></figure><p>If you prefer disabling these checks, you can use <code>options.DisableScopeValidation()</code> and <code>options.AcceptAnonymousClients()</code>:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">services.AddOpenIddict()</div><div class="line"></div><div class="line">    <span class="comment">// Register the OpenIddict server handler.</span></div><div class="line">    .AddServer(options =&gt;</div><div class="line">    &#123;</div><div class="line">        options.AcceptAnonymousClients();</div><div class="line">        options.DisableScopeValidation();</div><div class="line">    &#125;);</div></pre></td></tr></table></figure><div class="note tip"><p>Note: if you already use <code>options.EnableScopeValidation()</code> and/or <code>options.RequireClientIdentification()</code> in your code, you can safely remove these calls.</p></div><hr><h3 id="New-exception-messages-have-been-introduced-to-make-debugging-easier"><a href="#New-exception-messages-have-been-introduced-to-make-debugging-easier" class="headerlink" title="New exception messages have been introduced to make debugging easier"></a>New exception messages have been introduced to make debugging easier</h3><p>In this release, <strong>we also made debugging easier by adding custom exception messages instead of relying on the rather cryptic DI-related messages</strong> thrown by ASP.NET Core.</p><p>If you forget to register stores, you&#39;ll now get a much clearer exception:</p><blockquote><p><strong>System.InvalidOperationException</strong> : No application store has been registered in the dependency injection container.</p><p>To register the Entity Framework Core stores, reference the <code>OpenIddict.EntityFrameworkCore</code> package and call <code>services.AddOpenIddict().AddCore().UseEntityFrameworkCore()</code>.</p><p>To register a custom store, create an implementation of <code>IOpenIddictApplicationStore</code> and use <code>services.AddOpenIddict().AddCore().AddApplicationStore()</code> to add it to the DI container.</p></blockquote><p>If you use an entity that is not compatible with the underlying store, you&#39;ll also get a better exception:</p><blockquote><p><strong>System.InvalidOperationException</strong> : The specified application type is not compatible with the Entity Framework Core stores.</p><p>When enabling the Entity Framework Core stores, make sure you use the built-in <code>OpenIddictApplication</code> entity (from the <code>OpenIddict.EntityFrameworkCore.Models</code> package) or a custom entity that inherits from the generic <code>OpenIddictApplication</code> entity.</p></blockquote><p>Similarly, if you forget to register the core services when enabling the server or validation components, you&#39;ll get an exception:</p><blockquote><p><strong>System.InvalidOperationException</strong> : The core services must be registered when enabling the server handler. To register the OpenIddict core services, use <code>services.AddOpenIddict().AddCore()</code>.</p></blockquote><blockquote><p><strong>System.InvalidOperationException</strong> : The core services must be registered when enabling reference tokens support. To register the OpenIddict core services, use <code>services.AddOpenIddict().AddCore()</code>.</p></blockquote><hr><h2 id="What-39-s-next"><a href="#What-39-s-next" class="headerlink" title="What&#39;s next?"></a>What&#39;s next?</h2><p>OpenIddict RC3 will be the latest release candidate and RTM will be the next step.</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2018/06/20/openiddict-rc3-is-out/" data-id="cl02sbe1k006akki1rbfoboco" class="article-share-link">Share</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li></ul></footer></div><nav id="article-nav"><a href="/2018/07/02/implementing-advanced-scenarios-using-the-new-openiddict-rc3-events-model/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">Implementing advanced scenarios using the new OpenIddict RC3 events model</div></a><a href="/2018/06/18/the-aspnet-contrib-oauth-2-0-openid-2-0-social-providers-are-now-rtm/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">The aspnet-contrib OAuth 2.0/OpenID 2.0 social providers are now RTM</div></a></nav></article></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2022/02/25/introducing-the-openiddict-client/" class="title">Introducing the OpenIddict client</a></p><p class="item-date"><time datetime="2022-02-25T21:00:00.000Z" itemprop="datePublished">2022-02-25</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/" class="title">ASP.NET Core 6 and authentication servers: the real bait and switch is not the one you think</a></p><p class="item-date"><time datetime="2021-05-24T18:30:00.000Z" itemprop="datePublished">2021-05-24</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2020/12/23/openiddict-3-0-general-availability/" class="title">OpenIddict 3.0 general availability</a></p><p class="item-date"><time datetime="2020-12-23T21:00:00.000Z" itemprop="datePublished">2020-12-23</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2020/11/17/introducing-openiddict-3-0-s-first-release-candidate-version/" class="title">Introducing OpenIddict 3.0&#39;s first release candidate version</a></p><p class="item-date"><time datetime="2020-11-17T21:00:00.000Z" itemprop="datePublished">2020-11-17</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2020/10/27/openiddict-3-0-beta6-is-out/" class="title">OpenIddict 3.0 beta6 is out</a></p><p class="item-date"><time datetime="2020-10-27T19:00:00.000Z" itemprop="datePublished">2020-10-27</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2022 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>