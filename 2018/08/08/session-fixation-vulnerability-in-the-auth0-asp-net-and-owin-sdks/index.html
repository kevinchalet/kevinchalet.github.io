<!DOCTYPE html><html><head><meta charset="utf-8"><title>Session fixation vulnerability in the Auth0 ASP.NET and OWIN SDKs | Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Recently, I received a mail from Auth0 asking me if I was interested in joining them. I had used Auth0 many times in the past but I had never taken the time to look at their OSS SDKs. This mail was a"><meta property="og:type" content="article"><meta property="og:title" content="Session fixation vulnerability in the Auth0 ASP.NET and OWIN SDKs"><meta property="og:url" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/index.html"><meta property="og:site_name" content="Kévin Chalet's blog"><meta property="og:description" content="Recently, I received a mail from Auth0 asking me if I was interested in joining them. I had used Auth0 many times in the past but I had never taken the time to look at their OSS SDKs. This mail was a"><meta property="og:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/callback-uris.png"><meta property="og:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/login-page.png"><meta property="og:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-breakpoints.png"><meta property="og:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-breakpoint-management.png"><meta property="og:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-authorization-response.png"><meta property="og:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-fake-responses.png"><meta property="og:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/malicious-iframe.png"><meta property="og:updated_time" content="2018-08-08T16:46:04.648Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Session fixation vulnerability in the Auth0 ASP.NET and OWIN SDKs"><meta name="twitter:description" content="Recently, I received a mail from Auth0 asking me if I was interested in joining them. I had used Auth0 many times in the past but I had never taken the time to look at their OSS SDKs. This mail was a"><meta name="twitter:image" content="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/callback-uris.png"><meta name="twitter:creator" content="@PinpointTownes"><link rel="icon" href="/css/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script></head></html><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" href="https://twitter.com/intent/user?screen_name=PinpointTownes"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">25 <span>posts</span></div><div class="article-info-block">21 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a href="https://github.com/PinpointTownes" title="GitHub"><i class="fa fa-github"></i></a></td><td><a href="https://twitter.com/PinpointTownes" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a href="http://stackoverflow.com/users/542757/pinpoint" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Session fixation vulnerability in the Auth0 ASP.NET and OWIN SDKs</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/"><time datetime="2018-08-08T17:00:00.000Z" itemprop="datePublished">2018-08-08</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Recently, I received a mail from Auth0 asking me if I was interested in joining them. I had used Auth0 many times in the past but I had never taken the time to look at their OSS SDKs. This mail was a good opportunity to change that.</p><p>When doing so, <strong>I discovered that both their <a href="https://github.com/auth0/auth0-aspnet" target="_blank" rel="external">ASP.NET 4.x</a> and <a href="https://github.com/auth0/auth0-aspnet-owin" target="_blank" rel="external">OWIN/Katana</a> SDKs were unfortunately prone to &quot;session fixation&quot;</strong>, which is a form of cross-site request forgery allowing to force a victim to log in under an attacker&#39;s account.</p><p>Since it&#39;s a quite frequent vulnerability, here&#39;s a quick overview of what causes it and how you can concretly exploit it.</p><div class="note warn"><p>Auth0 was already aware of this issue internally and <a href="https://auth0.com/docs/security/bulletins/cve-2018-15121" target="_blank" rel="external">decided to switch to the official OWIN OpenID Connect middleware developed by Microsoft</a>, which is not prone to this class of attack.</p><p><strong>If you need to migrate, Auth0 has prepared a <a href="https://auth0.com/docs/quickstart/webapp/aspnet-owin/04-migrating" target="_blank" rel="external">migration guide</a></strong> listing the steps required to replace <code>Auth0-ASPNET-Owin</code> by Microsoft&#39;s OpenID Connect middleware.</p></div><h2 id="What-do-session-fixation-attacks-consist-in"><a href="#What-do-session-fixation-attacks-consist-in" class="headerlink" title="What do session fixation attacks consist in?"></a>What do session fixation attacks consist in?</h2><p>The <a href="https://tools.ietf.org/html/rfc6819" target="_blank" rel="external">OAuth2 threat model RFC</a> – a must read for anyone dealing with OAuth2 and OpenID Connect – gives <a href="https://tools.ietf.org/html/rfc6819#sehection-4.4.1.8" target="_blank" rel="external">an excellent definition of this threat and its practical implications</a>:</p><blockquote><p>Cross-site request forgery (CSRF) is a web-based attack whereby HTTP requests are transmitted from a user that the web site trusts or has authenticated (e.g., via HTTP redirects or HTML forms). CSRF attacks on OAuth approvals can allow an attacker to obtain authorization to OAuth protected resources without the consent of the user. This attack works against the redirect URI used in the authorization &quot;code&quot; flow.</p><p>An attacker could authorize an authorization &quot;code&quot; to their own protected resources on an authorization server. He then aborts the redirect flow back to the client on his device and tricks the victim into executing the redirect back to the client. The client receives the redirect, fetches the token(s) from the authorization server, and associates the victim&#39;s client session with the resources accessible using the token.</p><p>Impact: the user accesses resources on behalf of the attacker. The effective impact depends on the type of resource accessed. For example, the user may upload private items to an attacker&#39;s resources. Or, when using OAuth in 3rd-party login scenarios, the user may associate his client account with the attacker&#39;s identity at the external Identity Provider. In this way, the attacker could easily access the victim&#39;s data at the client by logging in from another device with his credentials at the external Identity Provider.</p></blockquote><p>Usually, this (generally underestimated) threat is mitigated by correlating the authorization response with the authorization request: <strong>typically, by generating an unguessable value before redirecting the user to the Identity Provider and validating it before sending the token request</strong>.</p><p>Unfortunately, this kind of check is not made by the Auth0 ASP.NET 4.x and OWIN SDKs, making them vulnerable to this class of attack.</p><a id="more"></a><h2 id="How-can-I-reproduce-the-vulnerability"><a href="#How-can-I-reproduce-the-vulnerability" class="headerlink" title="How can I reproduce the vulnerability?"></a>How can I reproduce the vulnerability?</h2><p>Reproducing the vulnerability is quite easy. For that, I wrote a simple self-hosted OWIN/Katana console application using the vulnerable <code>Auth0-ASPNET-Owin</code> package.</p><div class="note tip"><p>The specific version doesn&#39;t matter much, as a quick look at the git history seems to indicate this vulnerability exists since the very first day: all versions are potentially vulnerable.</p></div><h3 id="Create-a-self-hosted-OWIN-application"><a href="#Create-a-self-hosted-OWIN-application" class="headerlink" title="Create a self-hosted OWIN application"></a>Create a self-hosted OWIN application</h3><figure class="highlight xml"><figcaption><span>packages.config</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">packages</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Auth0-ASPNET-Owin"</span> <span class="attr">version</span>=<span class="string">"2.3.1"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Microsoft.Owin"</span> <span class="attr">version</span>=<span class="string">"3.1.0"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Microsoft.Owin.Host.HttpListener"</span> <span class="attr">version</span>=<span class="string">"3.1.0"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Microsoft.Owin.Hosting"</span> <span class="attr">version</span>=<span class="string">"3.1.0"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Microsoft.Owin.Security"</span> <span class="attr">version</span>=<span class="string">"3.1.0"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Microsoft.Owin.Security.Cookies"</span> <span class="attr">version</span>=<span class="string">"3.1.0"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Newtonsoft.Json"</span> <span class="attr">version</span>=<span class="string">"7.0.1"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"Owin"</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">id</span>=<span class="string">"System.Text.Encodings.Web"</span> <span class="attr">version</span>=<span class="string">"4.5.0"</span> <span class="attr">targetFramework</span>=<span class="string">"net47"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">packages</span>&gt;</span></div></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>Program.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> System;</div><div class="line"><span class="keyword">using</span> Microsoft.Owin.Hosting;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">SessionFixationDemo</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Program</span></div><div class="line">    &#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">const</span> <span class="keyword">string</span> address = <span class="string">"http://localhost:[port]/"</span>;</div><div class="line"></div><div class="line">            <span class="keyword">using</span> (WebApp.Start&lt;Startup&gt;(address))</div><div class="line">            &#123;</div><div class="line">                Console.WriteLine(<span class="string">$"Server is running on <span class="subst">&#123;address&#125;</span>, press CTRL+C to stop."</span>);</div><div class="line">                Console.ReadLine();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>Startup.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> System.Text.Encodings.Web;</div><div class="line"><span class="keyword">using</span> Auth0.Owin;</div><div class="line"><span class="keyword">using</span> Microsoft.Owin;</div><div class="line"><span class="keyword">using</span> Microsoft.Owin.Security;</div><div class="line"><span class="keyword">using</span> Microsoft.Owin.Security.Cookies;</div><div class="line"><span class="keyword">using</span> Owin;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">SessionFixationDemo</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span></div><div class="line">    &#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder app</span>)</span></div><div class="line">        &#123;</div><div class="line">            app.SetDefaultSignInAsAuthenticationType(CookieAuthenticationDefaults.AuthenticationType);</div><div class="line"></div><div class="line">            app.UseCookieAuthentication(<span class="keyword">new</span> CookieAuthenticationOptions());</div><div class="line"></div><div class="line">            app.UseAuth0Authentication(<span class="keyword">new</span> Auth0AuthenticationOptions</div><div class="line">            &#123;</div><div class="line">                Domain = <span class="string">"[domain]"</span>,</div><div class="line">                ClientId = <span class="string">"[client identifier]"</span>,</div><div class="line">                ClientSecret = <span class="string">"[client secret]"</span></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            app.Run(<span class="keyword">async</span> context =&gt;</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (context.Request.Path == <span class="keyword">new</span> PathString(<span class="string">"/challenge"</span>))</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">var</span> properties = <span class="keyword">new</span> AuthenticationProperties</div><div class="line">                    &#123;</div><div class="line">                        RedirectUri = <span class="string">"/"</span></div><div class="line">                    &#125;;</div><div class="line"></div><div class="line">                    context.Authentication.Challenge(properties, <span class="string">"Auth0"</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (context.Request.Path == <span class="keyword">new</span> PathString(<span class="string">"/fix-session"</span>))</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">var</span> code = context.Request.Query[<span class="string">"attacker_authorization_code"</span>];</div><div class="line">                    <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(code))</div><div class="line">                    &#123;</div><div class="line">                        context.Response.StatusCode = <span class="number">400</span>;</div><div class="line">                        <span class="keyword">return</span>;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    context.Response.ContentType = <span class="string">"text/html"</span>;</div><div class="line">                    <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$@"&lt;!doctype html&gt;</span></div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Session fixation demonstration&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;iframe src=""/signin-auth0?code=<span class="subst">&#123;HtmlEncoder.Default.Encode(code)&#125;</span>""&gt;&lt;/iframe&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;");</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (context.Authentication.User == <span class="literal">null</span> ||</div><div class="line">                   !context.Authentication.User.Identity.IsAuthenticated)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">"You're not logged in. "</span>);</div><div class="line">                    <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">"Visit /challenge to trigger a challenge."</span>);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">var</span> name = HtmlEncoder.Default.Encode(context.Authentication.User.Identity.Name);</div><div class="line">                <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$"You're logged in as <span class="subst">&#123;name&#125;</span>."</span>);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="Register-a-new-Auth0-application"><a href="#Register-a-new-Auth0-application" class="headerlink" title="Register a new Auth0 application"></a>Register a new Auth0 application</h3><p>Thanks to Auth0&#39;s user-friendly portal, registering a new Web server application is quite straightforward. When created, don&#39;t forget to register <code>http://localhost:[port]/signin-auth0</code> as a valid <code>redirect_uri</code>:</p><img src="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/callback-uris.png" alt="callback-uris.png"><h3 id="Create-a-first-account-playing-the-attacker-role"><a href="#Create-a-first-account-playing-the-attacker-role" class="headerlink" title="Create a first account (playing the attacker role)"></a>Create a first account (playing the attacker role)</h3><p>Once the application is correctly registered, start the OWIN application and visit <code>http://localhost:[port]/challenge</code> to start a new authentication flow. Doing that will redirect you to the Auth0 login page:</p><img src="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/login-page.png" alt="login-page.png"><p>Then, create a new account that will be used as the attacker account and approve the authorization request. Once approved, you should be redirected to the OWIN application and the following message should appear:</p><blockquote><p>You&#39;re logged in as [email address of your first account].</p></blockquote><h3 id="Create-a-second-account-playing-the-victim-role"><a href="#Create-a-second-account-playing-the-victim-role" class="headerlink" title="Create a second account (playing the victim role)"></a>Create a second account (playing the victim role)</h3><p>For that, visit <code>http://localhost:[port]/challenge</code> a second time, create a new Auth0 account and approve the authorization request exactly like you did during the previous step.</p><p>At this point, you should be logged in as the victim:</p><blockquote><p>You&#39;re logged in as [email address of your second account].</p></blockquote><h3 id="In-a-private-browser-window-start-a-new-authentication-flow-using-the-attacker-account"><a href="#In-a-private-browser-window-start-a-new-authentication-flow-using-the-attacker-account" class="headerlink" title="In a private browser window, start a new authentication flow using the attacker account"></a>In a private browser window, start a new authentication flow using the attacker account</h3><p><strong>At this stage, the objective is to retrieve an authorization code associated with the attacker account</strong>. To do that, my preferred option is to use Fiddler and its breakpoints feature, that will allow you to abort the authentication flow before being redirected back to the OWIN application (and ensure the authorization code is not redeemed):</p><img src="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-breakpoints.png" alt="fiddler-breakpoints.png"><p><strong>In a private browser window</strong>, visit <code>http://localhost:[port]/challenge</code>, go back to Fiddler and allow the challenge request to be processed by clicking on <code>Run to completion</code>.</p><img src="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-breakpoint-management.png" alt="fiddler-breakpoint-management.png"><p>After logging in as the attacker, you should be redirected by Auth0 back to the OWIN application with the precious authorization code:</p><img src="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-authorization-response.png" alt="fiddler-authorization-response.png"><p>Extract the authorization code from the query string and abort the request by choosing a fake response in Fiddler&#39;s list before clicking on <code>Run to completion</code>:</p><img src="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/fiddler-fake-responses.png" alt="fiddler-fake-responses.png"><p>Copy the attacker&#39;s authorization code and close the window.</p><h3 id="Force-the-victim-to-log-in-as-the-attacker"><a href="#Force-the-victim-to-log-in-as-the-attacker" class="headerlink" title="Force the victim to log in as the attacker"></a>Force the victim to log in as the attacker</h3><p>Now, go back to your main browser window and visit <code>http://localhost:[port]/</code> to confirm you&#39;re still logged in using the victim account.</p><p>Then, visit <code>http://localhost:[port]/fix-session?attacker_authorization_code=[code]</code>. This page contains a malicious iframe that directly points to the <code>redirect_uri</code> endpoint of the OWIN application. When visiting this page, <strong>you&#39;ll be immediately logged out of your main account – i.e the victim – and all requests will now be sent using the attacker&#39;s identity</strong>:</p><img src="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/malicious-iframe.png" alt="malicious-iframe.png"><div class="note tip"><p>In a real world attack, this HTML page would be hosted by an attacker on a different server and would be embedded in a malicious site or directly reached by a victim after clicking on a link. Here, the <code>/fix-session</code> endpoint is only provided for convenience.</p></div><h3 id="Acknowledgments"><a href="#Acknowledgments" class="headerlink" title="Acknowledgments"></a>Acknowledgments</h3><p><strong>Kudos to Marcin Hoppe and Jerrie Pelser for their promptness in getting back to me</strong>. While Auth0 doesn&#39;t have a real <a href="https://auth0.com/whitehat" target="_blank" rel="external">&quot;bug bounty&quot; program</a> yet – which is frankly unfortunate for a such big player in the Identity sector (specially when vendors like Microsoft or Okta already have proper programs in place) – it&#39;s certainly a good thing to be able to reach them very quickly.</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/" data-id="cjryy2f210047l4i2nbx4100a" class="article-share-link">Share</a> <a href="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/#disqus_thread" class="article-comment-link">Comments</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net/">asp.net</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/auth0/">auth0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/owin/">owin</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnerability/">vulnerability</a></li></ul></footer></div><nav id="article-nav"><a href="/2018/10/07/highway-to-dll-hell/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">Highway to (DLL) Hell</div></a><a href="/2018/07/02/implementing-advanced-scenarios-using-the-new-openiddict-rc3-events-model/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Implementing advanced scenarios using the new OpenIddict RC3 events model</div></a></nav></article><section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2018/11/01/openiddict-1-0-and-2-0-general-availability/" class="title">OpenIddict 1.0 and 2.0 general availability</a></p><p class="item-date"><time datetime="2018-11-01T20:00:00.000Z" itemprop="datePublished">2018-11-01</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/10/07/highway-to-dll-hell/" class="title">Highway to (DLL) Hell</a></p><p class="item-date"><time datetime="2018-10-07T13:00:00.000Z" itemprop="datePublished">2018-10-07</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/" class="title">Session fixation vulnerability in the Auth0 ASP.NET and OWIN SDKs</a></p><p class="item-date"><time datetime="2018-08-08T17:00:00.000Z" itemprop="datePublished">2018-08-08</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/07/02/implementing-advanced-scenarios-using-the-new-openiddict-rc3-events-model/" class="title">Implementing advanced scenarios using the new OpenIddict RC3 events model</a></p><p class="item-date"><time datetime="2018-07-02T16:15:00.000Z" itemprop="datePublished">2018-07-02</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/06/20/openiddict-rc3-is-out/" class="title">OpenIddict RC3 is out</a></p><p class="item-date"><time datetime="2018-06-20T14:00:00.000Z" itemprop="datePublished">2018-06-20</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">25</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/">asp.net core</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/">aspnet-contrib</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/">auth0</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/">authentication</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/">jwt</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/">oauth</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/">openid connect</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/">openiddict</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/">owin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/">windows media center</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2019 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script>var disqus_shortname="kevinchalet";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body>