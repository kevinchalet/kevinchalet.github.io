<!DOCTYPE html><html><head><meta charset="utf-8"><title>Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:type" content="website"><meta property="og:title" content="Kévin Chalet&#39;s blog"><meta property="og:url" content="https://kevinchalet.com/page/6/index.html"><meta property="og:site_name" content="Kévin Chalet&#39;s blog"><meta property="og:locale" content="en_US"><meta property="article:author" content="Kévin Chalet"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="https://kevinchalet.com/assets/photo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style></head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">43 <span>posts</span></div><div class="article-info-block">36 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-why-you-should-never-use-html-raw-in-your-razor-views" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2018/01/09/why-you-should-never-use-html-raw-in-your-razor-views/">Why you should never use Html.Raw in your Razor views</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2018/01/09/why-you-should-never-use-html-raw-in-your-razor-views/"><time datetime="2018-01-09T18:30:00.000Z" itemprop="datePublished">2018-01-09</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Earlier today, <strong>Microsoft released two security advisories for vulnerabilities I discovered in the ASP.NET Core 2.0 VS2017 templates</strong> and reported late October:</p><ul><li><p><a target="_blank" rel="noopener" href="https://github.com/aspnet/Announcements/issues/284"><strong>CVE-2018-0785</strong> - ASP.NET Core Templates enable Cross Site Request Forgery</a>: a CSRF vulnerability in <code>ManageController.GenerateRecoveryCodes()</code> allows re-generating the recovery codes associated with a victim's account, which may result in a definitive account lockout (aka per-user denial of service).</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/aspnet/Announcements/issues/285"><strong>CVE-2018-0784</strong> - ASP.NET Core Templates enable Elevation Of Privilege Vulnerability</a>.</p></li></ul><p>While the first one is a very classic case of cross-site request forgery (CSRF), the second one is a bit more interesting as it relies on a specificity of ASP.NET Core MVC to be exploited.</p><h2 id="Where-was-the-vulnerability-located"><a href="#Where-was-the-vulnerability-located" class="headerlink" title="Where was the vulnerability located?"></a>Where was the vulnerability located?</h2><p>When you create a new project based on the ASP.NET Core 2.0 templates offered by Visual Studio 2017 and opt for individual authentication (that uses ASP.NET Core Identity under the hood), a new <code>ManageController</code> and a bunch of views are automatically added to the resulting solution.</p><p>One of the actions exposed by this controller, <code>EnableAuthenticator</code>, allows you to generate a shared secret you can use in your favorite TOTP-based application (like Microsoft or Google Authenticator) to enable 2-factor authentication:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpGet</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IActionResult&gt; <span class="title">EnableAuthenticator</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">await</span> _userManager.GetUserAsync(User);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationException(<span class="string">$"Unable to load user with ID '<span class="subst">{_userManager.GetUserId(User)}</span>'."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> unformattedKey = <span class="keyword">await</span> _userManager.GetAuthenticatorKeyAsync(user);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(unformattedKey))</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">await</span> _userManager.ResetAuthenticatorKeyAsync(user);</span><br><span class="line">        unformattedKey = <span class="keyword">await</span> _userManager.GetAuthenticatorKeyAsync(user);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> model = <span class="keyword">new</span> EnableAuthenticatorViewModel</span><br><span class="line">    {</span><br><span class="line">        SharedKey = FormatKey(unformattedKey),</span><br><span class="line">        AuthenticatorUri = GenerateQrCodeUri(user.Email, unformattedKey)</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> View(model);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>For that, a random value is generated server-side by Identity, stored in the database and used to build a special <code>otpauth://totp</code> URI which is <strong>rendered in the Razor view as an HTML attribute</strong> (that can be optionally read by a JS library to generate a QR code image client-side):</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Scan the QR Code or enter this key <span class="tag">&lt;<span class="name">kbd</span>&gt;</span>@Model.SharedKey<span class="tag">&lt;/<span class="name">kbd</span>&gt;</span> into your two factor authenticator app. Spaces and casing do not matter.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-info"</span>&gt;</span>To enable QR code generation please read our <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://go.microsoft.com/fwlink/?Linkid=852423"</span>&gt;</span>documentation<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrCode"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrCodeData"</span> <span class="attr">data-url</span>=<span class="string">"@Html.Raw(Model.AuthenticatorUri)"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Scan the QR Code or enter this key <span class="tag">&lt;<span class="name">kbd</span>&gt;</span>xuht bbzd 3juv 4kt6 glpb l5tc jbc6 yjsn<span class="tag">&lt;/<span class="name">kbd</span>&gt;</span> into your two factor authenticator app. Spaces and casing do not matter.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-info"</span>&gt;</span>To enable QR code generation please read our <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://go.microsoft.com/fwlink/?Linkid=852423"</span>&gt;</span>documentation<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrCode"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrCodeData"</span> <span class="attr">data-url</span>=<span class="string">"otpauth://totp/myappname:alice@bob.com?secret=XUHTBBZD3JUV4KT6GLPBL5TCJBC6YJSN&amp;issuer=myappname&amp;digits=6"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="What-does-the-vulnerability-consist-in"><a href="#What-does-the-vulnerability-consist-in" class="headerlink" title="What does the vulnerability consist in?"></a>What does the vulnerability consist in?</h2><p>As you can see, <strong>the view uses <code>Html.Raw</code> to render the generated authenticator URI</strong>, which is confirmed by the fact the <code>&amp;</code> character is not properly HTML-encoded (it should be rendered in the HTML document as <code>&amp;amp;</code> since it's a special character).</p><p><strong>Innocently, you might think it's not a big deal since <code>AuthenticatorUri</code> is generated server-side</strong> (and thus can't be directly set by an attacker).</p><p><strong>Unfortunately, that's not exact</strong>: while it's true that adding an <code>AuthenticatorUri</code> paramater will have initially no effect on the GET <code>EnableAuthenticator</code> action (since the value will be always overridden when setting <code>EnableAuthenticatorViewModel.AuthenticatorUri</code> before returning the view), <strong>the query string value will be used if the form is re-displayed</strong>.</p><p><strong>Yet, that's exactly what the POST action does if the model state is not valid</strong> (e.g because the 2FA confirmation code was not correctly typed by the user or was invalid, which may happen if the date/time differ between the server and the device that generated the 2FA code):</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line">[<span class="meta">ValidateAntiForgeryToken</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;IActionResult&gt; <span class="title">EnableAuthenticator</span>(<span class="params">EnableAuthenticatorViewModel model</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (!ModelState.IsValid)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> View(model);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">await</span> _userManager.GetUserAsync(User);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationException(<span class="string">$"Unable to load user with ID '<span class="subst">{_userManager.GetUserId(User)}</span>'."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Strip spaces and hypens</span></span><br><span class="line">    <span class="keyword">var</span> verificationCode = model.Code.Replace(<span class="string">" "</span>, <span class="built_in">string</span>.Empty).Replace(<span class="string">"-"</span>, <span class="built_in">string</span>.Empty);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> is2faTokenValid = <span class="keyword">await</span> _userManager.VerifyTwoFactorTokenAsync(</span><br><span class="line">        user, _userManager.Options.Tokens.AuthenticatorTokenProvider, verificationCode);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!is2faTokenValid)</span><br><span class="line">    {</span><br><span class="line">        ModelState.AddModelError(<span class="string">"model.Code"</span>, <span class="string">"Verification code is invalid."</span>);</span><br><span class="line">        <span class="keyword">return</span> View(model);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> _userManager.SetTwoFactorEnabledAsync(user, <span class="literal">true</span>);</span><br><span class="line">    _logger.LogInformation(<span class="string">"User with ID {UserId} has enabled 2FA with an authenticator app."</span>, user.Id);</span><br><span class="line">    <span class="keyword">return</span> RedirectToAction(<span class="keyword">nameof</span>(GenerateRecoveryCodes));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="note tip"><p>This feature – which is part of ASP.NET Core MVC's model binding/validation stack – is extremely useful since it's what allows the users of your websites to avoid re-typing all the values of an invalid form when it's re-displayed.</p></div><p><strong>The bad news is that using this specificity alongside <code>Html.Raw</code> can result in a XSS vulnerability being exploitable</strong> since an attacker can craft a special URL containing a malicious JavaScript payload that will be executed by the victim's browser if he or she sends an invalid 2FA confirmation code.</p><p>For instance, if a victim visits <code>https://localhost:44370/Manage/EnableAuthenticator?AuthenticatorUri=%22%3E%3C/div%3E%00%00%00%00%00%00%00%3Cscript%3Ealert(%22XSS%22)%3C/script%3E</code> (which uses a special pattern to bypass Chrome 61's XSS auditor feature) and enters an invalid code, the following HTML source will be rendered:</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Scan the QR Code or enter this key <span class="tag">&lt;<span class="name">kbd</span>&gt;</span><span class="tag">&lt;/<span class="name">kbd</span>&gt;</span> into your two factor authenticator app. Spaces and casing do not matter.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-info"</span>&gt;</span>To enable QR code generation please read our <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://go.microsoft.com/fwlink/?Linkid=852423"</span>&gt;</span>documentation<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrCode"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrCodeData"</span> <span class="attr">data-url</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>       <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">"XSS"</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>"&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="How-can-I-fix-the-vulnerability"><a href="#How-can-I-fix-the-vulnerability" class="headerlink" title="How can I fix the vulnerability?"></a>How can I fix the vulnerability?</h2><p>Detailed instructions are listed <a target="_blank" rel="noopener" href="https://github.com/aspnet/Announcements/issues/285">on Microsoft's announcement</a>.</p><h2 id="So-what-39-s-wrong-with-Html-Raw"><a href="#So-what-39-s-wrong-with-Html-Raw" class="headerlink" title="So, what's wrong with Html.Raw?"></a>So, what's wrong with <code>Html.Raw</code>?</h2><p>In some cases, disabling HTML encoding is just unavoidable, for instance if the content is already encoded: not doing that would result in double-encoding.</p><p>So, why shouldn't you use <code>Html.Raw</code> in your views? It's actually all about intent: <code>Html.Raw</code> encourages developers to "disable" HTML encoding at the wrong layer (i.e in the view rather than in the controller itself) by declaring already-encoded HTML properties as simple <code>string</code> properties in their view model rather than as <code>HtmlString</code> properties.</p><p>Using this type instead of <code>Html.Raw</code> has two big advantages, that would have helped avoid this vulnerability in the first place:</p><ul><li><p>By marking your view model properties as <code>HtmlString</code>, you force the developer in charge of maintaining the controller code to manually create a <code>HtmlString</code> instance from an existing string: <code>new HtmlString(existingEncodedString)</code>. Technically, the result is exactly the same, but it's now clear by looking at either your view model or your controller code that a property is not a simple <code>string</code>, but something hightly susceptible of containing HTML payloads you should treat with extreme care.</p></li><li><p><code>HtmlString</code> is not bindable: a form model containing a <code>HtmlString</code> will never be populated with user input. In this specific case, exploiting the bug wouldn't have been possible with <code>HtmlString</code>.</p></li></ul><p>Please, do yourself a favor: stop using <code>Html.Raw</code>.</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2018/01/09/why-you-should-never-use-html-raw-in-your-razor-views/" data-id="clj0c62bu000omki2bawf0jxb" class="article-share-link">Share</a> <a href="/2018/01/09/why-you-should-never-use-html-raw-in-your-razor-views/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/razor/" rel="tag">razor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a></li></ul></footer></div></article><article id="post-the-new-asos-and-openiddict-packages-are-now-on-nuget-org" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2017/10/20/the-new-asos-and-openiddict-packages-are-now-on-nuget-org/">The new ASOS and OpenIddict packages are now on NuGet.org</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/10/20/the-new-asos-and-openiddict-packages-are-now-on-nuget-org/"><time datetime="2017-10-20T21:00:00.000Z" itemprop="datePublished">2017-10-20</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Today's the day: new ASOS and OpenIddict packages (compatible with ASP.NET Core 1.0 and 2.0) have just been pushed to NuGet.org:</p><ul><li><a target="_blank" rel="noopener" href="https://www.nuget.org/packages/AspNet.Security.OpenIdConnect.Server/1.0.2">AspNet.Security.OpenIdConnect.Server – 1.0.2</a> (for ASP.NET Core 1.x)</li><li><a target="_blank" rel="noopener" href="https://www.nuget.org/packages/AspNet.Security.OpenIdConnect.Server/2.0.0-rc1-final">AspNet.Security.OpenIdConnect.Server – 2.0.0-rc1-final</a> (for ASP.NET Core 2.x)</li><li><a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Owin.Security.OpenIdConnect.Server/1.0.2">Owin.Security.OpenIdConnect.Server – 1.0.2</a> (for OWIN/Katana 3.x)</li><li><a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Owin.Security.OpenIdConnect.Server/2.0.0-rc1-final">Owin.Security.OpenIdConnect.Server – 2.0.0-rc1-final</a> (for OWIN/Katana 4.x)</li><li><a target="_blank" rel="noopener" href="https://www.nuget.org/packages/OpenIddict/1.0.0-rc1-final">OpenIddict – 1.0.0-rc1-final</a> (for ASP.NET Core 1.x)</li><li><a target="_blank" rel="noopener" href="https://www.nuget.org/packages/OpenIddict/2.0.0-rc1-final">OpenIddict – 2.0.0-rc1-final</a> (for ASP.NET Core 2.x)</li></ul><h2 id="What-39-s-new"><a href="#What-39-s-new" class="headerlink" title="What's new?"></a>What's new?</h2><h3 id="In-AspNet-Security-OpenIdConnect-Server-and-Owin-Security-OpenIdConnect-Server-1-0-2"><a href="#In-AspNet-Security-OpenIdConnect-Server-and-Owin-Security-OpenIdConnect-Server-1-0-2" class="headerlink" title="In AspNet.Security.OpenIdConnect.Server and Owin.Security.OpenIdConnect.Server 1.0.2"></a>In AspNet.Security.OpenIdConnect.Server and Owin.Security.OpenIdConnect.Server 1.0.2</h3><ul><li>Calling <code>context.HandleResponse()</code> from the <code>SerializeAuthorizationCode</code>, <code>SerializeAccessToken</code>, <code>SerializeIdentityToken</code> and <code>SerializeRefreshToken</code> events no longer throws an exception if the authentication ticket is not explicitly set (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/c734c6f09952f89906398fd6d0e0d7c311084e31">c734c6f</a>).</li><li>An invalid exception message mentioning OpenIddict was reworded (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/cd83912b47239ab7a47b6e8b4c312044890e9e84">cd83912</a>).</li><li>The authorization code/access token/identity token/refresh token deserialization methods are no longer called twice for introspection and revocation requests that specify a <code>token_type_hint</code> that doesn't match the actual token type (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/c561a3418daefda64f7bd27ae5d9b2f0dce03e27">c561a34</a>).</li><li>A standard-compliant <code>Expires</code> HTTP header is now returned by the non-interactive ASOS endpoints (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/5af1d44f933a1c81f1e159ac2cb7ee949e863d15">5af1d44</a>).</li><li>New constants have been added to <code>OpenIdConnectConstants</code> (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/0980fb8836daeb02edeea9efd53dc75965c678e5">0980fb8</a>) (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/461ecd44c6b1398a43f9ce7462718941476dbcf1">461ecd4</a>).</li><li>New events allowing to control the sign-in, sign-out and challenge operations have been introduced (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/d95810b28167409b8b9e60059568341fef113eb8">d95810b</a>) (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/3801427b4a69a927b7ec56156e92b66caba92eee">3801427</a>).</li></ul><h3 id="In-AspNet-Security-OpenIdConnect-Server-2-0-0-rc1-final"><a href="#In-AspNet-Security-OpenIdConnect-Server-2-0-0-rc1-final" class="headerlink" title="In AspNet.Security.OpenIdConnect.Server 2.0.0-rc1-final"></a>In AspNet.Security.OpenIdConnect.Server 2.0.0-rc1-final</h3><h4 id="OpenIdConnectServerProvider-can-now-be-resolved-from-the-DI-container"><a href="#OpenIdConnectServerProvider-can-now-be-resolved-from-the-DI-container" class="headerlink" title="OpenIdConnectServerProvider can now be resolved from the DI container"></a><code>OpenIdConnectServerProvider</code> can now be resolved from the DI container</h4><p>Good news: <code>OpenIdConnectServerProvider</code> can now be used with dependency injection thanks to a huge refactoring of the ASP.NET Core 2.0 authentication stack, <a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/issues/275">that now implements the options-based pattern I recommended</a>.</p><p>To use constructor-injected dependencies in your provider, you can ask ASOS to resolve the provider instance at request-time by setting the new <code>OpenIdConnectServerOptions.ProviderType</code> option (which is a wrapper around <code>AuthenticationSchemeOptions.EventsType</code>):</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AuthorizationProvider</span> : <span class="title">OpenIdConnectServerProvider</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ApplicationContext _database;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AuthorizationProvider</span>(<span class="params">ApplicationContext database</span>)</span></span><br><span class="line">    {</span><br><span class="line">        _database = database;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Register your custom provider in the DI container.</span></span><br><span class="line">        services.AddScoped&lt;AuthorizationProvider&gt;();</span><br><span class="line"></span><br><span class="line">        services.AddAuthentication()</span><br><span class="line">            .AddOpenIdConnectServer(options =&gt;</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Ask ASOS to resolve the provider instance corresponding</span></span><br><span class="line">                <span class="comment">// to the specified type when an OIDC request is received.</span></span><br><span class="line">                options.ProviderType = <span class="keyword">typeof</span>(AuthorizationProvider);</span><br><span class="line">            });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="note info"><p>Such feature requires built-in support in the authentication stack and thus, is unfortunately not available in the OWIN/Katana version of ASOS 2.x.</p></div><h3 id="In-Owin-Security-OpenIdConnect-Server-2-0-0-rc1-final"><a href="#In-Owin-Security-OpenIdConnect-Server-2-0-0-rc1-final" class="headerlink" title="In Owin.Security.OpenIdConnect.Server 2.0.0-rc1-final"></a>In Owin.Security.OpenIdConnect.Server 2.0.0-rc1-final</h3><p><strong>The OWIN/Katana version of ASOS 2.x now requires targeting the <code>Microsoft.Owin</code> <code>4.0.0-alpha1</code> packages</strong>, which are natively compatible with IdentityModel 5.2.0-preview1 (unlike the previous iteration).</p><h3 id="In-OpenIddict-1-0-0-rc1-final-and-2-0-0-rc1-final"><a href="#In-OpenIddict-1-0-0-rc1-final-and-2-0-0-rc1-final" class="headerlink" title="In OpenIddict 1.0.0-rc1-final and 2.0.0-rc1-final"></a>In OpenIddict 1.0.0-rc1-final and 2.0.0-rc1-final</h3><p>OpenIddict 1.0.0-rc1-final/2.0.0-rc1-final is the first public version of OpenIddict. To learn more about the changes added since the first betas, don't hesitate to take a look at <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/issues?q=milestone:2.0.0-rc1">the GitHub repository</a>.</p><p class="article-more-link"><a href="/2017/10/20/the-new-asos-and-openiddict-packages-are-now-on-nuget-org/">Read more</a></p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2017/10/20/the-new-asos-and-openiddict-packages-are-now-on-nuget-org/" data-id="clj0c62cc001smki2fx1edyfy" class="article-share-link">Share</a> <a href="/2017/10/20/the-new-asos-and-openiddict-packages-are-now-on-nuget-org/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li></ul></footer></div></article><article id="post-using-azure-key-vault-with-asos-and-openiddict" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2017/08/15/using-azure-key-vault-with-asos-and-openiddict/">Using Azure Key Vault with ASOS and OpenIddict</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/08/15/using-azure-key-vault-with-asos-and-openiddict/"><time datetime="2017-08-15T15:00:00.000Z" itemprop="datePublished">2017-08-15</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Last week, I received an email from someone who was asking me whether <strong>ASOS or OpenIddict could be used with Azure Key Vault</strong> (Microsoft's cloud-based Hardware Security Module offer). Since it's quite a recurring question, I thought it was worth writing a blog post to demonstrate how to do that.</p><p>So, good news: <strong>this is definitely possible</strong>! And thanks to <a target="_blank" rel="noopener" href="https://github.com/onovotny/RSAKeyVaultProvider">a new project</a> released recently by <a target="_blank" rel="noopener" href="https://github.com/onovotny">Oren Novotny</a>, this has never been so easy.</p><h2 id="What-is-a-Hardware-Security-Module"><a href="#What-is-a-Hardware-Security-Module" class="headerlink" title="What is a Hardware Security Module?"></a>What is a Hardware Security Module?</h2><p>A HSM is a <strong>hardened device</strong> – generally a PCI board or a standalone appliance – that is exclusively <strong>dedicated to cryptographic operations</strong> (data encryption/decryption, data signing/verification, key management, etc.). Though HSMs are complex systems, the main idea is actually simple: <strong>key material should never leave the HSM's secure enclave</strong>, which is protected against physical or digital intrusions.</p><p>As such, when a service requires encrypting or signing data (e.g a JWT access token in our case), it has to ask the Hardware Security Module to execute the cryptographic operation on its behalf.</p><h2 id="Use-Azure-Key-Vault-to-sign-the-JWT-tokens-issued-by-ASOS-x2F-OpenIddict"><a href="#Use-Azure-Key-Vault-to-sign-the-JWT-tokens-issued-by-ASOS-x2F-OpenIddict" class="headerlink" title="Use Azure Key Vault to sign the JWT tokens issued by ASOS/OpenIddict"></a>Use Azure Key Vault to sign the JWT tokens issued by ASOS/OpenIddict</h2><h3 id="Create-a-new-HSM-key-and-register-a-client-application-allowed-to-access-it"><a href="#Create-a-new-HSM-key-and-register-a-client-application-allowed-to-access-it" class="headerlink" title="Create a new HSM key and register a client application allowed to access it"></a>Create a new HSM key and register a client application allowed to access it</h3><p>If you don't have a key yet, you'll have to create one, register a new application in the Azure Active Directory database and grant it an access to your signing key. If you're not familiar with this procedure, I encourage you to read <a target="_blank" rel="noopener" href="https://www.humankode.com/asp-net-core/how-to-store-secrets-in-azure-key-vault-using-net-core">this tutorial</a> or watch the corresponding video:</p><div class="video-container"><iframe src="https://www.youtube.com/embed/cdoY_pnqPiA" frameborder="0" loading="lazy" allowfullscreen></iframe></div><div class="note info"><p><strong>Azure Key Vault actually offers two pricing tiers: standard and premium</strong>. To be able to generate a HSM-protected key (referred to as "hardware key"), you <strong>must</strong> choose the premium tier when creating your vault. Don't worry, the difference between the two tiers is unbelievably marginal: at the time of writing, <a target="_blank" rel="noopener" href="https://azure.microsoft.com/en-us/pricing/details/key-vault/">$1/month per RSA 2048-bit key</a>.</p></div><p class="article-more-link"><a href="/2017/08/15/using-azure-key-vault-with-asos-and-openiddict/">Read more</a></p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2017/08/15/using-azure-key-vault-with-asos-and-openiddict/" data-id="clj0c62ca001omki2dz7c979p" class="article-share-link">Share</a> <a href="/2017/08/15/using-azure-key-vault-with-asos-and-openiddict/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/azure/" rel="tag">azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li></ul></footer></div></article><article id="post-aspnet-security-openidconnect-server-1-0-1-is-out" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2017/08/04/aspnet-security-openidconnect-server-1-0-1-is-out/">AspNet.Security.OpenIdConnect.Server 1.0.1 is out</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/08/04/aspnet-security-openidconnect-server-1-0-1-is-out/"><time datetime="2017-08-04T18:00:00.000Z" itemprop="datePublished">2017-08-04</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Earlier today, <strong>a patch release for the OpenID Connect server middleware (aka ASOS) was pushed</strong> to <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/AspNet.Security.OpenIdConnect.Server/">NuGet.org</a>.</p><p>Here's the changelog:</p><ul><li>The <code>MatchEndpointContext.Options</code> property that had been accidentally removed in 1.0.0 has been reintroduced in 1.0.1 (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/f17d9a4d0f747dd65de83a4ff898e68b37c9d34d">f17d9a4</a>).</li><li>An exception is now automatically thrown at startup when registering a signing certificate that is no longer or not yet valid (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/583be00898f09ff3a4ca8d7540e8d963fe56b8fd">583be00</a>).</li><li>Internal code relying on <code>JwtSecurityTokenHandler.CreateToken()</code>/<code>WriteToken()</code> has been updated to use <code>JwtSecurityTokenHandler.CreateEncodedJwt()</code> to ensure JWT tokens are not signed twice (<a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server/commit/a499f11cc5dceaf74c60d111c7c4268452cd8ddd">a499f11</a>).</li></ul><p>To migrate to the <code>1.0.1</code> packages, update your <code>project.json</code>/<code>.csproj</code> project file(s) manually or run the following command in the <a target="_blank" rel="noopener" href="https://docs.nuget.org/docs/start-here/using-the-package-manager-console">Package Manager Console</a>:</p><h4 id="ASP-NET-Core-1-x-version"><a href="#ASP-NET-Core-1-x-version" class="headerlink" title="ASP.NET Core 1.x version"></a>ASP.NET Core 1.x version</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Update-Package AspNet.Security.OpenIdConnect.Server -Version 1.0.1</span><br></pre></td></tr></tbody></table></figure><h4 id="OWIN-x2F-Katana-3-x-version"><a href="#OWIN-x2F-Katana-3-x-version" class="headerlink" title="OWIN/Katana 3.x version"></a>OWIN/Katana 3.x version</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Update-Package Owin.Security.OpenIdConnect.Server -Version 1.0.1</span><br></pre></td></tr></tbody></table></figure></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2017/08/04/aspnet-security-openidconnect-server-1-0-1-is-out/" data-id="clj0c62c9001lmki20t8geub1" class="article-share-link">Share</a> <a href="/2017/08/04/aspnet-security-openidconnect-server-1-0-1-is-out/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li></ul></footer></div></article><article id="post-aspnet-security-openidconnect-server-1-0-0-general-availability" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2017/05/08/aspnet-security-openidconnect-server-1-0-0-general-availability/">AspNet.Security.OpenIdConnect.Server 1.0.0 general availability</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/05/08/aspnet-security-openidconnect-server-1-0-0-general-availability/"><time datetime="2017-05-08T19:00:00.000Z" itemprop="datePublished">2017-05-08</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Today is a great day for me, as I just uploaded the ASOS 1.0.0 packages to NuGet.org, concluding a 3-year work on this library. <strong>A huge thanks to everyone – clients, sponsors, contributors, users – who helped me make this possible: ASOS wouldn't exist without your support!</strong></p><img src="/2017/05/08/aspnet-security-openidconnect-server-1-0-0-general-availability/thanks.gif"><h2 id="Migrating-to-1-0-0"><a href="#Migrating-to-1-0-0" class="headerlink" title="Migrating to 1.0.0"></a>Migrating to 1.0.0</h2><p>Migrating from <a href="/2017/03/14/migrating-to-aspnet-security-openidconnect-server-rc1/" title="ASOS RC1">ASOS RC1</a> to RTM should be rather smooth as no major change was adopted in this release, but there's an important requirement you must comply with to ensure your application still works correctly after the migration: <strong>you must also update the validation/introspection middleware to the 1.0.0 RTM version</strong> (the previous beta versions won't deliberately work):</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk.Web"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"AspNet.Security.OAuth.Introspection"</span> <span class="attr">Version</span>=<span class="string">"1.0.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"AspNet.Security.OAuth.Validation"</span> <span class="attr">Version</span>=<span class="string">"1.0.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"AspNet.Security.OpenIdConnect.Server"</span> <span class="attr">Version</span>=<span class="string">"1.0.0"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><div class="note warn"><p>If you use recent OpenIddict packages (that use ASOS 1.0.0) or if you explicitly downloaded <code>AspNet.Security.OpenIdConnect.Server</code> or <code>AspNet.Security.OAuth.Introspection</code> 1.0.0 from the aspnet-contrib MyGet feed, consider clearing your NuGet packages folder, <strong>as the bits published on NuGet.org slightly differ from the packages initially published on MyGet.org</strong> (e.g the ASOS package uploaded to NuGet.org offers ECDSA support when running on .NET Framework 4.7).</p><p>For that, close your VS instances, go to <code>C:\Users\[username]\.nuget\packages</code> (on Windows) or <code>~/.nuget/packages</code> (on macOS) and remove the following folders:</p><img src="/2017/05/08/aspnet-security-openidconnect-server-1-0-0-general-availability/aspnet-contrib-packages.png"><p>Then, re-open VS and restore your projects or run <code>dotnet restore</code> to download the latest binaries from NuGet.org.</p></div><h2 id="Support-lifecycle"><a href="#Support-lifecycle" class="headerlink" title="Support lifecycle"></a>Support lifecycle</h2><p>No software can reasonably ship without a solid support lifecycle and ASOS is no exception. To keep things simple, I've decided to adopt the same <a target="_blank" rel="noopener" href="https://www.microsoft.com/net/core/support">support policy as the one used by Microsoft for the .NET Core platform</a>, which means <strong>the aspnet-contrib 1.0.0 RTM packages will get critical fixes and security patches until at least July of 2018</strong>.</p><h2 id="What-39-s-next"><a href="#What-39-s-next" class="headerlink" title="What's next?"></a>What's next?</h2><p>The next big step is to port ASOS to the <a target="_blank" rel="noopener" href="https://github.com/aspnet/Security/issues/1179">new ASP.NET Core 2.0 authentication stack I helped redesign</a>, as <strong>the 1.0 ASOS bits won't work at all due to the massive breaking changes adopted in 2.0</strong> (e.g authentication handlers are now registered in the DI container and a unique authentication middleware handles everything at the pipeline level, in <code>Startup.Configure(IApplicationBuilder app)</code>.</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2017/05/08/aspnet-security-openidconnect-server-1-0-0-general-availability/" data-id="clj0c62c7001hmki2eb3b3sg2" class="article-share-link">Share</a> <a href="/2017/05/08/aspnet-security-openidconnect-server-1-0-0-general-availability/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li></ul></footer></div></article><nav id="page-nav"><a class="extend prev" rel="prev" href="/page/5/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/7/">Next &amp;raquo;</a></nav></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2023/07/05/connecting-windows-media-center-to-tvheadend-with-hdhrproxyiptv-an-alternative-to-dvblink/" class="title">Connecting Windows Media Center to Tvheadend with HDHRProxyIPTV: an alternative to DVBLink</a></p><p class="item-date"><time datetime="2023-07-05T18:00:00.000Z" itemprop="datePublished">2023-07-05</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/02/27/introducing-system-integration-support-for-the-openiddict-client/" class="title">Introducing system integration support for the OpenIddict client</a></p><p class="item-date"><time datetime="2023-02-27T16:00:00.000Z" itemprop="datePublished">2023-02-27</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/23/openiddict-4-0-general-availability/" class="title">OpenIddict 4.0 general availability</a></p><p class="item-date"><time datetime="2022-12-23T20:00:00.000Z" itemprop="datePublished">2022-12-23</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/" class="title">Getting started with the OpenIddict web providers</a></p><p class="item-date"><time datetime="2022-12-16T15:00:00.000Z" itemprop="datePublished">2022-12-16</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/06/22/openiddict-4-0-preview1-is-out/" class="title">OpenIddict 4.0 preview1 is out</a></p><p class="item-date"><time datetime="2022-06-22T18:00:00.000Z" itemprop="datePublished">2022-06-22</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">32</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">36</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dvblink/" rel="tag">dvblink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhomerun/" rel="tag">hdhomerun</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhrproxytv/" rel="tag">hdhrproxytv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">36</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">35</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tv/" rel="tag">tv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tvheadend/" rel="tag">tvheadend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2023 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>