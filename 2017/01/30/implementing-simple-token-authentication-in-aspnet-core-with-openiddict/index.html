<!DOCTYPE html><html><head><meta charset="utf-8"><title>Implementing simple token authentication in ASP.NET Core with OpenIddict | Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="In this post, discover how to add token authentication with OpenIddict by implementing the OAuth2 password flow."><meta property="og:type" content="article"><meta property="og:title" content="Implementing simple token authentication in ASP.NET Core with OpenIddict"><meta property="og:url" content="https://kevinchalet.com/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/index.html"><meta property="og:site_name" content="Kévin Chalet's blog"><meta property="og:description" content="In this post, discover how to add token authentication with OpenIddict by implementing the OAuth2 password flow."><meta property="og:image" content="https://kevinchalet.com/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/token-request.png"><meta property="og:image" content="https://kevinchalet.com/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/api-request.png"><meta property="og:updated_time" content="2018-06-25T16:12:48.309Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Implementing simple token authentication in ASP.NET Core with OpenIddict"><meta name="twitter:description" content="In this post, discover how to add token authentication with OpenIddict by implementing the OAuth2 password flow."><meta name="twitter:image" content="https://kevinchalet.com/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/token-request.png"><meta name="twitter:creator" content="@PinpointTownes"><link rel="icon" href="/css/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script></head></html><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" href="https://twitter.com/intent/user?screen_name=PinpointTownes"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">25 <span>posts</span></div><div class="article-info-block">21 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a href="https://github.com/PinpointTownes" title="GitHub"><i class="fa fa-github"></i></a></td><td><a href="https://twitter.com/PinpointTownes" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a href="http://stackoverflow.com/users/542757/pinpoint" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-implementing-simple-token-authentication-in-aspnet-core-with-openiddict" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Implementing simple token authentication in ASP.NET Core with OpenIddict</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/"><time datetime="2017-01-30T18:00:00.000Z" itemprop="datePublished">2017-01-30</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Last year, <a href="https://github.com/mjrousos" target="_blank" rel="external">Mike Rousos</a> posted <a href="https://blogs.msdn.microsoft.com/webdev/2016/10/27/bearer-token-authentication-in-asp-net-core/" target="_blank" rel="external">a great post</a> about token authentication on the .NET blog and demonstrated how you could leverage ASP.NET Core Identity and OpenIddict to create your own tokens in a completely standard way.</p><p>Since then, many people emailed me to know if using ASP.NET Core Identity was really mandatory. Good news! While the first OpenIddict alpha bits were tied to Identity, the two have been completely decoupled as part of OpenIddict <code>beta1</code> and <code>beta2</code>. Concretely, this means <strong>you can now use OpenIddict with your own authentication method</strong> or your own membership stack.</p><hr><h2 id="Get-started"><a href="#Get-started" class="headerlink" title="Get started"></a>Get started</h2><div class="note info"><p>This post was updated to include code snippets demonstrating how to register OpenIddict in an ASP.NET Core 2.x application. <strong>When using OpenIddict in an ASP.NET Core 2.x application, make sure you&#39;re referencing the OpenIddict 2.x packages</strong>.</p></div><hr><h3 id="Update-your-csproj-file-to-reference-the-OpenIddict-packages"><a href="#Update-your-csproj-file-to-reference-the-OpenIddict-packages" class="headerlink" title="Update your .csproj file to reference the OpenIddict packages"></a>Update your <code>.csproj</code> file to reference the OpenIddict packages</h3><p>For this demo, you&#39;ll need to reference 2 packages:</p><ul><li><code>OpenIddict</code>, that references the core services, the token server and the validation services.</li><li><code>OpenIddict.EntityFrameworkCore</code>, that contains the Entity Framework Core stores.</li></ul><h4 id="ASP-NET-Core-1-x"><a href="#ASP-NET-Core-1-x" class="headerlink" title="ASP.NET Core 1.x"></a>ASP.NET Core 1.x</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk.Web"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"OpenIddict"</span> <span class="attr">Version</span>=<span class="string">"1.0.0-*"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"OpenIddict.EntityFrameworkCore"</span> <span class="attr">Version</span>=<span class="string">"1.0.0-*"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></div></pre></td></tr></table></figure><h4 id="ASP-NET-Core-2-x"><a href="#ASP-NET-Core-2-x" class="headerlink" title="ASP.NET Core 2.x"></a>ASP.NET Core 2.x</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk.Web"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"OpenIddict"</span> <span class="attr">Version</span>=<span class="string">"2.0.0-*"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"OpenIddict.EntityFrameworkCore"</span> <span class="attr">Version</span>=<span class="string">"2.0.0-*"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></div></pre></td></tr></table></figure><a id="more"></a><hr><h3 id="Register-the-OpenIddict-services-in-the-DI-container-and-the-ASP-NET-Core-pipeline"><a href="#Register-the-OpenIddict-services-in-the-DI-container-and-the-ASP-NET-Core-pipeline" class="headerlink" title="Register the OpenIddict services in the DI container and the ASP.NET Core pipeline"></a>Register the OpenIddict services in the DI container and the ASP.NET Core pipeline</h3><h4 id="ASP-NET-Core-1-x-1"><a href="#ASP-NET-Core-1-x-1" class="headerlink" title="ASP.NET Core 1.x"></a>ASP.NET Core 1.x</h4><figure class="highlight csharp"><figcaption><span>Startup.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></div><div class="line">    &#123;</div><div class="line">        services.AddMvc();</div><div class="line"></div><div class="line">        services.AddDbContext&lt;DbContext&gt;(options =&gt;</div><div class="line">        &#123;</div><div class="line">            <span class="comment">// Configure the context to use an in-memory store.</span></div><div class="line">            options.UseInMemoryDatabase();</div><div class="line"></div><div class="line">            <span class="comment">// Register the entity sets needed by OpenIddict.</span></div><div class="line">            <span class="comment">// Note: use the generic overload if you need</span></div><div class="line">            <span class="comment">// to replace the default OpenIddict entities.</span></div><div class="line">            options.UseOpenIddict();</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        services.AddOpenIddict()</div><div class="line"></div><div class="line">            <span class="comment">// Register the OpenIddict core services.</span></div><div class="line">            .AddCore(options =&gt;</div><div class="line">            &#123;</div><div class="line">                <span class="comment">// Configure OpenIddict to use the EF Core stores/models.</span></div><div class="line">                options.UseEntityFrameworkCore()</div><div class="line">                       .UseDbContext&lt;DbContext&gt;();</div><div class="line">            &#125;)</div><div class="line"></div><div class="line">            <span class="comment">// Register the OpenIddict server handler.</span></div><div class="line">            .AddServer(options =&gt;</div><div class="line">            &#123;</div><div class="line">                <span class="comment">// Register the ASP.NET Core MVC services used by OpenIddict.</span></div><div class="line">                <span class="comment">// Note: if you don't call this method, you won't be able to</span></div><div class="line">                <span class="comment">// bind OpenIdConnectRequest or OpenIdConnectResponse parameters.</span></div><div class="line">                options.UseMvc();</div><div class="line"></div><div class="line">                <span class="comment">// Enable the token endpoint.</span></div><div class="line">                options.EnableTokenEndpoint(<span class="string">"/connect/token"</span>);</div><div class="line"></div><div class="line">                <span class="comment">// Enable the password flow.</span></div><div class="line">                options.AllowPasswordFlow();</div><div class="line"></div><div class="line">                <span class="comment">// Accept anonymous clients (i.e clients that don't send a client_id).</span></div><div class="line">                options.AcceptAnonymousClients();</div><div class="line"></div><div class="line">                <span class="comment">// During development, you can disable the HTTPS requirement.</span></div><div class="line">                options.DisableHttpsRequirement();</div><div class="line">            &#125;)</div><div class="line"></div><div class="line">            <span class="comment">// Register the OpenIddict validation handler.</span></div><div class="line">            <span class="comment">// Note: the OpenIddict validation handler is only compatible with the</span></div><div class="line">            <span class="comment">// default token format or with reference tokens and cannot be used with</span></div><div class="line">            <span class="comment">// JWT tokens. For JWT tokens, use the Microsoft JWT bearer handler.</span></div><div class="line">            .AddValidation();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Register the OpenIddict token validation middleware.</span></div><div class="line">        app.UseOpenIddictValidation();</div><div class="line"></div><div class="line">        <span class="comment">// Register the OpenIddict server middleware.</span></div><div class="line">        app.UseOpenIddictServer();</div><div class="line"></div><div class="line">        app.UseMvcWithDefaultRoute();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><div class="note info"><p>Make sure to <strong>always register the validation middleware very early in your pipeline</strong>: if the validation middleware is not at the right place, requests won&#39;t be correctly authenticated when reaching the next middleware (e.g MVC).</p><p>The same remark applies to OpenIddict, that must be inserted before MVC to validate token requests before they reach your own code. If you don&#39;t register it correctly, an exception will be thrown at runtime.</p></div><h4 id="ASP-NET-Core-2-x-1"><a href="#ASP-NET-Core-2-x-1" class="headerlink" title="ASP.NET Core 2.x"></a>ASP.NET Core 2.x</h4><figure class="highlight csharp"><figcaption><span>Startup.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></div><div class="line">    &#123;</div><div class="line">        services.AddMvc();</div><div class="line"></div><div class="line">        services.AddDbContext&lt;DbContext&gt;(options =&gt;</div><div class="line">        &#123;</div><div class="line">            <span class="comment">// Configure the context to use an in-memory store.</span></div><div class="line">            options.UseInMemoryDatabase(<span class="keyword">nameof</span>(DbContext));</div><div class="line"></div><div class="line">            <span class="comment">// Register the entity sets needed by OpenIddict.</span></div><div class="line">            <span class="comment">// Note: use the generic overload if you need</span></div><div class="line">            <span class="comment">// to replace the default OpenIddict entities.</span></div><div class="line">            options.UseOpenIddict();</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        services.AddOpenIddict()</div><div class="line"></div><div class="line">            <span class="comment">// Register the OpenIddict core services.</span></div><div class="line">            .AddCore(options =&gt;</div><div class="line">            &#123;</div><div class="line">                <span class="comment">// Configure OpenIddict to use the EF Core stores/models.</span></div><div class="line">                options.UseEntityFrameworkCore()</div><div class="line">                       .UseDbContext&lt;DbContext&gt;();</div><div class="line">            &#125;)</div><div class="line"></div><div class="line">            <span class="comment">// Register the OpenIddict server handler.</span></div><div class="line">            .AddServer(options =&gt;</div><div class="line">            &#123;</div><div class="line">                <span class="comment">// Register the ASP.NET Core MVC services used by OpenIddict.</span></div><div class="line">                <span class="comment">// Note: if you don't call this method, you won't be able to</span></div><div class="line">                <span class="comment">// bind OpenIdConnectRequest or OpenIdConnectResponse parameters.</span></div><div class="line">                options.UseMvc();</div><div class="line"></div><div class="line">                <span class="comment">// Enable the token endpoint.</span></div><div class="line">                options.EnableTokenEndpoint(<span class="string">"/connect/token"</span>);</div><div class="line"></div><div class="line">                <span class="comment">// Enable the password flow.</span></div><div class="line">                options.AllowPasswordFlow();</div><div class="line"></div><div class="line">                <span class="comment">// Accept anonymous clients (i.e clients that don't send a client_id).</span></div><div class="line">                options.AcceptAnonymousClients();</div><div class="line"></div><div class="line">                <span class="comment">// During development, you can disable the HTTPS requirement.</span></div><div class="line">                options.DisableHttpsRequirement();</div><div class="line">            &#125;)</div><div class="line"></div><div class="line">            <span class="comment">// Register the OpenIddict validation handler.</span></div><div class="line">            <span class="comment">// Note: the OpenIddict validation handler is only compatible with the</span></div><div class="line">            <span class="comment">// default token format or with reference tokens and cannot be used with</span></div><div class="line">            <span class="comment">// JWT tokens. For JWT tokens, use the Microsoft JWT bearer handler.</span></div><div class="line">            .AddValidation();</div><div class="line"></div><div class="line">        services.AddAuthentication(options =&gt;</div><div class="line">        &#123;</div><div class="line">            options.DefaultScheme = OpenIddictValidationDefaults.AuthenticationScheme;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app</span>)</span></div><div class="line">    &#123;</div><div class="line">        app.UseAuthentication();</div><div class="line"></div><div class="line">        app.UseMvcWithDefaultRoute();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h3 id="Create-your-own-token-authentication-controller"><a href="#Create-your-own-token-authentication-controller" class="headerlink" title="Create your own token authentication controller"></a>Create your own token authentication controller</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AuthorizationController</span> : <span class="title">Controller</span></div><div class="line">&#123;</div><div class="line">    [HttpPost(<span class="string">"~/connect/token"</span>), Produces(<span class="string">"application/json"</span>)]</div><div class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Exchange</span>(<span class="params">OpenIdConnectRequest request</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (request.IsPasswordGrantType())</div><div class="line">        &#123;</div><div class="line">            <span class="comment">// Validate the user credentials.</span></div><div class="line"></div><div class="line">            <span class="comment">// Note: to mitigate brute force attacks, you SHOULD strongly consider</span></div><div class="line">            <span class="comment">// applying a key derivation function like PBKDF2 to slow down</span></div><div class="line">            <span class="comment">// the password validation process. You SHOULD also consider</span></div><div class="line">            <span class="comment">// using a time-constant comparer to prevent timing attacks.</span></div><div class="line">            <span class="keyword">if</span> (request.Username != <span class="string">"alice@wonderland.com"</span> ||</div><div class="line">                request.Password != <span class="string">"P@ssw0rd"</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">return</span> Forbid(OpenIddictServerDefaults.AuthenticationScheme);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// Create a new ClaimsIdentity holding the user identity.</span></div><div class="line">            <span class="keyword">var</span> identity = <span class="keyword">new</span> ClaimsIdentity(</div><div class="line">                OpenIddictServerDefaults.AuthenticationScheme,</div><div class="line">                OpenIdConnectConstants.Claims.Name,</div><div class="line">                OpenIdConnectConstants.Claims.Role);</div><div class="line"></div><div class="line">            <span class="comment">// Add a "sub" claim containing the user identifier, and attach</span></div><div class="line">            <span class="comment">// the "access_token" destination to allow OpenIddict to store it</span></div><div class="line">            <span class="comment">// in the access token, so it can be retrieved from your controllers.</span></div><div class="line">            identity.AddClaim(OpenIdConnectConstants.Claims.Subject,</div><div class="line">                <span class="string">"71346D62-9BA5-4B6D-9ECA-755574D628D8"</span>,</div><div class="line">                OpenIdConnectConstants.Destinations.AccessToken);</div><div class="line"></div><div class="line">            identity.AddClaim(OpenIdConnectConstants.Claims.Name, <span class="string">"Alice"</span>,</div><div class="line">                OpenIdConnectConstants.Destinations.AccessToken);</div><div class="line"></div><div class="line">            <span class="comment">// ... add other claims, if necessary.</span></div><div class="line"></div><div class="line">            <span class="keyword">var</span> principal = <span class="keyword">new</span> ClaimsPrincipal(identity);</div><div class="line"></div><div class="line">            <span class="comment">// Ask OpenIddict to generate a new token and return an OAuth2 token response.</span></div><div class="line">            <span class="keyword">return</span> SignIn(principal, OpenIddictServerDefaults.AuthenticationScheme);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">"The specified grant type is not supported."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h3 id="Create-an-API-controller"><a href="#Create-an-API-controller" class="headerlink" title="Create an API controller"></a>Create an API controller</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ApiController</span> : <span class="title">Controller</span></div><div class="line">&#123;</div><div class="line">    [Authorize, HttpGet(<span class="string">"~/api/test"</span>)]</div><div class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetMessage</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> Json(<span class="keyword">new</span></div><div class="line">        &#123;</div><div class="line">            Subject = User.GetClaim(OpenIdConnectConstants.Claims.Subject),</div><div class="line">            Name = User.Identity.Name</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h2 id="Test-your-ASP-NET-Core-application"><a href="#Test-your-ASP-NET-Core-application" class="headerlink" title="Test your ASP.NET Core application"></a>Test your ASP.NET Core application</h2><h3 id="Retrieve-an-access-token-from-your-authentication-controller"><a href="#Retrieve-an-access-token-from-your-authentication-controller" class="headerlink" title="Retrieve an access token from your authentication controller"></a>Retrieve an access token from your authentication controller</h3><p>To retrieve an access token, send a <code>POST</code> request to <code>/connect/token</code> with the <code>grant_type=password</code> parameter and the user credentials:</p><img src="/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/token-request.png" alt="token-request.png"><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">POST</span> <span class="string">/connect/token</span> HTTP/1.1</div><div class="line"><span class="attribute">Host</span>: localhost:7096</div><div class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</div><div class="line"></div><div class="line"><span class="undefined">grant_type=password&amp;username=alice%40wonderland.com&amp;password=P%40ssw0rd</span></div></pre></td></tr></table></figure><p>If the credentials are valid, you&#39;ll get a JSON response containing the access token:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"token_type"</span>: <span class="string">"Bearer"</span>,</div><div class="line">  <span class="string">"access_token"</span>: <span class="string">"CfDJ8Ec0ZpniaHhGg0e0UUvOH9BWZSGrPoEwGd0_Lq2cse-T29YOq985IBiT5fEe5tTSgY1vxq2Z2ZJ7Ikwlpmh0Lrc4x9pqhqHBziUzsP_rkGZkn47TkNkOkzKCwZJZK5x-irH3HROwClFFTq0rgWdb8rZ2xriffNzsby4VwhxhN5soFD435KzmVYkdv-VuaLYo3QiSuexbRi2USVO9LK30vomAG6h2SAxZ7R-jYsXgf0f5gAmdYxg7w3yicv9v8DpUSBiGGRRfymTOnvGEsFJjGuuP8OlY5qzMs6wGaRWkOvCyV2CK_RZF_3TMs7LYCdMQ-dqWY5A03-03OmP8blKzlrKJMDZfrPQHuysbS931xxy8b3kjicfjNLmMHqzQzbUO4fecm4kY8PFnKozojDtqajfTp2bYhxS65bmVYROrswYeUWEKYR6LSdS1K__IDaLoMlLa-Wf6x1wjM2CchzgqbHRF0KEtdL5Ks88dAS44mp9BM6iUOEWyL7VkbazsBdlNciM5ZZB1_6qunufDW_tcaR8"</span>,</div><div class="line">  <span class="string">"expires_in"</span>: <span class="number">3600</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h3 id="Query-your-API-controller-using-a-bearer-token"><a href="#Query-your-API-controller-using-a-bearer-token" class="headerlink" title="Query your API controller using a bearer token"></a>Query your API controller using a bearer token</h3><p>To send an authenticated request, simply attach the bearer token to the <code>Authorization</code> header using the following syntax: <code>Authorization: Bearer [your bearer token]</code> (without the square brackets)</p><img src="/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/api-request.png" alt="api-request.png"><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GET</span> <span class="string">/api/test</span> HTTP/1.1</div><div class="line"><span class="attribute">Host</span>: localhost:7096</div><div class="line"><span class="attribute">Authorization</span>: Bearer CfDJ8Ec0ZpniaHhGg0e0UUvOH9BWZSGrPoEwGd0_Lq2cse-T29YOq985IBiT5fEe5tTSgY1vxq2Z2ZJ7Ikwlpmh0Lrc4x9pqhqHBziUzsP_rkGZkn47TkNkOkzKCwZJZK5x-irH3HROwClFFTq0rgWdb8rZ2xriffNzsby4VwhxhN5soFD435KzmVYkdv-VuaLYo3QiSuexbRi2USVO9LK30vomAG6h2SAxZ7R-jYsXgf0f5gAmdYxg7w3yicv9v8DpUSBiGGRRfymTOnvGEsFJjGuuP8OlY5qzMs6wGaRWkOvCyV2CK_RZF_3TMs7LYCdMQ-dqWY5A03-03OmP8blKzlrKJMDZfrPQHuysbS931xxy8b3kjicfjNLmMHqzQzbUO4fecm4kY8PFnKozojDtqajfTp2bYhxS65bmVYROrswYeUWEKYR6LSdS1K__IDaLoMlLa-Wf6x1wjM2CchzgqbHRF0KEtdL5Ks88dAS44mp9BM6iUOEWyL7VkbazsBdlNciM5ZZB1_6qunufDW_tcaR8</div></pre></td></tr></table></figure><p>If the access token is valid, you&#39;ll get a JSON payload containing the user details returned by the API:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"subject"</span>: <span class="string">"71346D62-9BA5-4B6D-9ECA-755574D628D8"</span>,</div><div class="line">  <span class="string">"name"</span>: <span class="string">"Alice"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>And voilà, that&#39;s done.</p><p>Got a question? Feel free to post a comment or open a new thread <a href="https://stackoverflow.com/questions/tagged/openiddict" target="_blank" rel="external">on StackOverflow</a>.</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/" data-id="cjnytjt7s0004csi20fsefcdh" class="article-share-link">Share</a> <a href="/2017/01/30/implementing-simple-token-authentication-in-aspnet-core-with-openiddict/#disqus_thread" class="article-comment-link">Comments</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/">openiddict</a></li></ul></footer></div><nav id="article-nav"><a href="/2017/03/14/migrating-to-aspnet-security-openidconnect-server-rc1/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">Migrating to AspNet.Security.OpenIdConnect.Server RC1</div></a><a href="/2016/11/30/the-new-aspnet-contrib-packages-are-out/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">The new aspnet-contrib packages are out</div></a></nav></article><section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2018/11/01/openiddict-1-0-and-2-0-general-availability/" class="title">OpenIddict 1.0 and 2.0 general availability</a></p><p class="item-date"><time datetime="2018-11-01T20:00:00.000Z" itemprop="datePublished">2018-11-01</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/10/07/highway-to-dll-hell/" class="title">Highway to (DLL) Hell</a></p><p class="item-date"><time datetime="2018-10-07T13:00:00.000Z" itemprop="datePublished">2018-10-07</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/08/08/session-fixation-vulnerability-in-the-auth0-asp-net-and-owin-sdks/" class="title">Session fixation vulnerability in the Auth0 ASP.NET and OWIN SDKs</a></p><p class="item-date"><time datetime="2018-08-08T17:00:00.000Z" itemprop="datePublished">2018-08-08</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/07/02/implementing-advanced-scenarios-using-the-new-openiddict-rc3-events-model/" class="title">Implementing advanced scenarios using the new OpenIddict RC3 events model</a></p><p class="item-date"><time datetime="2018-07-02T16:15:00.000Z" itemprop="datePublished">2018-07-02</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2018/06/20/openiddict-rc3-is-out/" class="title">OpenIddict RC3 is out</a></p><p class="item-date"><time datetime="2018-06-20T14:00:00.000Z" itemprop="datePublished">2018-06-20</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">25</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/">asp.net core</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/">aspnet-contrib</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/">auth0</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/">authentication</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/">jwt</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/">oauth</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/">openid connect</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/">openiddict</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/">owin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/">windows media center</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2018 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script>var disqus_shortname="kevinchalet";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body>