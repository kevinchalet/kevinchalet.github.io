<!DOCTYPE html><html><head><meta charset="utf-8"><title>Introducing the OpenIddict client | Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="When I unveiled the OpenIddict 3.0 roadmap three years ago, I mentioned that having an OpenIddict client would be a very nice addition but that implementing it as part of 3.0 wasn&#39;t realistic. Today,"><meta property="og:type" content="article"><meta property="og:title" content="Introducing the OpenIddict client"><meta property="og:url" content="https://kevinchalet.com/2022/02/25/introducing-the-openiddict-client/index.html"><meta property="og:site_name" content="Kévin Chalet&#39;s blog"><meta property="og:description" content="When I unveiled the OpenIddict 3.0 roadmap three years ago, I mentioned that having an OpenIddict client would be a very nice addition but that implementing it as part of 3.0 wasn&#39;t realistic. Today,"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2022-02-25T21:00:00.000Z"><meta property="article:modified_time" content="2022-06-18T14:57:38.000Z"><meta property="article:author" content="Kévin Chalet"><meta property="article:tag" content="asp.net core"><meta property="article:tag" content="authentication"><meta property="article:tag" content="jwt"><meta property="article:tag" content="oauth"><meta property="article:tag" content="openid connect"><meta property="article:tag" content="openiddict"><meta property="article:tag" content="aspnet-contrib"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="https://kevinchalet.com/assets/photo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">46 <span>posts</span></div><div class="article-info-block">37 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-introducing-the-openiddict-client" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Introducing the OpenIddict client</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2022/02/25/introducing-the-openiddict-client/"><time datetime="2022-02-25T21:00:00.000Z" itemprop="datePublished">2022-02-25</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>When I unveiled the <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/issues/736">OpenIddict 3.0 roadmap three years ago</a>, I mentioned that having an OpenIddict client would be a very nice addition but that implementing it as part of 3.0 wasn't realistic. Today, I'm very happy to announce that <strong>the OpenIddict client will ship as part of OpenIddict's next major version</strong>.</p><h2 id="Why-a-new-client"><a href="#Why-a-new-client" class="headerlink" title="Why a new client?"></a>Why a new client?</h2><p>A few client libraries already exist for .NET, including:</p><ul><li>For ASP.NET Core, <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/tree/main/src/Security/Authentication/OAuth/src">an OAuth 2.0 base handler developed by Microsoft</a> that we massively use for the <a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers">aspnet-contrib project</a> (more than 80 OAuth 2.0 services are supported at the time of writing!)</li><li>For ASP.NET Core, <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/tree/main/src/Security/Authentication/OpenIdConnect/src">an OpenID Connect handler developed by Microsoft</a>.</li><li>For ASP.NET 4.x/OWIN, <a target="_blank" rel="noopener" href="https://github.com/aspnet/AspNetKatana/tree/dev/src/Microsoft.Owin.Security.OpenIdConnect">an OpenID Connect middleware maintained by Microsoft</a>.</li><li>For console and GUI applications, <a target="_blank" rel="noopener" href="https://github.com/IdentityModel/IdentityModel.OidcClient">a certified OpenID Connect client developed by Duende Software</a>.</li><li>For Blazor WASM applications, <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/tree/main/src/Components/WebAssembly/WebAssembly.Authentication/src">an OpenID Connect integration based on the oidc-client-js library</a>.</li></ul><p>So why do we need another one? Am I reinventing the wheel by introducing another OIDC client stack?</p><p>Well, that's definitely a legit question. First, I have to say that these implementations work just fine and that I've used them happily other the years. Actually, I even contributed <a target="_blank" rel="noopener" href="https://github.com/aspnet/Security/pulls?q=is:pr+author:kevinchalet+is:closed">to some of these implementations multiple times</a> so I have a fairly good experience working with them.</p><p>In a nutshell, here's what motivated me:</p><ul><li><p>While all these libraries offer very specialized implementations, <strong>none of them offers a unified experience</strong> that allowing sharing a common code base usable on, say, ASP.NET Core and Blazor WASM applications: what you learned about the ASP.NET Core OIDC handler is not applicable to Blazor WASM, that uses a completely different OIDC client stack under the hood.</p></li><li><p><strong>The OIDC integration for Blazor WASM uses <a target="_blank" rel="noopener" href="https://github.com/IdentityModel/oidc-client-js">oidc-client-js</a>, that was archived in June 2021 and is no longer supported</strong>. While the Blazor OIDC wrapper itself is supported by Microsoft, the library it uses under the hood is not and won't receive any bug or security fix, which is a bit surprising to me, considering its author is still sponsored by Microsoft.</p></li><li><p>While it's supported by Microsoft, the Blazor OIDC wrapper doesn't actually get much love and <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/issues/39144">suffers from annoying design issues that affect OpenIddict users</a> that the team is unwilling to fix.</p></li><li><p>The OAuth 2.0 base handler for ASP.NET Core offers a straightforward API for creating derived OAuth 2.0 clients that we successfully used in the aspnet-contrib social providers. Unfortunately, its simplicity comes at a cost: <strong>it's not composable</strong>. Concretely, it means that every time we need to customize something (e.g adding a parameter to the token request), we end up duplicating more code than what we should (e.g to add a token request parameter, you also need to take care of sending the HTTP request and handling the response, which is something the OAuth 2.0 base handler does for you if you don't override the <code>OAuthHandler&lt;T&gt;.ExchangeCodeAsync(OAuthCodeExchangeContext context)</code> method).</p></li><li><p>There's also another downside with the OAuth 2.0 base handler: <strong>it doesn't support OpenID Connect</strong>. Yet, we received contributions to add OAuth 2.0 providers that also support OpenID Connect: while ASP.NET Core has a dedicated OIDC handler that is more appropriate for these cases, many people like the simpler registration story the OAuth 2.0 base handler and the aspnet-contrib providers offer. Retrospectively, we shouldn't have accepted these contributions as these providers don't benefit from the additional security checks a real OpenID Connect implementation requires (e.g <code>nonce</code>, <code>at_hash</code> or <code>c_hash</code> validation, etc.)</p></li><li><p>The OAuth 2.0 base handler doesn't support <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc8414">the OAuth 2.0 Authorization Server Metadata</a> specification that backported the OpenID Connect server discovery feature to the OAuth 2.0 world and that allows finding the location of the authorization and token endpoints dynamically, without having to hardcode them. While the adoption is slow, I'd expect more and more services to support it in the next few years.</p></li></ul><span id="more"></span><h2 id="Can-you-tell-me-more-about-this-new-client"><a href="#Can-you-tell-me-more-about-this-new-client" class="headerlink" title="Can you tell me more about this new client?"></a>Can you tell me more about this new client?</h2><p>Put simply, the OpenIddict client is closely modeled after the OpenIddict server and validation stacks and reuses many of their core concepts, including their extremely powerful events model, their modular approach and the host/transport-agnostic design of the core server and validation packages.</p><p>Concretely:</p><ul><li><p>The OpenIddict client <strong>will be usable with any OAuth 2.0 and OpenID Connect server</strong> (based on OpenIddict or not) and will heavily use client/server negotiation to adapt its validation routines to the targeted authorization servers to guarantee maximum compatibility while ensuring the best level of security.</p></li><li><p>The OpenIddict client <strong>currently supports ASP.NET Core 2.1 and higher</strong> and native support for ASP.NET 4.x/OWIN will be added in the next few weeks. I also started working on a Blazor WASM prototype and while there'll be limitations (e.g Blazor WASM's encryption/signing support is extremely limited), things are really promising.</p></li><li><p>The <strong>code, implicit and hybrid flows are all natively supported</strong> (except <code>response_type=token</code>, which is unsafe) and OpenIddict has built-in logic to select the best flow to use (unlike the ASP.NET Core OIDC handler that uses the hardcoded <code>response_type=id_token</code>). It's worth noting the OpenIddict client was designed to allow implementing additional flows (like the OpenID Connect Client-Initiated Backchannel Authentication Flow) without requiring massive design changes.</p></li><li><p>The OpenIddict client <strong>will allow supporting multiple static authorization servers</strong> (I currently don't plan on adding dynamic client registration support, but it's something that may be added in a future version).</p></li><li><p>The OpenIddict client <strong>uses a different approach for handling authorization callbacks</strong>: while the OAuth 2.0 and OIDC handlers developed by Microsoft typically handle everything for you by flowing the <code>ClaimsPrincipal</code> extracted from identity tokens/userinfo responses to another authentication handler (in most cases, an instance of the cookies authentication handler), the OpenIddict client won't have this logic and will offer exactly the same approach as the OpenIddict server stack by encouraging users to be involved in the creation of the authentication cookie during the callback handling.</p></li></ul><p>Concretely, the OpenIddict client will offer a pass-through mode to allow handling callbacks in a custom MVC action or minimal API handler. Here's an example of such an action:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: this controller uses the same callback action for all providers</span></span><br><span class="line"><span class="comment">// but for users who prefer using a different action per provider,</span></span><br><span class="line"><span class="comment">// the following action can be split into separate actions.</span></span><br><span class="line">[<span class="meta">HttpGet(<span class="string">"~/signin-{provider}"</span>), HttpPost(<span class="string">"~/signin-{provider}"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&gt; <span class="title">Callback</span>()</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// Retrieve the authorization data validated by OpenIddict as part of the callback handling.</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> HttpContext.AuthenticateAsync(OpenIddictClientAspNetCoreDefaults.AuthenticationScheme);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Multiple strategies exist to handle OAuth 2.0/OpenID Connect callbacks, each with their pros and cons:</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//   * Directly using the tokens to perform the necessary action(s) on behalf of the user, which is suitable</span></span><br><span class="line">    <span class="comment">//     for applications that don't need a long-term access to the user's resources or don't want to store</span></span><br><span class="line">    <span class="comment">//     access/refresh tokens in a database or in an authentication cookie (which has security implications).</span></span><br><span class="line">    <span class="comment">//     It is also suitable for applications that don't need to authenticate users but only need to perform</span></span><br><span class="line">    <span class="comment">//     action(s) on their behalf by making API calls using the access token returned by the remote server.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//   * Storing the external claims/tokens in a database (and optionally keeping the essential claims in an</span></span><br><span class="line">    <span class="comment">//     authentication cookie so that cookie size limits are not hit). For the applications that use ASP.NET</span></span><br><span class="line">    <span class="comment">//     Core Identity, the UserManager.SetAuthenticationTokenAsync() API can be used to store external tokens.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//     Note: in this case, it's recommended to use column encryption to protect the tokens in the database.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//   * Storing the external claims/tokens in an authentication cookie, which doesn't require having</span></span><br><span class="line">    <span class="comment">//     a user database but may be affected by the cookie size limits enforced by most browser vendors</span></span><br><span class="line">    <span class="comment">//     (e.g Safari for macOS and Safari for iOS/iPadOS enforce a per-domain 4KB limit for all cookies).</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//     Note: this is the approach used here, but the external claims are first filtered to only persist</span></span><br><span class="line">    <span class="comment">//     a few claims like the user identifier. The same approach is used to store the access/refresh tokens.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Important: if the remote server doesn't support OpenID Connect and doesn't expose a userinfo endpoint,</span></span><br><span class="line">    <span class="comment">// result.Principal.Identity will represent an unauthenticated identity and won't contain any claim.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Such identities cannot be used as-is to build an authentication cookie in ASP.NET Core (as the</span></span><br><span class="line">    <span class="comment">// antiforgery stack requires at least a name claim to bind CSRF cookies to the user's identity) but</span></span><br><span class="line">    <span class="comment">// the access/refresh tokens can be retrieved using result.Properties.GetTokens() to make API calls.</span></span><br><span class="line">    <span class="keyword">if</span> (result.Principal.Identity <span class="keyword">is</span> <span class="keyword">not</span> ClaimsIdentity { IsAuthenticated: <span class="literal">true</span> })</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">"The external authorization data cannot be used for authentication."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Build an identity based on the external claims and that will be used to create the authentication cookie.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// By default, all claims extracted during the authorization dance are available. The claims collection stored</span></span><br><span class="line">    <span class="comment">// in the cookie can be filtered out or mapped to different names depending the claim name or its issuer.</span></span><br><span class="line">    <span class="keyword">var</span> claims = <span class="keyword">new</span> List&lt;Claim&gt;(result.Principal.Claims</span><br><span class="line">        .Select(claim =&gt; claim <span class="keyword">switch</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// Map the standard "sub" and custom "id" claims to ClaimTypes.NameIdentifier, which is</span></span><br><span class="line">            <span class="comment">// the default claim type used by .NET and is required by the antiforgery components.</span></span><br><span class="line">            { Type: Claims.Subject } <span class="keyword">or</span></span><br><span class="line">            { Type: <span class="string">"id"</span>, Issuer: <span class="string">"https://github.com/"</span> <span class="keyword">or</span> <span class="string">"https://twitter.com/"</span> }</span><br><span class="line">                =&gt; <span class="keyword">new</span> Claim(ClaimTypes.NameIdentifier, claim.Value, claim.ValueType, claim.Issuer),</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Map the standard "name" claim to ClaimTypes.Name.</span></span><br><span class="line">            { Type: Claims.Name }</span><br><span class="line">                =&gt; <span class="keyword">new</span> Claim(ClaimTypes.Name, claim.Value, claim.ValueType, claim.Issuer),</span><br><span class="line"></span><br><span class="line">            _ =&gt; claim</span><br><span class="line">        })</span><br><span class="line">        .Where(claim =&gt; claim <span class="keyword">switch</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// Preserve the nameidentifier and name claims.</span></span><br><span class="line">            { Type: ClaimTypes.NameIdentifier <span class="keyword">or</span> ClaimTypes.Name } =&gt; <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Applications that use multiple client registrations can filter claims based on the issuer.</span></span><br><span class="line">            { Type: <span class="string">"bio"</span>, Issuer: <span class="string">"https://github.com/"</span> } =&gt; <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Don't preserve the other claims.</span></span><br><span class="line">            _ =&gt; <span class="literal">false</span></span><br><span class="line">        }));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> identity = <span class="keyword">new</span> ClaimsIdentity(claims,</span><br><span class="line">        authenticationType: CookieAuthenticationDefaults.AuthenticationScheme,</span><br><span class="line">        nameType: ClaimTypes.Name,</span><br><span class="line">        roleType: ClaimTypes.Role);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Build the authentication properties based on the properties that were added when the challenge was triggered.</span></span><br><span class="line">    <span class="keyword">var</span> properties = <span class="keyword">new</span> AuthenticationProperties(result.Properties.Items);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If needed, the tokens returned by the authorization server can be stored in the authentication cookie.</span></span><br><span class="line">    <span class="comment">// To make cookies less heavy, tokens that are not used are filtered out before creating the cookie.</span></span><br><span class="line">    properties.StoreTokens(result.Properties.GetTokens().Where(token =&gt; token <span class="keyword">switch</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Preserve the access and refresh tokens returned in the token response, if available.</span></span><br><span class="line">        {</span><br><span class="line">            Name: OpenIddictClientAspNetCoreConstants.Tokens.BackchannelAccessToken <span class="keyword">or</span></span><br><span class="line">                  OpenIddictClientAspNetCoreConstants.Tokens.RefreshToken</span><br><span class="line">        } =&gt; <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Ignore the other tokens.</span></span><br><span class="line">        _ =&gt; <span class="literal">false</span></span><br><span class="line">    }));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Note: "return SignIn(...)" cannot be directly used in this case, as the cookies handler doesn't allow</span></span><br><span class="line">    <span class="comment">// redirecting from an endpoint that doesn't match the path set in CookieAuthenticationOptions.LoginPath.</span></span><br><span class="line">    <span class="comment">// For more information about this restriction, visit https://github.com/dotnet/aspnetcore/issues/36934.</span></span><br><span class="line">    <span class="keyword">await</span> HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme, <span class="keyword">new</span> ClaimsPrincipal(identity), properties);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Redirect(properties.RedirectUri);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>By doing that, <strong>developers will have greater control over what's actually stored in their authentication cookies</strong> without requiring a claims mapping feature similar to what's used by the MSFT OIDC handler, that can sometimes be hard to use when you need to restore claims that are removed by the OIDC handler to help ensure the resulting authentication cookies don't hit cookie size limits.</p><ul><li><p>The OpenIddict client <strong>will be fully suitable for delegation-only scenarios where authentication is not needed</strong> or where the identification of the user who authorized the client is not possible (typically, OAuth 2.0-only servers that don't have a userinfo endpoint). In this case, no information about the user will be available but the tokens will still be available to perform any API call on his behalf.</p></li><li><p>Currently, only the authorization/authentication part is fully implemented: userinfo will come in the next few weeks and logout support at a later date.</p></li></ul><h2 id="What-39-s-next"><a href="#What-39-s-next" class="headerlink" title="What's next?"></a>What's next?</h2><p>I plan on working on a prototype evaluating the OpenIddict client as a potential replacement of the OAuth 2.0 base handler developed by Microsoft for the aspnet-contrib social providers. While the OpenIddict client is certainly a bit more complex, doing so would have interesting advantages:</p><ul><li><p>By being natively compatible with multiple environments (ASP.NET Core, ASP.NET 4.x, Blazor WASM), a broader audience of developers could be reached at no additional cost. This could be a nice migration option for those using <a target="_blank" rel="noopener" href="https://github.com/TerribleDev/OwinOAuthProviders">the OWIN OAuth providers</a> (by which the aspnet-contrib providers were initially inspired), that are sadly no longer under active development.</p></li><li><p>Unlike the OAuth 2.0 base handlers, the OpenIddict client natively supports the <code>client_secret_basic</code> client authentication method, which would save us from having code that is needed just to attach the client credentials to the <code>Authorization</code> header of token requests in all the providers that don't support <code>client_secret_post</code>.</p></li><li><p>By being natively composable, the events model could be used to eliminate code is not strictly required for the social providers to work (e.g if we need to simply attach a custom parameter, we shouldn't have to also send the HTTP request and handle the response in each provider).</p></li><li><p>The story for social providers supporting both OAuth 2.0 and OpenID Connect would be much better than with the OAuth 2.0 base handler, as they would automatically benefit from all the validation checks implemented in the core OpenIddict client without requiring custom code.</p></li><li><p>As the OpenIddict client supports both static and dynamic server configuration, social providers that implement discovery could be easily updated to use dynamic configuration, which is not possible with the OAuth 2.0 base handler (that requires hardcoded endpoints).</p></li></ul><p>This will certainly be points I'll discuss with <a target="_blank" rel="noopener" href="https://github.com/martincostello">Martin Costello</a> - who co-owns the aspnet-contrib OAuth 2.0 providers with me - once I have a fully working prototype.</p><p>You can see the OpenIddict client <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/blob/dev/sandbox/OpenIddict.Sandbox.AspNetCore.Client/Startup.cs">in action in the sandbox project</a>. <strong>If you're interesting in sharing your feedback, please don't hesitate to do so</strong> by posting a message <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/issues/1387">in the dedicated GitHub discussion</a>.</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2022/02/25/introducing-the-openiddict-client/" data-id="clz9gl8v30022hwi17r3x5qe3" class="article-share-link">Share</a> <a href="/2022/02/25/introducing-the-openiddict-client/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li></ul></footer></div><nav id="article-nav"><a href="/2022/06/22/openiddict-4-0-preview1-is-out/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">OpenIddict 4.0 preview1 is out</div></a><a href="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">ASP.NET Core 6 and authentication servers: the real bait and switch is not the one you think</div></a></nav></article><section id="comments"><div id="giscus_discussion"><script src="https://giscus.app/client.js" data-repo="kevinchalet/kevinchalet.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk2MTE2NjMwMw==" data-category="General" data-category-id="DIC_kwDOA6VS384CQu8O" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2023/12/18/openiddict-5-0-general-availability/" class="title">OpenIddict 5.0 general availability</a></p><p class="item-date"><time datetime="2023-12-18T16:00:00.000Z" itemprop="datePublished">2023-12-18</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/10/20/introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1/" class="title">Introducing native applications, per-client token lifetimes and client assertions support in OpenIddict 5.0 preview1</a></p><p class="item-date"><time datetime="2023-10-20T15:30:00.000Z" itemprop="datePublished">2023-10-20</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/10/04/can-you-use-the-asp-net-core-identity-api-endpoints-with-openiddict/" class="title">Can you use the ASP.NET Core Identity API endpoints with OpenIddict?</a></p><p class="item-date"><time datetime="2023-10-04T11:00:00.000Z" itemprop="datePublished">2023-10-04</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/07/05/connecting-windows-media-center-to-tvheadend-with-hdhrproxyiptv-an-alternative-to-dvblink/" class="title">Connecting Windows Media Center to Tvheadend with HDHRProxyIPTV: an alternative to DVBLink</a></p><p class="item-date"><time datetime="2023-07-05T18:00:00.000Z" itemprop="datePublished">2023-07-05</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/02/27/introducing-system-integration-support-for-the-openiddict-client/" class="title">Introducing system integration support for the OpenIddict client</a></p><p class="item-date"><time datetime="2023-02-27T16:00:00.000Z" itemprop="datePublished">2023-02-27</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dvblink/" rel="tag">dvblink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhomerun/" rel="tag">hdhomerun</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhrproxytv/" rel="tag">hdhrproxytv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/identity/" rel="tag">identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">34</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">38</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tv/" rel="tag">tv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tvheadend/" rel="tag">tvheadend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2024 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>