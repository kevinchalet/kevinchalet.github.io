<!DOCTYPE html><html><head><meta charset="utf-8"><title>Getting started with the OpenIddict web providers | Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Note: this blog post was updated to use the OpenIddict 4.8 packages.   Earlier this year, I unveiled the new web providers that will ship as part of the OpenIddict 4.0 release. To help users understan"><meta property="og:type" content="article"><meta property="og:title" content="Getting started with the OpenIddict web providers"><meta property="og:url" content="https://kevinchalet.com/2022/12/16/getting-started-with-the-openiddict-web-providers/index.html"><meta property="og:site_name" content="Kévin Chalet&#39;s blog"><meta property="og:description" content="Note: this blog post was updated to use the OpenIddict 4.8 packages.   Earlier this year, I unveiled the new web providers that will ship as part of the OpenIddict 4.0 release. To help users understan"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://kevinchalet.com/2022/12/16/getting-started-with-the-openiddict-web-providers/identity-ui.png"><meta property="article:published_time" content="2022-12-16T15:00:00.000Z"><meta property="article:modified_time" content="2023-10-07T16:44:30.391Z"><meta property="article:author" content="Kévin Chalet"><meta property="article:tag" content="asp.net core"><meta property="article:tag" content="aspnet-contrib"><meta property="article:tag" content="authentication"><meta property="article:tag" content="oauth"><meta property="article:tag" content="openid connect"><meta property="article:tag" content="openiddict"><meta property="article:tag" content="github"><meta property="article:tag" content="web providers"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://kevinchalet.com/2022/12/16/getting-started-with-the-openiddict-web-providers/identity-ui.png"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="https://kevinchalet.com/assets/photo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">44 <span>posts</span></div><div class="article-info-block">37 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-getting-started-with-the-openiddict-web-providers" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Getting started with the OpenIddict web providers</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/"><time datetime="2022-12-16T15:00:00.000Z" itemprop="datePublished">2022-12-16</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><div class="note tip"><p>Note: this blog post was updated to use the OpenIddict 4.8 packages.</p></div><p>Earlier this year, I unveiled <a href="/2022/02/25/introducing-the-openiddict-client/" title="the new web providers">the new web providers</a> that will ship as part of the OpenIddict 4.0 release.</p><p>To help users understand the differences between <a target="_blank" rel="noopener" href="https://www.nuget.org/profiles/aspnet-contrib">the existing aspnet-contrib providers</a> and the new OpenIddict-based providers, I also posted <a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers/issues/694">additional information on the aspnet-contrib repository</a> ; so if you're considering replacing the aspnet-contrib providers by their equivalent in OpenIddict, don't miss it.</p><p>Today, we're going to see how to easily get started by creating a minimal application that uses the <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/OpenIddict.Client.WebIntegration"><code>OpenIddict.Client.WebIntegration</code> package</a>.</p><p>At the time of writing, more than 60 providers are already available, but to keep things simple, we'll focus our attention on a single one: GitHub.</p><h2 id="Create-a-new-ASP-NET-Core-application"><a href="#Create-a-new-ASP-NET-Core-application" class="headerlink" title="Create a new ASP.NET Core application"></a>Create a new ASP.NET Core application</h2><p>For this step, we could use one of the Visual Studio templates, but since there's a trend towards doing things the "minimalistic" way, we're only going to add two files: a <code>.csproj</code> file containing the package references we'll need and a <code>Program.cs</code> file:</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk.Web"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>net7.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Nullable</span>&gt;</span>enable<span class="tag">&lt;/<span class="name">Nullable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImplicitUsings</span>&gt;</span>enable<span class="tag">&lt;/<span class="name">ImplicitUsings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"Microsoft.EntityFrameworkCore.InMemory"</span> <span class="attr">Version</span>=<span class="string">"7.0.10"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"OpenIddict.AspNetCore"</span> <span class="attr">Version</span>=<span class="string">"4.8.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"OpenIddict.EntityFrameworkCore"</span> <span class="attr">Version</span>=<span class="string">"4.8.0"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line">builder.WebHost.UseUrls(<span class="string">"https://localhost:44381/"</span>);</span><br><span class="line"></span><br><span class="line">builder.Services.AddAuthentication();</span><br><span class="line">builder.Services.AddAuthorization();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.UseAuthentication();</span><br><span class="line">app.UseAuthorization();</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> app.RunAsync();</span><br></pre></td></tr></tbody></table></figure><p>If you run this application as-is, all you'll get is a 404 response as we didn't register any HTTP handler. We'll get back to that in a few minutes.</p><span id="more"></span><h2 id="Create-a-new-GitHub-OAuth-application"><a href="#Create-a-new-GitHub-OAuth-application" class="headerlink" title="Create a new GitHub OAuth application"></a>Create a new GitHub OAuth application</h2><p>Whether you're using the new OpenIddict GitHub integration or any other OAuth 2.0 client, this step is unavoidable. But luckily, it's not that complicated and <a target="_blank" rel="noopener" href="https://docs.github.com/en/developers/apps/building-oauth-apps/creating-an-oauth-app">GitHub has an excellent guide to help you create your own OAuth app</a>.</p><p>You can of course use any application name for this sample, but you'll need to use an authorization callback URL that points to your application. In this case, we'll use <code>https://localhost:44381/callback/login/github</code> (GitHub doesn't require that the <code>redirect_uri</code> specified in authorization requests have the same exact port as the one configured in the application registration, so if you specified a different port in your <code>Program.cs</code>, it should work too).</p><p>If everything went smoothly, GitHub should give you a <code>client_id</code> and a <code>client_secret</code>: note them down as we'll need them in the next step.</p><h2 id="Add-the-OpenIddict-services"><a href="#Add-the-OpenIddict-services" class="headerlink" title="Add the OpenIddict services"></a>Add the OpenIddict services</h2><p>Like the rest of OpenIddict, the OpenIddict client and its web providers are registered using <code>IServiceCollection</code> extensions and builders:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddOpenIddict()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register the OpenIddict client components.</span></span><br><span class="line">    .AddClient(options =&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Allow the OpenIddict client to negotiate the authorization code flow.</span></span><br><span class="line">        options.AllowAuthorizationCodeFlow();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the signing and encryption credentials used to protect</span></span><br><span class="line">        <span class="comment">// sensitive data like the state tokens produced by OpenIddict.</span></span><br><span class="line">        options.AddDevelopmentEncryptionCertificate()</span><br><span class="line">               .AddDevelopmentSigningCertificate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the ASP.NET Core host and configure the ASP.NET Core-specific options.</span></span><br><span class="line">        options.UseAspNetCore()</span><br><span class="line">               .EnableRedirectionEndpointPassthrough();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the GitHub integration.</span></span><br><span class="line">        options.UseWebProviders()</span><br><span class="line">               .AddGitHub(options =&gt;</span><br><span class="line">               {</span><br><span class="line">                   options.SetClientId(<span class="string">"[your client identifier]"</span>)</span><br><span class="line">                          .SetClientSecret(<span class="string">"[your client secret]"</span>)</span><br><span class="line">                          .SetRedirectUri(<span class="string">"callback/login/github"</span>);</span><br><span class="line">               });</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure><div class="note tip"><p>Don't forget to replace the placeholders in the previous snippet by your actual <code>client_id</code> and <code>client_secret</code>.</p></div><p>Since <strong>the OpenIddict client is stateful</strong> (<em>unlike the ASP.NET Core OAuth 2.0 or OpenID Connect handlers</em>), we'll also need to configure a database that will be <strong>used to store the state tokens OpenIddict will create to prevent cross-site request forgery, session fixation and replay attacks</strong>.</p><p>To keep things simple, we'll use the OpenIddict Entity Framework Core stores with an in-memory database:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: the OpenIddict client is stateful by default and relies on a database to persist</span></span><br><span class="line"><span class="comment">// things like state tokens and provide additional protection against replay attacks.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// For a simple single-instance demo application, an in-memory database can be used safely.</span></span><br><span class="line">builder.Services.AddDbContext&lt;DbContext&gt;(options =&gt;</span><br><span class="line">{</span><br><span class="line">    options.UseInMemoryDatabase(<span class="string">"db"</span>);</span><br><span class="line">    options.UseOpenIddict();</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddOpenIddict()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register the OpenIddict core components.</span></span><br><span class="line">    .AddCore(options =&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Configure OpenIddict to use the Entity Framework Core stores and models.</span></span><br><span class="line">        options.UseEntityFrameworkCore()</span><br><span class="line">               .UseDbContext&lt;DbContext&gt;();</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure><h2 id="Add-HTTP-handlers-to-start-the-GitHub-authorization-process-and-handle-the-callback-request"><a href="#Add-HTTP-handlers-to-start-the-GitHub-authorization-process-and-handle-the-callback-request" class="headerlink" title="Add HTTP handlers to start the GitHub authorization process and handle the callback request"></a>Add HTTP handlers to start the GitHub authorization process and handle the callback request</h2><p>Last but not least, we'll also add two minimal actions that will respectively used to:</p><ol><li>Initiate a challenge that will redirect the user to GitHub's authorization endpoint.</li><li>Handle the authorization response returned by GitHub to the callback/redirection endpoint of our application. For now, this endpoint will simply return a text message indicating how many public repositories the user has:</li></ol><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a minimal action responsible for triggering a GitHub challenge</span></span><br><span class="line"><span class="comment">// and redirecting the user agent to the GitHub authorization endpoint.</span></span><br><span class="line">app.MapGet(<span class="string">"challenge"</span>, () =&gt; Results.Challenge(properties: <span class="literal">null</span>, authenticationSchemes: <span class="keyword">new</span>[] { Providers.GitHub }));</span><br></pre></td></tr></tbody></table></figure><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a minimal action responsible for handling the GitHub redirection callback.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Note: the OpenIddict client automatically validates the request before this action</span></span><br><span class="line"><span class="comment">// is invoked (e.g by ensuring the state token is valid) and takes care of redeeming</span></span><br><span class="line"><span class="comment">// the authorization code and retrieving the user information automatically. All the</span></span><br><span class="line"><span class="comment">// claims returned by the user information endpoint are available as Claim instances.</span></span><br><span class="line">app.MapMethods(<span class="string">"callback/login/github"</span>, <span class="keyword">new</span>[] { HttpMethods.Get, HttpMethods.Post }, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync(Providers.GitHub);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Results.Text(<span class="built_in">string</span>.Format(<span class="string">"{0} has {1} public repositories."</span>,</span><br><span class="line">        result.Principal!.FindFirst(<span class="string">"name"</span>)!.Value,</span><br><span class="line">        result.Principal!.FindFirst(<span class="string">"public_repos"</span>)!.Value));</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p>With these handlers in place, if you visit <code>https://localhost:44381/challenge</code>, you should be immediately redirected to GitHub and asked to approve the authorization request. Once you do so, you'll be redirected to <code>https://localhost:44381/callback/login/github</code> and a message similar to this one should be returned:</p><blockquote><p>Kévin Chalet has 21 public repositories.</p></blockquote><h2 id="Implement-different-callback-handling-strategies"><a href="#Implement-different-callback-handling-strategies" class="headerlink" title="Implement different callback handling strategies"></a>Implement different callback handling strategies</h2><p><strong>What happens in your callback endpoint is entirely up to you</strong>. While the previous snippet simply returned some text containing the name and the number of public repositories exposed by OpenIddict via <code>AuthenticateResult.Principal.Claims</code>, nothing prevents you from adopting a different logic.</p><p>You could, for instance, use the Octokit SDK to retrieve the public repositories associated with the logged in user from GitHub's API and redirect the browser to the most popular one very easily:</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"Octokit"</span> <span class="attr">Version</span>=<span class="string">"4.0.3"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.MapMethods(<span class="string">"callback/login/github"</span>, <span class="keyword">new</span>[] { HttpMethods.Get, HttpMethods.Post }, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync(Providers.GitHub);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> client = <span class="keyword">new</span> GitHubClient(<span class="keyword">new</span> ProductHeaderValue(<span class="string">"Sample-App"</span>))</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Attach the access token returned by GitHub's token endpoint:</span></span><br><span class="line">        Credentials = <span class="keyword">new</span> Credentials(result.Properties!.GetTokenValue(</span><br><span class="line">            OpenIddictClientAspNetCoreConstants.Tokens.BackchannelAccessToken))</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">await</span> client.User.Current();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Results.Redirect(</span><br><span class="line">        (<span class="keyword">from</span> repository <span class="keyword">in</span> <span class="keyword">await</span> client.Repository.GetAllForCurrent()</span><br><span class="line">         <span class="keyword">orderby</span> repository.StargazersCount <span class="keyword">descending</span></span><br><span class="line">         <span class="keyword">select</span> repository.HtmlUrl).FirstOrDefault() ?? <span class="string">"https://github.com/"</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p><strong>Returning a local authentication cookie based on the GitHub identity of the user</strong> is also quite easy.</p><div class="note info"><p>If you're not using ASP.NET Core Identity, you'll need to add an instance of the ASP.NET Core cookie handler to store the user identity and configure it as the default scheme in the ASP.NET Core authentication options.</p><p>When using ASP.NET Core Identity, it is not necessary because multiple cookie handlers are automatically registered for you by Identity.</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)</span><br><span class="line">    .AddCookie();</span><br></pre></td></tr></tbody></table></figure></div><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">app.MapMethods(<span class="string">"callback/login/github"</span>, <span class="keyword">new</span>[] { HttpMethods.Get, HttpMethods.Post }, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// Retrieve the authorization data validated by OpenIddict as part of the callback handling.</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync(Providers.GitHub);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Build an identity based on the external claims and that will be used to create the authentication cookie.</span></span><br><span class="line">    <span class="keyword">var</span> identity = <span class="keyword">new</span> ClaimsIdentity(authenticationType: <span class="string">"ExternalLogin"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// By default, OpenIddict will automatically try to map the email/name and name identifier claims from</span></span><br><span class="line">    <span class="comment">// their standard OpenID Connect or provider-specific equivalent, if available. If needed, additional</span></span><br><span class="line">    <span class="comment">// claims can be resolved from the external identity and copied to the final authentication cookie.</span></span><br><span class="line">    identity.SetClaim(ClaimTypes.Email, result.Principal!.GetClaim(ClaimTypes.Email))</span><br><span class="line">            .SetClaim(ClaimTypes.Name, result.Principal!.GetClaim(ClaimTypes.Name))</span><br><span class="line">            .SetClaim(ClaimTypes.NameIdentifier, result.Principal!.GetClaim(ClaimTypes.NameIdentifier));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Preserve the registration details to be able to resolve them later.</span></span><br><span class="line">    identity.SetClaim(Claims.Private.RegistrationId, result.Principal!.GetClaim(Claims.Private.RegistrationId))</span><br><span class="line">            .SetClaim(Claims.Private.ProviderName, result.Principal!.GetClaim(Claims.Private.ProviderName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Build the authentication properties based on the properties that were added when the challenge was triggered.</span></span><br><span class="line">    <span class="keyword">var</span> properties = <span class="keyword">new</span> AuthenticationProperties(result.Properties.Items)</span><br><span class="line">    {</span><br><span class="line">        RedirectUri = result.Properties.RedirectUri ?? <span class="string">"/whoami"</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ask the default sign-in handler to return a new cookie and redirect the</span></span><br><span class="line">    <span class="comment">// user agent to the return URL stored in the authentication properties.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// For scenarios where the default sign-in handler configured in the ASP.NET Core</span></span><br><span class="line">    <span class="comment">// authentication options shouldn't be used, a specific scheme can be specified here.</span></span><br><span class="line">    <span class="keyword">return</span> Results.SignIn(<span class="keyword">new</span> ClaimsPrincipal(identity), properties);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><div class="note warn"><p>It's important to note that the the callback/redirection endpoint can only be called once with the same authorization code or state token: any subsequent request with the same parameters will result in an error being returned. Keeping these sensitive parameters in a visible URL also has security concerns.</p><p>As such, it's always a good idea to redirect the user agent to a different page – for instance, a confirmation page – once the needed actions are performed, as shown in the last snippet.</p></div><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.MapGet(<span class="string">"whoami"</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync();</span><br><span class="line">    <span class="keyword">if</span> (result <span class="keyword">is</span> <span class="keyword">not</span> { Succeeded: <span class="literal">true</span> })</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> Results.Text(<span class="string">"You're not logged in."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Results.Text(<span class="built_in">string</span>.Format(<span class="string">"You are {0}."</span>, result.Principal.FindFirst(ClaimTypes.Name)!.Value));</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p>If you use ASP.NET Core Identity and its default UI, the web providers registered via <code>options.UseWebProviders().Add*()</code> are automatically returned without any additional configuration needed:</p><img src="/2022/12/16/getting-started-with-the-openiddict-web-providers/identity-ui.png"><p>If needed, the display name can be customized using the <code>.SetProviderDisplayName()</code> API:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">options.UseWebProviders()</span><br><span class="line">    .AddGitHub(options =&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        options.SetProviderDisplayName(<span class="string">"My provider"</span>);</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure><p>Voilà, that's all for today! 🎋</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2022/12/16/getting-started-with-the-openiddict-web-providers/" data-id="clng9ms7z002xlci145cq2mlg" class="article-share-link">Share</a> <a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a></li></ul></footer></div><nav id="article-nav"><a href="/2022/12/23/openiddict-4-0-general-availability/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">OpenIddict 4.0 general availability</div></a><a href="/2022/06/22/openiddict-4-0-preview1-is-out/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">OpenIddict 4.0 preview1 is out</div></a></nav></article><section id="comments"><div id="giscus_discussion"><script src="https://giscus.app/client.js" data-repo="kevinchalet/kevinchalet.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk2MTE2NjMwMw==" data-category="General" data-category-id="DIC_kwDOA6VS384CQu8O" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2023/10/04/can-you-use-the-asp-net-core-identity-api-endpoints-with-openiddict/" class="title">Can you use the ASP.NET Core Identity API endpoints with OpenIddict?</a></p><p class="item-date"><time datetime="2023-10-04T11:00:00.000Z" itemprop="datePublished">2023-10-04</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/07/05/connecting-windows-media-center-to-tvheadend-with-hdhrproxyiptv-an-alternative-to-dvblink/" class="title">Connecting Windows Media Center to Tvheadend with HDHRProxyIPTV: an alternative to DVBLink</a></p><p class="item-date"><time datetime="2023-07-05T18:00:00.000Z" itemprop="datePublished">2023-07-05</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/02/27/introducing-system-integration-support-for-the-openiddict-client/" class="title">Introducing system integration support for the OpenIddict client</a></p><p class="item-date"><time datetime="2023-02-27T16:00:00.000Z" itemprop="datePublished">2023-02-27</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/23/openiddict-4-0-general-availability/" class="title">OpenIddict 4.0 general availability</a></p><p class="item-date"><time datetime="2022-12-23T20:00:00.000Z" itemprop="datePublished">2022-12-23</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/" class="title">Getting started with the OpenIddict web providers</a></p><p class="item-date"><time datetime="2022-12-16T15:00:00.000Z" itemprop="datePublished">2022-12-16</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">33</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">37</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dvblink/" rel="tag">dvblink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhomerun/" rel="tag">hdhomerun</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhrproxytv/" rel="tag">hdhrproxytv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/identity/" rel="tag">identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">37</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">36</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tv/" rel="tag">tv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tvheadend/" rel="tag">tvheadend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2023 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>