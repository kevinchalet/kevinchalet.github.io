<!DOCTYPE html><html><head><meta charset="utf-8"><title>K√©vin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:type" content="website"><meta property="og:title" content="K√©vin Chalet&#39;s blog"><meta property="og:url" content="https://kevinchalet.com/index.html"><meta property="og:site_name" content="K√©vin Chalet&#39;s blog"><meta property="og:locale" content="en_US"><meta property="article:author" content="K√©vin Chalet"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="https://kevinchalet.com/assets/photo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">K√©vin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">K√©vin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">41 <span>posts</span></div><div class="article-info-block">31 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-openiddict-4-0-general-availability" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2022/12/23/openiddict-4-0-general-availability/">OpenIddict 4.0 general availability</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2022/12/23/openiddict-4-0-general-availability/"><time datetime="2022-12-23T20:00:00.000Z" itemprop="datePublished">2022-12-23</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><img src="/2022/12/23/openiddict-4-0-general-availability/christmas-tree.webp"><p>Two years after OpenIddict&#39;s last release, <strong>I&#39;m very pleased to announce that 4.0 is now generally available</strong>! üéâ</p><h2 id="What-39-s-new"><a href="#What-39-s-new" class="headerlink" title="What&#39;s new?"></a>What&#39;s new?</h2><p>While both the server and validation stacks include many internal improvements (some of them were described in <a href="/2022/06/22/openiddict-4-0-preview1-is-out/" title="OpenIddict 4.0 preview1 is out">OpenIddict 4.0 preview1 is out</a>), the most visible change of this release is <strong>the addition of the new client stack and its 17 web providers</strong> that aim at offering an alternative to the aspnet-contrib providers (additional services will be added in future versions of OpenIddict):</p><table><thead><tr><th>Provider name</th><th></th></tr></thead><tbody><tr><td>Apple</td><td>PayPal</td></tr><tr><td>Amazon Cognito</td><td>Pro Sant√© Connect</td></tr><tr><td>Deezer</td><td>Reddit</td></tr><tr><td>GitHub</td><td>StackExchange</td></tr><tr><td>Google</td><td>Trakt</td></tr><tr><td>Keycloak</td><td>Twitter</td></tr><tr><td>LinkedIn</td><td>WordPress</td></tr><tr><td>Microsoft Accounts&#x2F;Azure AD</td><td>Yahoo</td></tr><tr><td>Mixcloud</td><td></td></tr></tbody></table><p>If you&#39;re interested in learning more about the new OpenIddict client, don&#39;t miss these blog posts:</p><ul><li><a href="/2022/02/25/introducing-the-openiddict-client/" title="Introducing the OpenIddict client">Introducing the OpenIddict client</a></li><li><a href="/2022/06/22/openiddict-4-0-preview1-is-out/" title="OpenIddict 4.0 preview1 is out">OpenIddict 4.0 preview1 is out</a></li><li><a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/" title="Getting started with the OpenIddict web providers">Getting started with the OpenIddict web providers</a></li></ul><p>To see the OpenIddict client in action, you can give the <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-samples">OpenIddict samples a try</a>, as most of them have been updated to use it.</p><h2 id="Migration"><a href="#Migration" class="headerlink" title="Migration"></a>Migration</h2><p>While OpenIddict 4.0 comes with some breaking changes, the migration process should be fairly easy. To help users with this process, an <a target="_blank" rel="noopener" href="https://documentation.openiddict.com/guides/migration/30-to-40.html">OpenIddict 4.0 migration guide</a> was added to the documentation.</p><div class="note tip"><p>OpenIddict 4.0 is fully compatible with ASP.NET Core 2.1 (on .NET Framework), ASP.NET Core 3.1, ASP.NET Core 6.0 and ASP.NET Core 7.0, so the migration can be done without having to upgrade to the latest .NET runtime&#x2F;ASP.NET Core version.</p></div><h2 id="Support"><a href="#Support" class="headerlink" title="Support"></a>Support</h2><p>With OpenIddict 4.0 being now generally available, <strong>the previous version, OpenIddict 3.0, stops being supported and won&#39;t receive bug fixes or security updates</strong>. It is recommended to migrate to OpenIddict 4.0 to continue receiving bug and security fixes.</p><h2 id="Acknowledgements"><a href="#Acknowledgements" class="headerlink" title="Acknowledgements"></a>Acknowledgements</h2><p>As always, a new major release is a great opportunity to thank all the sponsors who have helped keep OpenIddict free for everyone. <strong>Every contribution counts ‚Äì of course! ‚Äì but I&#39;d like to dedicate this release to 3 sponsors in particular, who have a special place in my heart</strong>:</p><ul><li><p><a target="_blank" rel="noopener" href="https://volosoft.com/">Volosoft</a>: it might sound surprising, but Volosoft is the first and only company that has spontaneously offered to sponsor the project while evaluating OpenIddict as a replacement for IdentityServer4 in their (very!) popular ABP Framework project. Without Volosoft&#39;s incredible support, it&#39;s very likely the project would no longer be as active as it today (or even free for everyone).</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/DovydasNavickas">Dovydas Navickas</a>: Dovydas is one of the very first OpenIddict sponsors. Even though he stopped using OpenIddict after a big career change some time ago, Dovydas decided to keep sponsoring the project! This level of support is truly amazing so thank you very much Dovydas!</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/Skrypt">Jasmin Savard</a>: Jasmin doesn&#39;t use OpenIddict but decided to give away a significant part of the sponsorship he receives as one of the most important Orchard Core contributors to keep OpenIddict free for everyone else. No need to say this dedication leaves me absolutely speechless!</p></li></ul><p>I hope you&#39;ll love OpenIddict 4.0 as much as I enjoyed working on it.</p><p><strong>Merry Christmas everyone!</strong> üéÑ üéÅ</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2022/12/23/openiddict-4-0-general-availability/" data-id="clc0eez5v00auaki1huva8x9s" class="article-share-link">Share</a> <a href="/2022/12/23/openiddict-4-0-general-availability/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li></ul></footer></div></article><article id="post-getting-started-with-the-openiddict-web-providers" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2022/12/16/getting-started-with-the-openiddict-web-providers/">Getting started with the OpenIddict web providers</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/"><time datetime="2022-12-16T15:00:00.000Z" itemprop="datePublished">2022-12-16</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Earlier this year, I unveiled <a href="/2022/02/25/introducing-the-openiddict-client/" title="the new web providers">the new web providers</a> that will ship as part of the OpenIddict 4.0 release.</p><p>To help users understand the differences between <a target="_blank" rel="noopener" href="https://www.nuget.org/profiles/aspnet-contrib">the existing aspnet-contrib providers</a> and the new OpenIddict-based providers, I also posted <a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers/issues/694">additional information on the aspnet-contrib repository</a> ; so if you&#39;re considering replacing the aspnet-contrib providers by their equivalent in OpenIddict, don&#39;t miss it.</p><p>Today, we&#39;re going to see how to easily get started by creating a minimal application that uses the <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/OpenIddict.Client.WebIntegration"><code>OpenIddict.Client.WebIntegration</code> package</a>.</p><p>At the time of writing, 16 providers ‚Äì Apple, Cognito, Deezer, GitHub, Google, Keycloak, LinkedIn, Microsoft, Mixcloud, PayPal, Reddit, StackExchange, Trakt, Twitter, WordPress and Yahoo ‚Äì are already available, but to keep things simple, we&#39;ll focus our attention on a single one: GitHub.</p><h2 id="Create-a-new-ASP-NET-Core-application"><a href="#Create-a-new-ASP-NET-Core-application" class="headerlink" title="Create a new ASP.NET Core application"></a>Create a new ASP.NET Core application</h2><p>For this step, we could use one of the Visual Studio templates, but since there&#39;s a trend towards doing things the &quot;minimalistic&quot; way, we&#39;re only going to add two files: a <code>.csproj</code> file containing the package references we&#39;ll need and a <code>Program.cs</code> file:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">&quot;Microsoft.NET.Sdk.Web&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>net7.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Nullable</span>&gt;</span>enable<span class="tag">&lt;/<span class="name">Nullable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImplicitUsings</span>&gt;</span>enable<span class="tag">&lt;/<span class="name">ImplicitUsings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;Microsoft.EntityFrameworkCore.InMemory&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;7.0.1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;OpenIddict.AspNetCore&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;4.0.0-rc2.22614.58&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;OpenIddict.EntityFrameworkCore&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;4.0.0-rc2.22614.58&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line">builder.WebHost.UseUrls(<span class="string">&quot;https://localhost:44381/&quot;</span>);</span><br><span class="line"></span><br><span class="line">builder.Services.AddAuthentication();</span><br><span class="line">builder.Services.AddAuthorization();</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> <span class="keyword">using</span> <span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.UseAuthentication();</span><br><span class="line">app.UseAuthorization();</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> app.RunAsync();</span><br></pre></td></tr></table></figure><p>If you run this application as-is, all you&#39;ll get is a 404 response as we didn&#39;t register any HTTP handler. We&#39;ll get back to it in a few minutes.</p><h2 id="Create-a-new-GitHub-OAuth-application"><a href="#Create-a-new-GitHub-OAuth-application" class="headerlink" title="Create a new GitHub OAuth application"></a>Create a new GitHub OAuth application</h2><p>Whether you&#39;re using the new OpenIddict GitHub integration or any other OAuth 2.0 client, this step is unavoidable. But luckily, it&#39;s not that complicated and <a target="_blank" rel="noopener" href="https://docs.github.com/en/developers/apps/building-oauth-apps/creating-an-oauth-app">GitHub has an excellent guide to help you create your own OAuth app</a>.</p><p>You can of course use any application name for this sample, but you&#39;ll need to use an authorization callback URL that points to your application. In this case, we&#39;ll use <code>https://localhost:44381/callback/login/github</code> (GitHub doesn&#39;t require that the <code>redirect_uri</code> specified in authorization requests have the same exact port as the one configured in the application registration, so if you specified a different port in your <code>Program.cs</code>, it should work too).</p><p>If everything went smoothly, GitHub should give you a <code>client_id</code> and a <code>client_secret</code>: note them down as we&#39;ll need them in the next step.</p><h2 id="Add-the-OpenIddict-services"><a href="#Add-the-OpenIddict-services" class="headerlink" title="Add the OpenIddict services"></a>Add the OpenIddict services</h2><p>Like the rest of OpenIddict, the OpenIddict client and its web providers are registered using <code>IServiceCollection</code> extensions and builders:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddOpenIddict()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register the OpenIddict client components.</span></span><br><span class="line">    .AddClient(options =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Allow the OpenIddict client to negotiate the authorization code flow.</span></span><br><span class="line">        options.AllowAuthorizationCodeFlow();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Enable the redirection endpoint needed to handle the callback stage.</span></span><br><span class="line">        options.SetRedirectionEndpointUris(<span class="string">&quot;callback/login/github&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the signing and encryption credentials used to protect</span></span><br><span class="line">        <span class="comment">// sensitive data like the state tokens produced by OpenIddict.</span></span><br><span class="line">        options.AddDevelopmentEncryptionCertificate()</span><br><span class="line">               .AddDevelopmentSigningCertificate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the ASP.NET Core host and configure the ASP.NET Core-specific options.</span></span><br><span class="line">        options.UseAspNetCore()</span><br><span class="line">               .EnableRedirectionEndpointPassthrough();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the GitHub integration.</span></span><br><span class="line">        options.UseWebProviders()</span><br><span class="line">               .UseGitHub(options =&gt;</span><br><span class="line">               &#123;</span><br><span class="line">                   options.SetClientId(<span class="string">&quot;[your client identifier]&quot;</span>)</span><br><span class="line">                          .SetClientSecret(<span class="string">&quot;[your client secret]&quot;</span>)</span><br><span class="line">                          .SetRedirectUri(<span class="string">&quot;callback/login/github&quot;</span>);</span><br><span class="line">               &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><div class="note tip"><p>Don&#39;t forget to replace the placeholders in the previous snippet by your actual <code>client_id</code> and <code>client_secret</code>.</p></div><p>Since <strong>the OpenIddict client is stateful</strong> (<em>unlike the ASP.NET Core OAuth 2.0 or OpenID Connect handlers</em>), we&#39;ll also need to configure a database that will be <strong>used to store the state tokens OpenIddict will create to prevent cross-site request forgery, session fixation and replay attacks</strong>.</p><p>To keep things simple, we&#39;ll use the OpenIddict Entity Framework Core stores with an in-memory database:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: the OpenIddict client is stateful by default and relies on a database to persist</span></span><br><span class="line"><span class="comment">// things like state tokens and provide additional protection against replay attacks.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// For a simple single-instance demo application, an in-memory database can be used safely.</span></span><br><span class="line">builder.Services.AddDbContext&lt;DbContext&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.UseInMemoryDatabase(<span class="string">&quot;db&quot;</span>);</span><br><span class="line">    options.UseOpenIddict();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddOpenIddict()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register the OpenIddict core components.</span></span><br><span class="line">    .AddCore(options =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Configure OpenIddict to use the Entity Framework Core stores and models.</span></span><br><span class="line">        options.UseEntityFrameworkCore()</span><br><span class="line">               .UseDbContext&lt;DbContext&gt;();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="Add-HTTP-handlers-to-start-the-GitHub-authorization-process-and-handle-the-callback-request"><a href="#Add-HTTP-handlers-to-start-the-GitHub-authorization-process-and-handle-the-callback-request" class="headerlink" title="Add HTTP handlers to start the GitHub authorization process and handle the callback request"></a>Add HTTP handlers to start the GitHub authorization process and handle the callback request</h2><p>Last but not least, we&#39;ll also add two minimal actions that will respectively used to:</p><ol><li>Initiate a challenge that will redirect the user to GitHub&#39;s authorization endpoint.</li><li>Handle the authorization response returned by GitHub to the callback&#x2F;redirection endpoint of our application. For now, this endpoint will simply return a text message indicating how many public repositories the user has:</li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a minimal action responsible for triggering a GitHub challenge</span></span><br><span class="line"><span class="comment">// and redirecting the user agent to the GitHub authorization endpoint.</span></span><br><span class="line">app.MapGet(<span class="string">&quot;challenge&quot;</span>, () =&gt; Results.Challenge(<span class="literal">null</span>, <span class="keyword">new</span>[] &#123; OpenIddictClientAspNetCoreDefaults.AuthenticationScheme &#125;));</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a minimal action responsible for handling the GitHub redirection callback.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Note: the OpenIddict client automatically validates the request before this action</span></span><br><span class="line"><span class="comment">// is invoked (e.g by ensuring the state token is valid) and takes care of redeeming</span></span><br><span class="line"><span class="comment">// the authorization code and retrieving the user information automatically. All the</span></span><br><span class="line"><span class="comment">// claims returned by the user information endpoint are available as Claim instances.</span></span><br><span class="line">app.MapMethods(<span class="string">&quot;callback/login/github&quot;</span>, <span class="keyword">new</span>[] &#123; HttpMethods.Get, HttpMethods.Post &#125;, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync(OpenIddictClientAspNetCoreDefaults.AuthenticationScheme);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Results.Text(<span class="built_in">string</span>.Format(<span class="string">&quot;&#123;0&#125; has &#123;1&#125; public repositories.&quot;</span>,</span><br><span class="line">        result.Principal!.FindFirst(<span class="string">&quot;name&quot;</span>)!.Value,</span><br><span class="line">        result.Principal!.FindFirst(<span class="string">&quot;public_repos&quot;</span>)!.Value));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>With these handlers in place, if you visit <code>https://localhost:44381/challenge</code>, you should be immediately redirected to GitHub and asked to approve the authorization request. Once you do so, you&#39;ll be redirected to <code>https://localhost:44381/callback/login/github</code> and a message similar to this one should be returned:</p><blockquote><p>K√©vin Chalet has 21 public repositories.</p></blockquote><h2 id="Implement-different-callback-handling-strategies"><a href="#Implement-different-callback-handling-strategies" class="headerlink" title="Implement different callback handling strategies"></a>Implement different callback handling strategies</h2><p><strong>What happens in your callback endpoint is entirely up to you</strong>. While the previous snippet simply returned some text containing the name and the number of public repositories exposed by OpenIddict via <code>AuthenticateResult.Principal.Claims</code>, nothing prevents you from adopting a different logic.</p><p>You could, for instance, use the Octokit SDK to retrieve the public repositories associated with the logged in user from GitHub&#39;s API and redirect the browser to the most popular one very easily:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;Octokit&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;4.0.3&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.MapMethods(<span class="string">&quot;callback/login/github&quot;</span>, <span class="keyword">new</span>[] &#123; HttpMethods.Get, HttpMethods.Post &#125;, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync(OpenIddictClientAspNetCoreDefaults.AuthenticationScheme);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> client = <span class="keyword">new</span> GitHubClient(<span class="keyword">new</span> ProductHeaderValue(<span class="string">&quot;Sample-App&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Attach the access token returned by GitHub&#x27;s token endpoint:</span></span><br><span class="line">        Credentials = <span class="keyword">new</span> Credentials(result.Properties!.GetTokenValue(</span><br><span class="line">            OpenIddictClientAspNetCoreConstants.Tokens.BackchannelAccessToken))</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">await</span> client.User.Current();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Results.Redirect(</span><br><span class="line">        (<span class="keyword">from</span> repository <span class="keyword">in</span> <span class="keyword">await</span> client.Repository.GetAllForCurrent()</span><br><span class="line">         <span class="keyword">orderby</span> repository.StargazersCount <span class="keyword">descending</span></span><br><span class="line">         <span class="keyword">select</span> repository.HtmlUrl).FirstOrDefault() ?? <span class="string">&quot;https://github.com/&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>Returning a local authentication cookie based on the GitHub identity of the user</strong> is also quite easy:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddAuthentication().AddCookie();</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.MapMethods(<span class="string">&quot;callback/login/github&quot;</span>, <span class="keyword">new</span>[] &#123; HttpMethods.Get, HttpMethods.Post &#125;, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync(OpenIddictClientAspNetCoreDefaults.AuthenticationScheme);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> identity = <span class="keyword">new</span> ClaimsIdentity(Providers.GitHub);</span><br><span class="line">    identity.AddClaim(result.Principal!.FindFirst(<span class="string">&quot;id&quot;</span>)!);</span><br><span class="line">    identity.AddClaim(result.Principal!.FindFirst(<span class="string">&quot;name&quot;</span>)!);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> properties = <span class="keyword">new</span> AuthenticationProperties</span><br><span class="line">    &#123;</span><br><span class="line">        RedirectUri = <span class="string">&quot;/whoami&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Results.SignIn(<span class="keyword">new</span> ClaimsPrincipal(identity), properties, CookieAuthenticationDefaults.AuthenticationScheme);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.MapGet(<span class="string">&quot;whoami&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> context.AuthenticateAsync(CookieAuthenticationDefaults.AuthenticationScheme);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Results.Text(<span class="built_in">string</span>.Format(<span class="string">&quot;You are &#123;0&#125;.&quot;</span>, result.Principal!.FindFirst(<span class="string">&quot;name&quot;</span>)!.Value));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="note warn"><p>It&#39;s important to note that the the callback&#x2F;redirection endpoint can only be called once with the same authorization code or state token: any subsequent request with the same parameters will result in an error being returned. Keeping these sensitive parameters in a visible URL also has security concerns.</p><p>As such, it&#39;s always a good idea to redirect the user agent to a different page ‚Äì for instance, a confirmation page ‚Äì once the needed actions are performed, as shown in the last snippet.</p></div><p>Voil√†, that&#39;s all for today! üéã</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2022/12/16/getting-started-with-the-openiddict-web-providers/" data-id="clc0eez5u00asaki1a4byal1u" class="article-share-link">Share</a> <a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a></li></ul></footer></div></article><article id="post-openiddict-4-0-preview1-is-out" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2022/06/22/openiddict-4-0-preview1-is-out/">OpenIddict 4.0 preview1 is out</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2022/06/22/openiddict-4-0-preview1-is-out/"><time datetime="2022-06-22T18:00:00.000Z" itemprop="datePublished">2022-06-22</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Earlier today, the first OpenIddict 4.0 preview was pushed to NuGet.org üéâ</p><p>As always, all the changes can be found on <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/pulls?q=is:pr+milestone:4.0.0-preview1+is:closed">GitHub</a> but here&#39;s a recap of the most interesting ones:</p><h2 id="What-changed"><a href="#What-changed" class="headerlink" title="What changed?"></a>What changed?</h2><h3 id="OpenIddict-now-includes-a-client-stack"><a href="#OpenIddict-now-includes-a-client-stack" class="headerlink" title="OpenIddict now includes a client stack"></a>OpenIddict now includes a client stack</h3><p><strong>The introduction of a client stack in 4.0 is by far the most exciting change (well, at least for me üòÅ)</strong>.</p><p>If you missed <a href="/2022/02/25/introducing-the-openiddict-client/" title="my previous post">my previous post</a>, I&#39;d suggest reading it first as it details the motivation for creating it and the differences with existing offers like the ASP.NET Core OpenID Connect or OAuth 2.0 handlers.</p><h3 id="The-OpenIddict-client-will-come-with-a-companion-package-to-simplify-well-known-Web-services-integrations"><a href="#The-OpenIddict-client-will-come-with-a-companion-package-to-simplify-well-known-Web-services-integrations" class="headerlink" title="The OpenIddict client will come with a companion package to simplify well-known Web services integrations"></a>The OpenIddict client will come with a companion package to simplify well-known Web services integrations</h3><p>I had mentioned in my previous blog post that I was interested in developing an alternative to <a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers">the aspnet-contrib providers</a> that would be based on the new OpenIddict client instead of the ASP.NET Core 2.0 base handler and would have the following advantages:</p><ul><li><p>Thanks to its dual-protocol nature, the OpenIddict client could enforce all the security checks introduced by OpenID Connect that a simple OAuth 2.0 client implementation like the ASP.NET Core OAuth 2.0 base handler wouldn&#39;t support, which means we could easily support both OAuth 2.0 and OpenID Connect providers without sacrificing security.</p></li><li><p>By being natively compatible with ASP.NET Core (from 2.1 to 7.0) and OWIN&#x2F;Katana 4.2, the providers built on top of the OpenIddict client could be used in both recent ASP.NET Core apps and legacy ASP.NET &gt;&#x3D; 4.6.1 apps, making them usable in many more applications than the aspnet-contrib providers, that always target the most recent ASP.NET Core version.</p></li><li><p>Unlike the OAuth 2.0 base handler developed by Microsoft, the OpenIddict client comes with a composable events model that could allow eliminating code that we needed to copy in the aspnet-contrib providers when overriding certain <code>OAuthHandler</code> methods.</p></li></ul><p><strong>The good news is that this idea materialized as a dedicated <code>OpenIddict.Client.WebIntegration</code> package</strong> that depends on <code>OpenIddict.Client</code> and includes the logic necessary to deal with all the non-standard aspects of each supported provider. Unlike the aspnet-contrib providers, <code>OpenIddict.Client.WebIntegration</code> relies on Roslyn Source Generators to dynamically create all the plumbing code, which makes it much easier to maintain. If you&#39;re interested in learning more about the technical details, <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/pull/1396">don&#39;t miss the PR that introduced it</a>.</p><p>If you&#39;re already familiar with the aspnet-contrib providers, migrating to the OpenIddict-based providers shouldn&#39;t be too complicated:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">services.AddOpenIddict()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register the OpenIddict core components.</span></span><br><span class="line">    .AddCore(options =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Configure OpenIddict to use the Entity Framework Core stores and models.</span></span><br><span class="line">        <span class="comment">// Note: call ReplaceDefaultEntities() to replace the default OpenIddict entities.</span></span><br><span class="line">        options.UseEntityFrameworkCore()</span><br><span class="line">               .UseDbContext&lt;ApplicationDbContext&gt;();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register the OpenIddict client components.</span></span><br><span class="line">    .AddClient(options =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Enable the redirection endpoint needed to handle the callback stage.</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Note: to mitigate mix-up attacks, it&#x27;s recommended to use a unique redirection endpoint</span></span><br><span class="line">        <span class="comment">// address per provider, unless all the registered providers support returning an &quot;iss&quot;</span></span><br><span class="line">        <span class="comment">// parameter containing their URL as part of authorization responses. For more information,</span></span><br><span class="line">        <span class="comment">// see https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics#section-4.4.</span></span><br><span class="line">        options.SetRedirectionEndpointUris(</span><br><span class="line">            <span class="string">&quot;/signin-local&quot;</span>,</span><br><span class="line">            <span class="string">&quot;/signin-github&quot;</span>,</span><br><span class="line">            <span class="string">&quot;/signin-google&quot;</span>,</span><br><span class="line">            <span class="string">&quot;/signin-reddit&quot;</span>,</span><br><span class="line">            <span class="string">&quot;/signin-twitter&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the signing and encryption credentials used to protect</span></span><br><span class="line">        <span class="comment">// sensitive data like the state tokens produced by OpenIddict.</span></span><br><span class="line">        options.AddDevelopmentEncryptionCertificate()</span><br><span class="line">               .AddDevelopmentSigningCertificate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the ASP.NET Core host and configure the ASP.NET Core-specific options.</span></span><br><span class="line">        options.UseAspNetCore()</span><br><span class="line">               .EnableStatusCodePagesIntegration()</span><br><span class="line">               .EnableRedirectionEndpointPassthrough();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register the Web providers integrations.</span></span><br><span class="line">        options.UseWebProviders()</span><br><span class="line">               .AddGitHub(<span class="keyword">new</span>()</span><br><span class="line">               &#123;</span><br><span class="line">                   ClientId = <span class="string">&quot;[client identifier]&quot;</span>,</span><br><span class="line">                   ClientSecret = <span class="string">&quot;[client secret]&quot;</span>,</span><br><span class="line">                   RedirectUri = <span class="keyword">new</span> Uri(<span class="string">&quot;https://localhost:44381/signin-github&quot;</span>, UriKind.Absolute)</span><br><span class="line">               &#125;)</span><br><span class="line">               .AddGoogle(<span class="keyword">new</span>()</span><br><span class="line">               &#123;</span><br><span class="line">                   ClientId = <span class="string">&quot;[client identifier]&quot;</span>,</span><br><span class="line">                   ClientSecret = <span class="string">&quot;[client secret]&quot;</span>,</span><br><span class="line">                   RedirectUri = <span class="keyword">new</span> Uri(<span class="string">&quot;https://localhost:44381/signin-google&quot;</span>, UriKind.Absolute),</span><br><span class="line">                   Scopes = &#123; Scopes.Profile &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p class="article-more-link"><a href="/2022/06/22/openiddict-4-0-preview1-is-out/">Read more</a></p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2022/06/22/openiddict-4-0-preview1-is-out/" data-id="clc0eez5t00araki1ggd36ldh" class="article-share-link">Share</a> <a href="/2022/06/22/openiddict-4-0-preview1-is-out/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li></ul></footer></div></article><article id="post-introducing-the-openiddict-client" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2022/02/25/introducing-the-openiddict-client/">Introducing the OpenIddict client</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2022/02/25/introducing-the-openiddict-client/"><time datetime="2022-02-25T21:00:00.000Z" itemprop="datePublished">2022-02-25</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>When I unveiled the <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/issues/736">OpenIddict 3.0 roadmap three years ago</a>, I mentioned that having an OpenIddict client would be a very nice addition but that implementing it as part of 3.0 wasn&#39;t realistic. Today, I&#39;m very happy to announce that <strong>the OpenIddict client will ship as part of OpenIddict&#39;s next major version</strong>.</p><h2 id="Why-a-new-client"><a href="#Why-a-new-client" class="headerlink" title="Why a new client?"></a>Why a new client?</h2><p>A few client libraries already exist for .NET, including:</p><ul><li>For ASP.NET Core, <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/tree/main/src/Security/Authentication/OAuth/src">an OAuth 2.0 base handler developed by Microsoft</a> that we massively use for the <a target="_blank" rel="noopener" href="https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers">aspnet-contrib project</a> (more than 80 OAuth 2.0 services are supported at the time of writing!)</li><li>For ASP.NET Core, <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/tree/main/src/Security/Authentication/OpenIdConnect/src">an OpenID Connect handler developed by Microsoft</a>.</li><li>For ASP.NET 4.x&#x2F;OWIN, <a target="_blank" rel="noopener" href="https://github.com/aspnet/AspNetKatana/tree/dev/src/Microsoft.Owin.Security.OpenIdConnect">an OpenID Connect middleware maintained by Microsoft</a>.</li><li>For console and GUI applications, <a target="_blank" rel="noopener" href="https://github.com/IdentityModel/IdentityModel.OidcClient">a certified OpenID Connect client developed by Duende Software</a>.</li><li>For Blazor WASM applications, <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/tree/main/src/Components/WebAssembly/WebAssembly.Authentication/src">an OpenID Connect integration based on the oidc-client-js library</a>.</li></ul><p>So why do we need another one? Am I reinventing the wheel by introducing another OIDC client stack?</p><p>Well, that&#39;s definitely a legit question. First, I have to say that these implementations work just fine and that I&#39;ve used them happily other the years. Actually, I even contributed <a target="_blank" rel="noopener" href="https://github.com/aspnet/Security/pulls?q=is:pr+author:kevinchalet+is:closed">to some of these implementations multiple times</a> so I have a fairly good experience working with them.</p><p>In a nutshell, here&#39;s what motivated me:</p><ul><li><p>While all these libraries offer very specialized implementations, <strong>none of them offers a unified experience</strong> that allowing sharing a common code base usable on, say, ASP.NET Core and Blazor WASM applications: what you learned about the ASP.NET Core OIDC handler is not applicable to Blazor WASM, that uses a completely different OIDC client stack under the hood.</p></li><li><p><strong>The OIDC integration for Blazor WASM uses <a target="_blank" rel="noopener" href="https://github.com/IdentityModel/oidc-client-js">oidc-client-js</a>, that was archived in June 2021 and is no longer supported</strong>. While the Blazor OIDC wrapper itself is supported by Microsoft, the library it uses under the hood is not and won&#39;t receive any bug or security fix, which is a bit surprising to me, considering its author is still sponsored by Microsoft.</p></li><li><p>While it&#39;s supported by Microsoft, the Blazor OIDC wrapper doesn&#39;t actually get much love and <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/issues/39144">suffers from annoying design issues that affect OpenIddict users</a> that the team is unwilling to fix.</p></li><li><p>The OAuth 2.0 base handler for ASP.NET Core offers a straightforward API for creating derived OAuth 2.0 clients that we successfully used in the aspnet-contrib social providers. Unfortunately, its simplicity comes at a cost: <strong>it&#39;s not composable</strong>. Concretely, it means that every time we need to customize something (e.g adding a parameter to the token request), we end up duplicating more code than what we should (e.g to add a token request parameter, you also need to take care of sending the HTTP request and handling the response, which is something the OAuth 2.0 base handler does for you if you don&#39;t override the <code>OAuthHandler&lt;T&gt;.ExchangeCodeAsync(OAuthCodeExchangeContext context)</code> method).</p></li><li><p>There&#39;s also another downside with the OAuth 2.0 base handler: <strong>it doesn&#39;t support OpenID Connect</strong>. Yet, we received contributions to add OAuth 2.0 providers that also support OpenID Connect: while ASP.NET Core has a dedicated OIDC handler that is more appropriate for these cases, many people like the simpler registration story the OAuth 2.0 base handler and the aspnet-contrib providers offer. Retrospectively, we shouldn&#39;t have accepted these contributions as these providers don&#39;t benefit from the additional security checks a real OpenID Connect implementation requires (e.g <code>nonce</code>, <code>at_hash</code> or <code>c_hash</code> validation, etc.)</p></li><li><p>The OAuth 2.0 base handler doesn&#39;t support <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc8414">the OAuth 2.0 Authorization Server Metadata</a> specification that backported the OpenID Connect server discovery feature to the OAuth 2.0 world and that allows finding the location of the authorization and token endpoints dynamically, without having to hardcode them. While the adoption is slow, I&#39;d expect more and more services to support it in the next few years.</p></li></ul><p class="article-more-link"><a href="/2022/02/25/introducing-the-openiddict-client/">Read more</a></p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2022/02/25/introducing-the-openiddict-client/" data-id="clc0eez4p002saki10uxuatlx" class="article-share-link">Share</a> <a href="/2022/02/25/introducing-the-openiddict-client/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li></ul></footer></div></article><article id="post-asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/">ASP.NET Core 6 and authentication servers: the real bait and switch is not the one you think</a></h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/"><time datetime="2021-05-24T18:30:00.000Z" itemprop="datePublished">2021-05-24</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/general/">General</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Earlier this month, <a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/aspnet/asp-net-core-6-and-authentication-servers/">Barry Dorrans ‚Äì the Security PM for .NET ‚Äì announced</a> that the ASP.NET Core templates would be updated to target Duende IdentityServer5 as part of the .NET 6 effort and that the ASP.NET team was considering creating a development-only tool for testing OpenID Connect integration in .NET 7.</p><p>By looking at the reactions under the blog post, <a target="_blank" rel="noopener" href="https://github.com/dotnet/aspnetcore/issues/32494">on GitHub</a> or <a target="_blank" rel="noopener" href="https://www.reddit.com/r/dotnet/comments/n8euul/aspnet_core_6_and_authentication_servers_status/">on Reddit</a>, the least we can say is that people are always quite passionate when it comes to how Microsoft treats these topics. Some like that decision while a few others feel &quot;betrayed&quot; and consider this move a &quot;bait and switch&quot;:</p><img src="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/github-post-1.png"><p>Despite this move, <strong>my personal opinion hasn&#39;t changed</strong>: I was very happy when Microsoft announced they would use IdentityServer4 in 2018 and the commitment to use the new dual-licensed version of IdentityServer in .NET 6 (instead of writing their own OIDC server from scratch) is, in my opinion, a step in the right direction in changing their relationship with the .NET community: Microsoft can&#39;t provide everything out-of-the-box and promoting third-party projects is a great approach.</p><p>The fact Microsoft keeps sponsoring the IdentityServer project ‚Äì for $12,000&#x2F;year at the time of writing ‚Äì is also an excellent signal sent to the community. Even if you&#39;ve never liked Microsoft&#39;s love&#x2F;hate relationship with OSS, it would be very hard to deny that the company has positively changed in this regard.</p><p class="article-more-link"><a href="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/">Read more</a></p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/" data-id="clc0eez4o002raki1fadp1a88" class="article-share-link">Share</a> <a href="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/auth0/" rel="tag">auth0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/okta/" rel="tag">okta</a></li></ul></footer></div></article><nav id="page-nav"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a></nav></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2022/12/23/openiddict-4-0-general-availability/" class="title">OpenIddict 4.0 general availability</a></p><p class="item-date"><time datetime="2022-12-23T20:00:00.000Z" itemprop="datePublished">2022-12-23</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/" class="title">Getting started with the OpenIddict web providers</a></p><p class="item-date"><time datetime="2022-12-16T15:00:00.000Z" itemprop="datePublished">2022-12-16</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/06/22/openiddict-4-0-preview1-is-out/" class="title">OpenIddict 4.0 preview1 is out</a></p><p class="item-date"><time datetime="2022-06-22T18:00:00.000Z" itemprop="datePublished">2022-06-22</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/02/25/introducing-the-openiddict-client/" class="title">Introducing the OpenIddict client</a></p><p class="item-date"><time datetime="2022-02-25T21:00:00.000Z" itemprop="datePublished">2022-02-25</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2021/05/24/asp-net-core-6-and-authentication-servers-the-real-bait-and-switch-is-not-the-one-you-think/" class="title">ASP.NET Core 6 and authentication servers: the real bait and switch is not the one you think</a></p><p class="item-date"><time datetime="2021-05-24T18:30:00.000Z" itemprop="datePublished">2021-05-24</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">30</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">35</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">35</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">34</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2022 K√©vin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>