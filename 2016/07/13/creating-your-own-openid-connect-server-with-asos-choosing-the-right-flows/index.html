<!DOCTYPE html><html><head><meta charset="utf-8"><title>Creating your own OpenID Connect server with ASOS: choosing the right flow(s) | Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="In this post, discover the differences between the standard authorization code, implicit, resource owner password credentials and client credentials flows offered by OAuth 2.0 and OpenID Connect."><meta property="og:type" content="article"><meta property="og:title" content="Creating your own OpenID Connect server with ASOS: choosing the right flow(s)"><meta property="og:url" content="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/index.html"><meta property="og:site_name" content="Kévin Chalet&#39;s blog"><meta property="og:description" content="In this post, discover the differences between the standard authorization code, implicit, resource owner password credentials and client credentials flows offered by OAuth 2.0 and OpenID Connect."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/resource-owner-password-flow.png"><meta property="og:image" content="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/client-credentials-flow.png"><meta property="og:image" content="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/authorization-code-flow.png"><meta property="og:image" content="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/consent-form.png"><meta property="og:image" content="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/implicit-flow.png"><meta property="article:published_time" content="2016-07-13T15:15:00.000Z"><meta property="article:modified_time" content="2024-03-04T12:12:45.000Z"><meta property="article:author" content="Kévin Chalet"><meta property="article:tag" content="asp.net core"><meta property="article:tag" content="authentication"><meta property="article:tag" content="jwt"><meta property="article:tag" content="oauth"><meta property="article:tag" content="openid connect"><meta property="article:tag" content="aspnet-contrib"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/resource-owner-password-flow.png"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="https://kevinchalet.com/assets/photo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">46 <span>posts</span></div><div class="article-info-block">37 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Creating your own OpenID Connect server with ASOS: choosing the right flow(s)</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/"><time datetime="2016-07-13T15:15:00.000Z" itemprop="datePublished">2016-07-13</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><div class="note tip"><p>This post is the second part of a series of blog posts entitled <strong>Creating your own OpenID Connect server with ASOS</strong>:</p><ol><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-introduction/" title="Introduction">Introduction</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/" title="Choosing the right flow(s)">Choosing the right flow(s)</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-registering-the-middleware-in-the-asp-net-core-pipeline/" title="Registering the middleware in the ASP.NET Core pipeline">Registering the middleware in the ASP.NET Core pipeline</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-creating-your-own-authorization-provider/" title="Creating your own authorization provider">Creating your own authorization provider</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-implementing-the-resource-owner-password-credentials-grant/" title="Implementing the resource owner password credentials grant">Implementing the resource owner password credentials grant</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-implementing-the-authorization-code-and-implicit-flows/" title="Implementing the authorization code and implicit flows">Implementing the authorization code and implicit flows</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-adding-custom-claims-and-granting-scopes/" title="Adding custom claims and granting scopes">Adding custom claims and granting scopes</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-testing-your-authorization-server-with-postman/" title="Testing your authorization server with Postman">Testing your authorization server with Postman</a></li><li><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-conclusion/" title="Conclusion">Conclusion</a></li></ol></div><p>ASOS offers built-in support for all the standard flows defined by the <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749">OAuth 2.0</a> and <a target="_blank" rel="noopener" href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a> core specifications: <a target="_blank" rel="noopener" href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">the authorization code flow</a>, <a target="_blank" rel="noopener" href="http://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth">the implicit flow</a>, <a target="_blank" rel="noopener" href="http://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth">the hybrid flow</a> (which is basically a mix between the first two flows), <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749#section-4.3">the resource owner password credentials grant</a> and <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749#section-4.4">the client credentials grant</a>.</p><p>Though not specific to ASOS, choosing the best flow(s) for your application is an <strong>important prerequisite</strong> when implementing your own authorization server ; so here's a quick overview of the different OAuth 2.0/OpenID Connect flows:</p><hr><h2 id="Non-interactive-flows"><a href="#Non-interactive-flows" class="headerlink" title="Non-interactive flows"></a>Non-interactive flows</h2><h3 id="Resource-owner-password-credentials-flow"><a href="#Resource-owner-password-credentials-flow" class="headerlink" title="Resource owner password credentials flow"></a>Resource owner password credentials flow</h3><p>Directly inspired by <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Basic_access_authentication">basic authentication</a>, the resource owner password credentials grant (abbreviated <em>ROPC</em>) is probably <strong>the simplest OAuth 2.0 flow</strong>: the client application asks the user his username/password, sends a token request to the authorization server with the user credentials (and depending on the client authentication policy defined by the authorization server, its own client credentials) and gets back an access token it can use to retrieve the user's resources.</p><img src="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/resource-owner-password-flow.png"><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/connect/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-dts">grant_<span class="attr">type</span><span class="operator">=</span>password<span class="variable">&amp;username</span>=johndoe<span class="variable">&amp;password</span>=A3ddj3w</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json;charset=UTF-8</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-store</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">{</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"access_token"</span><span class="punctuation">:</span><span class="string">"2YotnFZFEjr1zCsicMWpAA"</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"token_type"</span><span class="punctuation">:</span><span class="string">"bearer"</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"expires_in"</span><span class="punctuation">:</span><span class="number">3600</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">}</span></span></span><br></pre></td></tr></tbody></table></figure><p>Though <strong>not recommended by the OAuth 2.0 specification</strong> as it's the only flow where <strong>the user password is directly exposed to the client application</strong> (which breaks the principle of least privilege), the resource owner password credentials grant is one of the most popular flows.</p><p>It is is particularly appreciated by SPA writers as it's trivial to implement in vanilla JavaScript, doesn't involve any redirection or consent form and, unlike interactive flows, doesn't require implementing token validation or cross-site request forgery (XSRF) countermeasures to prevent session fixation attacks.</p><div class="note tip"><p>If you don't feel comfortable with the other flows (and the security measures they require on the client-side), using ROPC might be a good option: <strong>paradoxically, a client application using ROPC will be far less vulnerable than a client using interactive flows without implementing the appropriate security checks.</strong></p></div><div class="note warn"><p><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749#section-4.3">As recommended by the OAuth 2.0 specification</a>, <strong>you SHOULD NEVER use it with third-party applications</strong>. If you want to support applications you don't <strong>fully trust</strong>, consider using an interactive flow instead (e.g authorization code or implicit flow).</p></div><span id="more"></span><hr><h3 id="Client-credentials-grant"><a href="#Client-credentials-grant" class="headerlink" title="Client credentials grant"></a>Client credentials grant</h3><p>The client credentials grant is almost identical to the resource owner password credentials grant, except it's been specifically designed for <strong>client-to-server scenarios</strong> (no user is involved in this flow): the client application sends a token request containing its credentials and gets back an access token it can use to query its own resources.</p><img src="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/client-credentials-flow.png"><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/connect/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-dts">grant_<span class="attr">type</span><span class="operator">=</span>client_credentials<span class="variable">&amp;client_id</span>=s6BhdRkqt3<span class="variable">&amp;client_secret</span>=gX1fBat3bV</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json;charset=UTF-8</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-store</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">{</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"access_token"</span><span class="punctuation">:</span><span class="string">"2YotnFZFEjr1zCsicMWpAA"</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"token_type"</span><span class="punctuation">:</span><span class="string">"bearer"</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"expires_in"</span><span class="punctuation">:</span><span class="number">3600</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">}</span></span></span><br></pre></td></tr></tbody></table></figure><div class="note tip"><p>Unlike the resource owner password credentials grant, <strong>client authentication is not optional</strong> when using the client credentials grant and <strong>ASOS will always reject unauthenticated token requests</strong>, <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749#section-4.4.2">as required by the OAuth 2.0 specification</a>.</p><p>This means that <strong>you CAN'T use the client credentials grant with public applications</strong> like JS, mobile or desktop applications, as they are not able to keep their credentials secret.</p></div><hr><h2 id="Interactive-flows"><a href="#Interactive-flows" class="headerlink" title="Interactive flows"></a>Interactive flows</h2><h3 id="Authorization-code-flow"><a href="#Authorization-code-flow" class="headerlink" title="Authorization code flow"></a>Authorization code flow</h3><p>The authorization code flow is probably the most complicated flow as it involves both <strong>user-agent redirections and backchannel communication</strong>. In return, using this flow with server-side applications has a great advantage: the <code>access_token</code> cannot be intercepted by the user agent.</p><p>There are basically 2 steps in the authorization code flow: the authorization request/response and the token request/response.</p><img src="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/authorization-code-flow.png"><ul><li><strong>Step 1: the authorization request</strong></li></ul><p>In this flow, the client application always initiates the authentication process by generating an authorization request including the mandatory <code>response_type=code</code> parameter, its <code>client_id</code>, its <code>redirect_uri</code> and optionally, a <code>scope</code> and a <code>state</code> parameter <a target="_blank" rel="noopener" href="http://openid.net/specs/openid-connect-core-1_0.html#AuthRequest">that allows flowing custom data and helps mitigate XSRF attacks</a>.</p><div class="note tip"><p>In most cases, the client application will simply return a 302 response with a <code>Location</code> header to redirect the user agent to the authorization endpoint, but depending on the OpenID Connect client you're using, POST requests might also be supported to allow you to send large authorization requests. This feature <a target="_blank" rel="noopener" href="https://github.com/aspnet/Security/pull/392">is usually implemented using an auto-post HTML form</a>.</p></div><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Location</span><span class="punctuation">: </span>https://server.example.com/authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=af0ifjsldkj&amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb</span><br></pre></td></tr></tbody></table></figure><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/connect/authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=af0ifjsldkj&amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br></pre></td></tr></tbody></table></figure><p>The way the identity provider handles the authorization request is implementation-specific but in most cases, a consent form is displayed to ask the user if he or she agrees to share his/her personal data with the client application.</p><img src="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/consent-form.png"><p>When the consent is given, the user agent is redirected back to the client application with <strong>a unique and short-lived token</strong> named <em>authorization code</em> that the client will be able to exchange with an access token by sending a token request.</p><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Location</span><span class="punctuation">: </span>https://client.example.org/cb?code=SplxlOBeZQQYbYS6WxSbIA&amp;state=af0ifjsldkj</span><br></pre></td></tr></tbody></table></figure><div class="note warn"><p>To prevent XSRF/session fixation attacks, <strong>the client application MUST ensure that the <code>state</code> parameter returned by the identity provider corresponds to the original <code>state</code></strong> and stop processing the authorization response if the two values don't match. <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749#section-10.12">This is usually done by generating a non-guessable string and a corresponding correlation cookie</a>.</p></div><ul><li><strong>Step 2: the token request</strong></li></ul><p>When the client application gets back an authorization code, it must immediately reedem it for an access token by sending a <code>grant_type=authorization_code</code> token request.</p><div class="note tip"><p>To help the identity provider <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6819#section-4.4.1.7">mitigate counterfeit clients attacks</a>, the original <code>redirect_uri</code> must also be sent.</p><p>If the client application is a confidential application (i.e an application that has been assigned client credentials), authentication is required.</p></div><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/connect/token</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">grant_type</span>=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA&amp;redirect_uri=https%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fclient%<span class="number">2</span>Eexample%<span class="number">2</span>Ecom%<span class="number">2</span>Fcb&amp;client_id=s6BhdRkqt3&amp;client_secret=gX1fBat3bV&amp;scope=openid</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json;charset=UTF-8</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-store</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">{</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"access_token"</span><span class="punctuation">:</span><span class="string">"2YotnFZFEjr1zCsicMWpAA"</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"token_type"</span><span class="punctuation">:</span><span class="string">"bearer"</span><span class="punctuation">,</span></span></span><br><span class="line"><span class="language-json">  <span class="attr">"expires_in"</span><span class="punctuation">:</span><span class="number">3600</span></span></span><br><span class="line"><span class="language-json"><span class="punctuation">}</span></span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="Implicit-flow"><a href="#Implicit-flow" class="headerlink" title="Implicit flow"></a>Implicit flow</h3><p>The implicit flow is similar to the authorization code flow, <strong>except there's no token request/response step</strong>: the access token is directly returned to the client application as part of the authorization response in the URI fragment (or in the request form when using <code>response_mode=form_post</code>).</p><img src="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/implicit-flow.png"><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/connect/authorize?response_type=token&amp;client_id=s6BhdRkqt3&amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb&amp;scope=openid&amp;state=af0ifjsldkj&amp;nonce=n-0S6_WzA2Mj</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>server.example.com</span><br></pre></td></tr></tbody></table></figure><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Location</span><span class="punctuation">: </span>https://client.example.org/cb#access_token=SlAV32hkKG&amp;token_type=bearer&amp;expires_in=3600&amp;state=af0ifjsldkj</span><br></pre></td></tr></tbody></table></figure><div class="note info"><p>This flow is inherently less secure than the authorization code flow, but is easier to implement and has been specifically designed for JS applications. Using it with confidential applications is <strong>not recommended</strong> and authorization servers <strong>SHOULD STRONGLY</strong> consider rejecting implicit flow requests when the <code>client_id</code> corresponds to a confidential application to prevent downgrade attacks and token leakage.</p></div><div class="note warn"><p>To prevent XSRF/session fixation attacks, <strong>the client application MUST ensure that the <code>state</code> parameter returned by the identity provider corresponds to the original <code>state</code></strong> and stop processing the authorization response if the two values don't match. <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749#section-10.12">This is usually done by generating a non-guessable string and a corresponding value stored in the local storage</a>.</p><p>When using the implicit flow, <strong>the client application MUST also ensure that the access token was not issued to another application to prevent <a target="_blank" rel="noopener" href="http://stackoverflow.com/a/17439317/542757">confused deputy attacks</a>.</strong> With OpenID Connect, this can be done by using <code>response_type=id_token token</code> and checking the <code>aud</code> claim of the JWT identity token, that must correspond or contain the <code>client_id</code> of the client application.</p></div><p>Still unsure what's the best flow for your app? Here's a quick table to help you:</p><table><thead><tr><th>Flow/grant</th><th>Requires user interaction?</th><th>For server-side apps?</th><th>For public apps (JS/mobile)?</th><th>For third-party apps?</th></tr></thead><tbody><tr><td>Resource owner password credentials</td><td>No</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td>Client credentials</td><td>No</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>Authorization code</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Implicit</td><td>Yes</td><td>No</td><td>Yes</td><td>Yes</td></tr></tbody></table><hr><p>Next part: <a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-registering-the-middleware-in-the-asp-net-core-pipeline/" title="Registering the middleware in the ASP.NET Core pipeline">Registering the middleware in the ASP.NET Core pipeline</a>.</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/" data-id="clz9gl8v9002yhwi17bv4f7l1" class="article-share-link">Share</a> <a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-choosing-the-right-flows/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li></ul></footer></div><nav id="article-nav"><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-registering-the-middleware-in-the-asp-net-core-pipeline/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">Creating your own OpenID Connect server with ASOS: registering the middleware in the ASP.NET Core pipeline</div></a><a href="/2016/07/13/creating-your-own-openid-connect-server-with-asos-introduction/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Creating your own OpenID Connect server with ASOS: introduction</div></a></nav></article><section id="comments"><div id="giscus_discussion"><script src="https://giscus.app/client.js" data-repo="kevinchalet/kevinchalet.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk2MTE2NjMwMw==" data-category="General" data-category-id="DIC_kwDOA6VS384CQu8O" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2023/12/18/openiddict-5-0-general-availability/" class="title">OpenIddict 5.0 general availability</a></p><p class="item-date"><time datetime="2023-12-18T16:00:00.000Z" itemprop="datePublished">2023-12-18</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/10/20/introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1/" class="title">Introducing native applications, per-client token lifetimes and client assertions support in OpenIddict 5.0 preview1</a></p><p class="item-date"><time datetime="2023-10-20T15:30:00.000Z" itemprop="datePublished">2023-10-20</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/10/04/can-you-use-the-asp-net-core-identity-api-endpoints-with-openiddict/" class="title">Can you use the ASP.NET Core Identity API endpoints with OpenIddict?</a></p><p class="item-date"><time datetime="2023-10-04T11:00:00.000Z" itemprop="datePublished">2023-10-04</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/07/05/connecting-windows-media-center-to-tvheadend-with-hdhrproxyiptv-an-alternative-to-dvblink/" class="title">Connecting Windows Media Center to Tvheadend with HDHRProxyIPTV: an alternative to DVBLink</a></p><p class="item-date"><time datetime="2023-07-05T18:00:00.000Z" itemprop="datePublished">2023-07-05</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/02/27/introducing-system-integration-support-for-the-openiddict-client/" class="title">Introducing system integration support for the OpenIddict client</a></p><p class="item-date"><time datetime="2023-02-27T16:00:00.000Z" itemprop="datePublished">2023-02-27</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dvblink/" rel="tag">dvblink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhomerun/" rel="tag">hdhomerun</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhrproxytv/" rel="tag">hdhrproxytv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/identity/" rel="tag">identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">34</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">38</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tv/" rel="tag">tv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tvheadend/" rel="tag">tvheadend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2024 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>