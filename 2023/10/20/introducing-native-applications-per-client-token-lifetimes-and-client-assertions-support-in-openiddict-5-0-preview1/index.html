<!DOCTYPE html><html><head><meta charset="utf-8"><title>Introducing native applications, per-client token lifetimes and client assertions support in OpenIddict 5.0 preview1 | KÃ©vin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Earlier today, the first OpenIddict 5.0 preview was pushed to NuGet.org ðŸŽ‰ As always, all the changes can be found on GitHub but here&#39;s a recap of the most interesting ones: What changed?This major re"><meta property="og:type" content="article"><meta property="og:title" content="Introducing native applications, per-client token lifetimes and client assertions support in OpenIddict 5.0 preview1"><meta property="og:url" content="https://kevinchalet.com/2023/10/20/introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1/index.html"><meta property="og:site_name" content="KÃ©vin Chalet&#39;s blog"><meta property="og:description" content="Earlier today, the first OpenIddict 5.0 preview was pushed to NuGet.org ðŸŽ‰ As always, all the changes can be found on GitHub but here&#39;s a recap of the most interesting ones: What changed?This major re"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2023-10-20T15:30:00.000Z"><meta property="article:modified_time" content="2023-10-20T15:28:39.218Z"><meta property="article:author" content="KÃ©vin Chalet"><meta property="article:tag" content="asp.net core"><meta property="article:tag" content="aspnet-contrib"><meta property="article:tag" content="authentication"><meta property="article:tag" content="jwt"><meta property="article:tag" content="oauth"><meta property="article:tag" content="openid connect"><meta property="article:tag" content="openiddict"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="https://kevinchalet.com/assets/photo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">KÃ©vin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">KÃ©vin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">45 <span>posts</span></div><div class="article-info-block">37 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Introducing native applications, per-client token lifetimes and client assertions support in OpenIddict 5.0 preview1</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2023/10/20/introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1/"><time datetime="2023-10-20T15:30:00.000Z" itemprop="datePublished">2023-10-20</time></a></div><div class="article-category"><i class="fa fa-folder"></i> <a class="article-category-link" href="/categories/development/">Development</a></div></div></header><div class="article-entry" itemprop="articleBody"><p>Earlier today, the first OpenIddict 5.0 preview was pushed to NuGet.org ðŸŽ‰</p><p>As always, all the changes can be found on <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/pulls?q=is:pr+milestone:5.0.0-preview1+is:closed">GitHub</a> but here's a recap of the most interesting ones:</p><h2 id="What-changed"><a href="#What-changed" class="headerlink" title="What changed?"></a>What changed?</h2><div class="note warn"><p>This major release introduces breaking changes that require applying migrations to update the database schema. As such it is not recommended to use it in production or in tandem with an existing deployment using OpenIddict 4.x.</p></div><h3 id="Relaxed-redirect-uri-comparisons-for-native-applications"><a href="#Relaxed-redirect-uri-comparisons-for-native-applications" class="headerlink" title="Relaxed redirect_uri comparisons for native applications"></a>Relaxed <code>redirect_uri</code> comparisons for native applications</h3><p>While the OAuth 2.0 and OpenID Connect specification explicitly mandated the use of the "simple string comparison" logic â€“ put simply, a byte-by-byte comparison â€“ newer specifications like RFC8252 (aka OAuth 2.0 for Native Apps) <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc8252#section-7.3">relaxed this policy for mobile and desktop applications</a> to allow using dynamic ports chosen at runtime.</p><p>While OpenIddict already allowed customizing the comparison policy by overriding <code>OpenIddictApplicationManager.ValidateRedirectUriAsync()</code>, built-in support for native applications was not a thing.</p><p>OpenIddict 5.0 changes that by introducing a new <code>ApplicationType</code> property for the application entity. This property is always set to <code>web</code> by default, but can be explicitly set to <code>native</code> to opt in the relaxed comparison policy that ignores ports for local <code>redirect_uris</code>:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> manager.CreateAsync(<span class="keyword">new</span> OpenIddictApplicationDescriptor</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// Note: the application must be registered as a native application to force OpenIddict</span></span><br><span class="line">    <span class="comment">// to apply a relaxed redirect_uri validation policy that allows specifying a random port.</span></span><br><span class="line">    ApplicationType = ApplicationTypes.Native,</span><br><span class="line">    ClientId = <span class="string">"console"</span>,</span><br><span class="line">    ClientType = ClientTypes.Public,</span><br><span class="line">    ConsentType = ConsentTypes.Systematic,</span><br><span class="line">    DisplayName = <span class="string">"Console client application"</span>,</span><br><span class="line">    RedirectUris =</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Note: the port must not be explicitly specified as it is selected</span></span><br><span class="line">        <span class="comment">// dynamically at runtime by the OpenIddict client system integration.</span></span><br><span class="line">        <span class="keyword">new</span> Uri(<span class="string">"http://localhost/callback/login/local"</span>)</span><br><span class="line">    },</span><br><span class="line">    Permissions =</span><br><span class="line">    {</span><br><span class="line">        Permissions.Endpoints.Authorization,</span><br><span class="line">        Permissions.Endpoints.Device,</span><br><span class="line">        Permissions.Endpoints.Token,</span><br><span class="line">        Permissions.GrantTypes.AuthorizationCode,</span><br><span class="line">        Permissions.GrantTypes.DeviceCode,</span><br><span class="line">        Permissions.GrantTypes.RefreshToken,</span><br><span class="line">        Permissions.ResponseTypes.Code,</span><br><span class="line">        Permissions.Scopes.Email,</span><br><span class="line">        Permissions.Scopes.Profile,</span><br><span class="line">        Permissions.Scopes.Roles,</span><br><span class="line">        Permissions.Prefixes.Scope + <span class="string">"demo_api"</span></span><br><span class="line">    },</span><br><span class="line">    Requirements =</span><br><span class="line">    {</span><br><span class="line">        Requirements.Features.ProofKeyForCodeExchange</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><div class="note info"><p>To avoid ambiguities, the existing <code>OpenIddictApplicationDescriptor.Type</code> property (and the properties of the same name in <code>OpenIddictEntityFrameworkApplication</code>, <code>OpenIddictEntityFrameworkCoreApplication</code> and <code>OpenIddictMongoDbApplication</code>) have been replaced by <code>ClientType</code>.</p><p>Users migrating to 5.0 will be invited to update their database schema to include the new <code>ApplicationType</code> property and the renamed <code>ClientType</code> member.</p></div><h3 id="Per-client-token-lifetimes"><a href="#Per-client-token-lifetimes" class="headerlink" title="Per-client token lifetimes"></a>Per-client token lifetimes</h3><p>OpenIddict already supported overriding the default token lifetimes dynamically using the <code>SetAccessTokenLifetime(...)</code> extension but <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/issues/1354">being able to use a static value per client was a popular request</a>.</p><p>To support that, OpenIddict 5.0 introduces a new <code>Settings</code> property in <code>OpenIddictApplicationDescriptor</code> (and in the EF Core/EF 6/MongoDB entities) and exposes 6 built-in settings that allow controlling the lifetime of access tokens, authorization codes, device codes, identity tokens, refresh tokens and user codes.</p><p>Here's an example that sets a static access token lifetime for a specific client:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> manager.CreateAsync(<span class="keyword">new</span> OpenIddictApplicationDescriptor</span><br><span class="line">{</span><br><span class="line">    ApplicationType = ApplicationTypes.Native,</span><br><span class="line">    ClientId = <span class="string">"postman"</span>,</span><br><span class="line">    ClientType = ClientTypes.Public,</span><br><span class="line">    ConsentType = ConsentTypes.Systematic,</span><br><span class="line">    DisplayName = <span class="string">"Postman"</span>,</span><br><span class="line">    RedirectUris =</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">new</span> Uri(<span class="string">"https://oauth.pstmn.io/v1/callback"</span>)</span><br><span class="line">    },</span><br><span class="line">    Permissions =</span><br><span class="line">    {</span><br><span class="line">        Permissions.Endpoints.Authorization,</span><br><span class="line">        Permissions.Endpoints.Device,</span><br><span class="line">        Permissions.Endpoints.Token,</span><br><span class="line">        Permissions.GrantTypes.AuthorizationCode,</span><br><span class="line">        Permissions.GrantTypes.DeviceCode,</span><br><span class="line">        Permissions.GrantTypes.Password,</span><br><span class="line">        Permissions.GrantTypes.RefreshToken,</span><br><span class="line">        Permissions.ResponseTypes.Code,</span><br><span class="line">        Permissions.Scopes.Email,</span><br><span class="line">        Permissions.Scopes.Profile,</span><br><span class="line">        Permissions.Scopes.Roles</span><br><span class="line">    },</span><br><span class="line">    Settings =</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Use a shorter access token lifetime for tokens issued to the Postman application.</span></span><br><span class="line">        [<span class="meta">Settings.TokenLifetimes.AccessToken</span>] = TimeSpan.FromMinutes(<span class="number">10</span>).ToString(<span class="string">"c"</span>, CultureInfo.InvariantCulture)</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><div class="note tip"><p>Even if a static token lifetime was attached to the client registration, the token lifetime can always be dynamically overridden using the <code>SetAccessTokenLifetime(...)</code> extension.</p></div><h3 id="Client-assertions"><a href="#Client-assertions" class="headerlink" title="Client assertions"></a>Client assertions</h3><p>OpenIddict 4.x already supported client assertions, but only in the client stack (this feature was introduced in 4.0 as it was required for the <strong>Sign in with Apple</strong> integration).</p><p>OpenIddict 5.0 finalizes the implementation of client assertions by updating the server and validation stacks to support <code>private_key_jwt</code> for all the authenticated API endpoints (device authorization, token, introspection and revocation endpoints).</p><p>To use client assertions instead of client secrets, two things must be done:</p><h4 id="Attach-a-JSON-Web-Key-Set-containing-at-least-one-signing-key-to-the-client-registration"><a href="#Attach-a-JSON-Web-Key-Set-containing-at-least-one-signing-key-to-the-client-registration" class="headerlink" title="Attach a JSON Web Key Set containing at least one signing key to the client registration"></a>Attach a JSON Web Key Set containing at least one signing key to the client registration</h4><p>For that, a public key/private key pair must be generated first: the public key will be attached to the application entry and used by the server to validate the client assertions while the private key will be only known by the client and used to dynamically generate new client assertions.</p><p>To generate an ECDSA private/public key pair, use the following snippet:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">var</span> algorithm = ECDsa.Create(ECCurve.NamedCurves.nistP256);</span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">"Public key:"</span>);</span><br><span class="line">Console.WriteLine(algorithm.ExportSubjectPublicKeyInfoPem());</span><br><span class="line"></span><br><span class="line">Console.WriteLine();</span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">"Private key:"</span>);</span><br><span class="line">Console.WriteLine(algorithm.ExportECPrivateKeyPem());</span><br></pre></td></tr></tbody></table></figure><p>Then, attach a <code>JsonWebKeySet</code> instance to <code>OpenIddictApplicationDescriptor.JsonWebKeySet</code>:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> manager.CreateAsync(<span class="keyword">new</span> OpenIddictApplicationDescriptor</span><br><span class="line">{</span><br><span class="line">    ApplicationType = ApplicationTypes.Web,</span><br><span class="line">    ClientId = <span class="string">"mvc"</span>,</span><br><span class="line">    ClientType = ClientTypes.Confidential,</span><br><span class="line">    ConsentType = ConsentTypes.Explicit,</span><br><span class="line">    DisplayName = <span class="string">"MVC client application"</span>,</span><br><span class="line">    JsonWebKeySet = <span class="keyword">new</span> JsonWebKeySet</span><br><span class="line">    {</span><br><span class="line">        Keys =</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// Instead of sending a client secret, this application authenticates by</span></span><br><span class="line">            <span class="comment">// generating client assertions that are signed using an ECDSA signing key.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// Note: while the client needs access to the private key, the server only needs</span></span><br><span class="line">            <span class="comment">// to know the public key to be able to validate the client assertions it receives.</span></span><br><span class="line">            JsonWebKeyConverter.ConvertFromECDsaSecurityKey(GetECDsaSigningKey(<span class="string">$""</span><span class="string">"</span></span><br><span class="line"><span class="string">                -----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">                MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEI23kaVsRRAWIez/pqEZOByJFmlXd</span></span><br><span class="line"><span class="string">                a6iSQ4QqcH23Ir8aYPPX5lsVnBsExNsl7SOYOiIhgTaX6+PTS7yxTnmvSw==</span></span><br><span class="line"><span class="string">                -----END PUBLIC KEY-----</span></span><br><span class="line"><span class="string">                "</span><span class="string">""</span>))</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    RedirectUris =</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">new</span> Uri(<span class="string">"https://localhost:44381/callback/login/local"</span>)</span><br><span class="line">    },</span><br><span class="line">    PostLogoutRedirectUris =</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">new</span> Uri(<span class="string">"https://localhost:44381/callback/logout/local"</span>)</span><br><span class="line">    },</span><br><span class="line">    Permissions =</span><br><span class="line">    {</span><br><span class="line">        Permissions.Endpoints.Authorization,</span><br><span class="line">        Permissions.Endpoints.Logout,</span><br><span class="line">        Permissions.Endpoints.Token,</span><br><span class="line">        Permissions.GrantTypes.AuthorizationCode,</span><br><span class="line">        Permissions.GrantTypes.RefreshToken,</span><br><span class="line">        Permissions.ResponseTypes.Code,</span><br><span class="line">        Permissions.Scopes.Email,</span><br><span class="line">        Permissions.Scopes.Profile,</span><br><span class="line">        Permissions.Scopes.Roles,</span><br><span class="line">        Permissions.Prefixes.Scope + <span class="string">"demo_api"</span></span><br><span class="line">    },</span><br><span class="line">    Requirements =</span><br><span class="line">    {</span><br><span class="line">        Requirements.Features.ProofKeyForCodeExchange</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> ECDsaSecurityKey <span class="title">GetECDsaSigningKey</span>(<span class="params">ReadOnlySpan&lt;<span class="built_in">char</span>&gt; key</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">var</span> algorithm = ECDsa.Create();</span><br><span class="line">    algorithm.ImportFromPem(key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ECDsaSecurityKey(algorithm);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="Attach-the-signing-key-to-the-client-registration-or-the-validation-options"><a href="#Attach-the-signing-key-to-the-client-registration-or-the-validation-options" class="headerlink" title="Attach the signing key to the client registration or the validation options"></a>Attach the signing key to the client registration or the validation options</h4><p>To use client assertions with the OpenIddict client, the private signing key must be attached to the client registration:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">services.AddOpenIddict()</span><br><span class="line">    .AddClient(options =&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add a client registration matching the client application definition in the server project.</span></span><br><span class="line">        options.AddRegistration(<span class="keyword">new</span> OpenIddictClientRegistration</span><br><span class="line">        {</span><br><span class="line">            Issuer = <span class="keyword">new</span> Uri(<span class="string">"https://localhost:44395/"</span>, UriKind.Absolute),</span><br><span class="line">            ProviderName = <span class="string">"Local"</span>,</span><br><span class="line"></span><br><span class="line">            ClientId = <span class="string">"mvc"</span>,</span><br><span class="line">            Scopes = { Scopes.Email, Scopes.Profile, Scopes.OfflineAccess, <span class="string">"demo_api"</span> },</span><br><span class="line"></span><br><span class="line">            RedirectUri = <span class="keyword">new</span> Uri(<span class="string">"callback/login/local"</span>, UriKind.Relative),</span><br><span class="line">            PostLogoutRedirectUri = <span class="keyword">new</span> Uri(<span class="string">"callback/logout/local"</span>, UriKind.Relative),</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Instead of sending a client secret, this application authenticates by</span></span><br><span class="line">            <span class="comment">// generating client assertions that are signed using a private signing key.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// As such, no client secret is set, but an ECDSA key is registered and used by</span></span><br><span class="line">            <span class="comment">// the OpenIddict client to automatically generate client assertions when needed.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// Note: while the server only needs access to the public key, the client needs</span></span><br><span class="line">            <span class="comment">// to know the private key to be able to generate and sign the client assertions.</span></span><br><span class="line">            SigningCredentials =</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">new</span> SigningCredentials(GetECDsaSigningKey(<span class="string">$""</span><span class="string">"</span></span><br><span class="line"><span class="string">                    -----BEGIN EC PRIVATE KEY-----</span></span><br><span class="line"><span class="string">                    MHcCAQEEIMGxf/eMzKuW2F8KKWPJo3bwlrO68rK5+xCeO1atwja2oAoGCCqGSM49</span></span><br><span class="line"><span class="string">                    AwEHoUQDQgAEI23kaVsRRAWIez/pqEZOByJFmlXda6iSQ4QqcH23Ir8aYPPX5lsV</span></span><br><span class="line"><span class="string">                    nBsExNsl7SOYOiIhgTaX6+PTS7yxTnmvSw==</span></span><br><span class="line"><span class="string">                    -----END EC PRIVATE KEY-----</span></span><br><span class="line"><span class="string">                    "</span><span class="string">""</span>), SecurityAlgorithms.EcdsaSha256, SecurityAlgorithms.Sha256)</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> ECDsaSecurityKey <span class="title">GetECDsaSigningKey</span>(<span class="params">ReadOnlySpan&lt;<span class="built_in">char</span>&gt; key</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> algorithm = ECDsa.Create();</span><br><span class="line">            algorithm.ImportFromPem(key);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ECDsaSecurityKey(algorithm);</span><br><span class="line">        }</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure><p>To use client assertions in introspection requests sent by the OpenIddict validation handler, the private signing key must be attached to the options:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">services.AddOpenIddict()</span><br><span class="line">    .AddValidation(options =&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        options.AddSigningKey(GetECDsaSigningKey(<span class="string">$""</span><span class="string">"</span></span><br><span class="line"><span class="string">            -----BEGIN EC PRIVATE KEY-----</span></span><br><span class="line"><span class="string">            MHcCAQEEIMGxf/eMzKuW2F8KKWPJo3bwlrO68rK5+xCeO1atwja2oAoGCCqGSM49</span></span><br><span class="line"><span class="string">            AwEHoUQDQgAEI23kaVsRRAWIez/pqEZOByJFmlXda6iSQ4QqcH23Ir8aYPPX5lsV</span></span><br><span class="line"><span class="string">            nBsExNsl7SOYOiIhgTaX6+PTS7yxTnmvSw==</span></span><br><span class="line"><span class="string">            -----END EC PRIVATE KEY-----</span></span><br><span class="line"><span class="string">            "</span><span class="string">""</span>));</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> ECDsaSecurityKey <span class="title">GetECDsaSigningKey</span>(<span class="params">ReadOnlySpan&lt;<span class="built_in">char</span>&gt; key</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> algorithm = ECDsa.Create();</span><br><span class="line">            algorithm.ImportFromPem(key);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ECDsaSecurityKey(algorithm);</span><br><span class="line">        }</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure><div class="note tip"><p>Both a client secret and one or more signing keys can be assigned to a client application: in this case, the client will be able to use both authentication methods. To force a client application to use client assertions, you can remove its client secret.</p></div><div class="note info"><p>The less secure <code>client_secret_jwt</code> is deliberately not supported, as OpenIddict always "hashes" the client secret using PBKDF before storing it in the database: once a client is created, OpenIddict no longer has access to the original client secret and thus cannot use it to determine whether a JWT client assertion was signed using the correct client secret or not.</p></div><h2 id="What-39-s-next"><a href="#What-39-s-next" class="headerlink" title="What's next?"></a>What's next?</h2><p>OpenIddict 5.0 RTM is expected to ship mid-December. Until then, it's likely additional previews will be released to gather precious feedback from the community ðŸ˜€</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2023/10/20/introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1/" data-id="clnyrn7oj00bmjgi171oxgbwo" class="article-share-link">Share</a> <a href="/2023/10/20/introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li></ul></footer></div><nav id="article-nav"><a href="/2023/10/04/can-you-use-the-asp-net-core-identity-api-endpoints-with-openiddict/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Can you use the ASP.NET Core Identity API endpoints with OpenIddict?</div></a></nav></article><section id="comments"><div id="giscus_discussion"><script src="https://giscus.app/client.js" data-repo="kevinchalet/kevinchalet.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk2MTE2NjMwMw==" data-category="General" data-category-id="DIC_kwDOA6VS384CQu8O" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2023/10/20/introducing-native-applications-per-client-token-lifetimes-and-client-assertions-support-in-openiddict-5-0-preview1/" class="title">Introducing native applications, per-client token lifetimes and client assertions support in OpenIddict 5.0 preview1</a></p><p class="item-date"><time datetime="2023-10-20T15:30:00.000Z" itemprop="datePublished">2023-10-20</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/10/04/can-you-use-the-asp-net-core-identity-api-endpoints-with-openiddict/" class="title">Can you use the ASP.NET Core Identity API endpoints with OpenIddict?</a></p><p class="item-date"><time datetime="2023-10-04T11:00:00.000Z" itemprop="datePublished">2023-10-04</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/07/05/connecting-windows-media-center-to-tvheadend-with-hdhrproxyiptv-an-alternative-to-dvblink/" class="title">Connecting Windows Media Center to Tvheadend with HDHRProxyIPTV: an alternative to DVBLink</a></p><p class="item-date"><time datetime="2023-07-05T18:00:00.000Z" itemprop="datePublished">2023-07-05</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2023/02/27/introducing-system-integration-support-for-the-openiddict-client/" class="title">Introducing system integration support for the OpenIddict client</a></p><p class="item-date"><time datetime="2023-02-27T16:00:00.000Z" itemprop="datePublished">2023-02-27</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/23/openiddict-4-0-general-availability/" class="title">OpenIddict 4.0 general availability</a></p><p class="item-date"><time datetime="2022-12-23T20:00:00.000Z" itemprop="datePublished">2022-12-23</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">34</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">38</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dvblink/" rel="tag">dvblink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhomerun/" rel="tag">hdhomerun</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdhrproxytv/" rel="tag">hdhrproxytv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/identity/" rel="tag">identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">38</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">37</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tv/" rel="tag">tv</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tvheadend/" rel="tag">tvheadend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2023 KÃ©vin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>