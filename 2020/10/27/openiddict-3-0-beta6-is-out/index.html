<!DOCTYPE html><html><head><meta charset="utf-8"><title>OpenIddict 3.0 beta6 is out | Kévin Chalet&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="In this post, learn more about the changes introduced in OpenIddict 3.0 beta6."><meta property="og:type" content="article"><meta property="og:title" content="OpenIddict 3.0 beta6 is out"><meta property="og:url" content="https://kevinchalet.com/2020/10/27/openiddict-3-0-beta6-is-out/index.html"><meta property="og:site_name" content="Kévin Chalet&#39;s blog"><meta property="og:description" content="In this post, learn more about the changes introduced in OpenIddict 3.0 beta6."><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2020-10-27T19:00:00.000Z"><meta property="article:modified_time" content="2020-11-02T16:27:40.000Z"><meta property="article:author" content="Kévin Chalet"><meta property="article:tag" content="authentication"><meta property="article:tag" content="jwt"><meta property="article:tag" content="oauth"><meta property="article:tag" content="openid connect"><meta property="article:tag" content="openiddict"><meta property="article:tag" content="owin"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@kevin_chalet"><link rel="icon" href="https://kevinchalet.com/assets/photo.png"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-79360312-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 6.2.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style></head><body><div id="container"><header id="header"><div id="header-main" class="header-inner"><div class="outer"><a href="/" id="logo"><span class="site-title">Kévin Chalet&#39;s blog</span></a><nav id="main-nav"><a class="main-nav-link" href="/.">Home</a> <a class="main-nav-link" href="/archives/">Archives</a></nav><nav id="sub-nav"><div class="profile" id="profile-nav"><a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://kevinchalet.com/assets/photo.png"><i class="fa fa-caret-down"></i></a></div></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://kevinchalet.com"></form></div></div></div></header><div class="outer"><aside id="profile"><div class="inner profile-inner"><div class="base-info profile-block"><img id="avatar" src="https://kevinchalet.com/assets/photo.png"><h2 id="name">Kévin Chalet</h2><h3 id="title">.NET-holic and OpenID-addict MVP in the wild.</h3><span id="location"><i class="fa fa-map-marker"></i>France</span> <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/intent/user?screen_name=kevin_chalet"><i class="fa fa-twitter fa-lg"></i> Follow me on Twitter</a></div><div class="article-info profile-block"><div class="article-info-block">42 <span>posts</span></div><div class="article-info-block">31 <span>tags</span></div></div><div class="contact-info profile-block"><table class="contact-list"><tr><td><a href="mailto:contact@kevinchalet.com" title="Email"><i class="fa fa-envelope"></i></a></td><td><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kevinchalet/" title="LinkedIn"><i class="fa fa-linkedin"></i></a></td><td><a target="_blank" rel="noopener" href="https://github.com/kevinchalet" title="GitHub"><i class="fa fa-github"></i></a></td><td><a target="_blank" rel="noopener" href="https://twitter.com/kevin_chalet" title="Twitter"><i class="fa fa-twitter"></i></a></td><td><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/542757/k%c3%a9vin-chalet" title="StackOverflow"><i class="fa fa-stack-overflow"></i></a></td><td><a target="_blank" rel="noopener" href="https://mvp.microsoft.com/fr-fr/PublicProfile/5001682" title="Microsoft MVP"><i class="fa fa-windows"></i></a></td><td><a href="/atom.xml" title="RSS"><i class="fa fa-rss"></i></a></td></tr></table></div></div></aside><section id="main"><article id="post-openiddict-3-0-beta6-is-out" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">OpenIddict 3.0 beta6 is out</h1><div class="article-meta"><div class="article-date"><i class="fa fa-calendar"></i> <a href="/2020/10/27/openiddict-3-0-beta6-is-out/"><time datetime="2020-10-27T19:00:00.000Z" itemprop="datePublished">2020-10-27</time></a></div></div></header><div class="article-entry" itemprop="articleBody"><h2 id="What-changed"><a href="#What-changed" class="headerlink" title="What changed?"></a>What changed?</h2><p>All the changes introduced in this release can be found <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/issues?q=milestone:3.0.0-beta6">on GitHub</a>, but here's a recap of the most important ones:</p><h3 id="OpenIddict-now-supports-response-type-permissions"><a href="#OpenIddict-now-supports-response-type-permissions" class="headerlink" title="OpenIddict now supports response type permissions"></a>OpenIddict now supports response type permissions</h3><p>In previous versions, the <code>response_type</code> values an application was allowed to use were always inferred from the grant types. For instance, if a client was granted the <code>authorization_code</code> grant type permission, it was automatically allowed to use <code>response_type=code</code> (that corresponds to the "pure" authorization code). If it was granted the <code>implicit</code> permission, it was also allowed to use <code>response_type=id_token</code> and depending on its type (confidential or public), <code>response_type=id_token token</code> and <code>response_type=token</code>.</p><p>While convenient, this approach lacked granularity. In OpenIddict 3.0 beta6, this mechanism is replaced by explicit response type permissions. Response type permissions are granted exactly the same way as the other permissions:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> manager.CreateAsync(<span class="keyword">new</span> OpenIddictApplicationDescriptor</span><br><span class="line">{</span><br><span class="line">    ClientId = <span class="string">"mvc"</span>,</span><br><span class="line">    ClientSecret = <span class="string">"901564A5-E7FE-42CB-B10D-61EF6A8F3654"</span>,</span><br><span class="line">    ConsentType = ConsentTypes.Explicit,</span><br><span class="line">    DisplayName = <span class="string">"MVC client application"</span>,</span><br><span class="line">    DisplayNames =</span><br><span class="line">    {</span><br><span class="line">        [<span class="meta">CultureInfo.GetCultureInfo(<span class="string">"fr-FR"</span>)</span>] = <span class="string">"Application cliente MVC"</span></span><br><span class="line">    },</span><br><span class="line">    PostLogoutRedirectUris =</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">new</span> Uri(<span class="string">"https://localhost:44381/signout-callback-oidc"</span>)</span><br><span class="line">    },</span><br><span class="line">    RedirectUris =</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">new</span> Uri(<span class="string">"https://localhost:44381/signin-oidc"</span>)</span><br><span class="line">    },</span><br><span class="line">    Permissions =</span><br><span class="line">    {</span><br><span class="line">        Permissions.Endpoints.Authorization,</span><br><span class="line">        Permissions.Endpoints.Logout,</span><br><span class="line">        Permissions.Endpoints.Token,</span><br><span class="line">        Permissions.GrantTypes.AuthorizationCode,</span><br><span class="line">        Permissions.GrantTypes.RefreshToken,</span><br><span class="line">        Permissions.ResponseTypes.Code, <span class="comment">// New permission</span></span><br><span class="line">        Permissions.Scopes.Email,</span><br><span class="line">        Permissions.Scopes.Profile,</span><br><span class="line">        Permissions.Scopes.Roles,</span><br><span class="line">        Permissions.Prefixes.Scope + <span class="string">"demo_api"</span></span><br><span class="line">    },</span><br><span class="line">    Requirements =</span><br><span class="line">    {</span><br><span class="line">        Requirements.Features.ProofKeyForCodeExchange</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p>Introducing response type permissions was also a good opportunity for removing the OpenIddict-specific <code>hybrid</code> client type, that was used by confidential clients that also wanted to retrieve an access token directly from the authorization endpoint. In beta6, the <code>hybrid</code> type is no longer supported and must be replaced by explicit <code>Permissions.ResponseTypes.CodeIdTokenToken</code> or <code>Permissions.ResponseTypes.CodeToken</code> permissions.</p><span id="more"></span><p>Users who have many clients to migrate can use this script to infer the "best" response type permissions based on the already allowed grant types:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> OpenIddict.Abstractions;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">static</span> OpenIddict.Abstractions.OpenIddictConstants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MigrationScript</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    {</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">var</span> services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line"></span><br><span class="line">            services.AddOpenIddict()</span><br><span class="line">                .AddCore(options =&gt;</span><br><span class="line">                {</span><br><span class="line">                    options.UseEntityFrameworkCore()</span><br><span class="line">                           .UseDbContext&lt;DbContext&gt;();</span><br><span class="line">                });</span><br><span class="line"></span><br><span class="line">            services.AddDbContext&lt;DbContext&gt;(options =&gt;</span><br><span class="line">            {</span><br><span class="line">                options.UseSqlServer(<span class="string">"Server=(localdb)\\mssqllocaldb;Database=aspnet5-openiddict-sample-12340be6-0442-4622-b782-a7412bb7d045;Trusted_Connection=True;MultipleActiveResultSets=true"</span>);</span><br><span class="line">                options.UseOpenIddict();</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> <span class="keyword">var</span> provider = services.BuildServiceProvider();</span><br><span class="line">            <span class="keyword">using</span> <span class="keyword">var</span> scope = provider.CreateScope();</span><br><span class="line">            <span class="keyword">var</span> manager = scope.ServiceProvider.GetRequiredService&lt;IOpenIddictApplicationManager&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="function"><span class="keyword">var</span> application <span class="keyword">in</span> <span class="keyword">await</span> <span class="title">GetApplicationsAsync</span>(<span class="params">manager</span>))</span></span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// Ignore applications that already have at least one response type permission.</span></span><br><span class="line">                <span class="keyword">var</span> permissions = <span class="keyword">new</span> HashSet&lt;<span class="built_in">string</span>&gt;(<span class="keyword">await</span> manager.GetPermissionsAsync(application), StringComparer.Ordinal);</span><br><span class="line">                <span class="keyword">if</span> (permissions.Any(permission =&gt; permission.StartsWith(Permissions.Prefixes.ResponseType)))</span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="comment">// If a application was granted the authorization code grant permission, allow it to use the code response type.</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">await</span> manager.HasPermissionAsync(application, Permissions.GrantTypes.AuthorizationCode))</span><br><span class="line">                {</span><br><span class="line">                    permissions.Add(Permissions.ResponseTypes.Code);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">await</span> manager.HasPermissionAsync(application, Permissions.GrantTypes.Implicit))</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// Allow all applications that were granted the implicit</span></span><br><span class="line">                    <span class="comment">// grant permission to use the "id_token" response types.</span></span><br><span class="line">                    permissions.Add(Permissions.ResponseTypes.IdToken);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Applications that were also granted the code grant type permission</span></span><br><span class="line">                    <span class="comment">// are allowed to use the "code id_token" response type permission.</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">await</span> manager.HasPermissionAsync(application, Permissions.GrantTypes.AuthorizationCode))</span><br><span class="line">                    {</span><br><span class="line">                        permissions.Add(Permissions.ResponseTypes.CodeIdToken);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Allow public and hybrid clients to retrieve an access token directly from the</span></span><br><span class="line">                    <span class="comment">// authorization endpoint by granting them the "id_token token" and "token" permissions.</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">await</span> manager.HasClientTypeAsync(application, ClientTypes.Public) ||</span><br><span class="line">                        <span class="keyword">await</span> manager.HasClientTypeAsync(application, <span class="string">"hybrid"</span>))</span><br><span class="line">                    {</span><br><span class="line">                        permissions.Add(Permissions.ResponseTypes.IdTokenToken);</span><br><span class="line">                        permissions.Add(Permissions.ResponseTypes.Token);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Hybrid applications that were also granted the code grant type permission</span></span><br><span class="line">                    <span class="comment">// are allowed to use the "code id_token token" and "code token" types.</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">await</span> manager.HasClientTypeAsync(application, <span class="string">"hybrid"</span>) &amp;&amp;</span><br><span class="line">                        <span class="keyword">await</span> manager.HasPermissionAsync(application, Permissions.GrantTypes.AuthorizationCode))</span><br><span class="line">                    {</span><br><span class="line">                        permissions.Add(Permissions.ResponseTypes.CodeIdTokenToken);</span><br><span class="line">                        permissions.Add(Permissions.ResponseTypes.CodeToken);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> descriptor = <span class="keyword">new</span> OpenIddictApplicationDescriptor();</span><br><span class="line">                <span class="keyword">await</span> manager.PopulateAsync(descriptor, application);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// If the application is an hybrid client, replace it by a confidential client.</span></span><br><span class="line">                <span class="comment">// Hybrid client types were removed in OpenIddict 3.0 beta6 and replaced by</span></span><br><span class="line">                <span class="comment">// response type permissions, that allow defining whether a confidential client</span></span><br><span class="line">                <span class="comment">// is allowed to retrieved an access token from the authorization endpoint</span></span><br><span class="line">                <span class="comment">// (i.e without having to send its client credentials to retrieve an access token).</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">await</span> manager.HasClientTypeAsync(application, <span class="string">"hybrid"</span>))</span><br><span class="line">                {</span><br><span class="line">                    descriptor.Type = ClientTypes.Confidential;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Replace the permissions on the descriptor.</span></span><br><span class="line">                descriptor.Permissions.Clear();</span><br><span class="line">                descriptor.Permissions.UnionWith(permissions);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Update the application.</span></span><br><span class="line">                <span class="keyword">await</span> manager.PopulateAsync(application, descriptor);</span><br><span class="line">                <span class="keyword">await</span> manager.UpdateAsync(application);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;List&lt;<span class="built_in">object</span>&gt;&gt; GetApplicationsAsync(IOpenIddictApplicationManager manager)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">var</span> applications = <span class="keyword">new</span> List&lt;<span class="built_in">object</span>&gt;();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">await</span> <span class="keyword">foreach</span> (<span class="keyword">var</span> application <span class="keyword">in</span> manager.ListAsync())</span><br><span class="line">                {</span><br><span class="line">                    applications.Add(application);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> applications;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="The-hybrid-flow-is-no-longer-enabled-when-enabling-both-the-authorization-code-and-implicit-flows"><a href="#The-hybrid-flow-is-no-longer-enabled-when-enabling-both-the-authorization-code-and-implicit-flows" class="headerlink" title="The hybrid flow is no longer enabled when enabling both the authorization code and implicit flows"></a>The hybrid flow is no longer enabled when enabling both the authorization code and implicit flows</h3><p>In previous versions, the hybrid flow was automatically enabled when enabling both the authorization code and implicit flows. In beta6, it now must be enabled explicitly, like the other flows:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">services.AddOpenIddict()</span><br><span class="line">    .AddServer(options =&gt;</span><br><span class="line">    {</span><br><span class="line">        options.AllowHybridFlow();</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure><h3 id="Rolling-refresh-tokens-are-now-enabled-by-default-and-allow-for-a-configurable-leeway"><a href="#Rolling-refresh-tokens-are-now-enabled-by-default-and-allow-for-a-configurable-leeway" class="headerlink" title="Rolling refresh tokens are now enabled by default and allow for a configurable leeway"></a>Rolling refresh tokens are now enabled by default and allow for a configurable leeway</h3><p>In 3.0 beta6, refresh tokens were revamped and the following changes were made:</p><ul><li><p>The rolling refresh tokens mechanism now allows for a small leeway to avoid revoking entire token chains when concurrent requests are received (by default, it is set to 15 seconds but can be changed using <code>OpenIddictServerBuilder.SetRefreshTokenReuseLeeway()</code>).</p></li><li><p>The rolling refresh tokens mechanism no longer revokes previously issued tokens, it just marks refresh tokens as redeemed when they are used.</p></li><li><p>Rolling refresh tokens are now enabled by default to make OpenIddict compliant with <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/draft-ietf-oauth-security-topics-16#section-4.13.2">the OAuth 2.0 best current practices, that require implementing either rotation or sender-constrained tokens</a>. Developers who prefer disabling rolling refresh tokens can do so by calling <code>OpenIddictServerBuilder.DisableRollingRefreshTokens()</code>.</p></li><li><p>The refresh token lifetime extension mechanism was removed: even when rolling refresh tokens are disabled, a new refresh token will now be generated and returned for each refresh token request, which guarantees that the client application always gets a refresh tokens (and subsequent access tokens) containing the latest claims.</p></li></ul><h3 id="The-EF-Core-and-EF-6-entities-now-use-DateTime-instead-of-DateTimeOffset"><a href="#The-EF-Core-and-EF-6-entities-now-use-DateTime-instead-of-DateTimeOffset" class="headerlink" title="The EF Core and EF 6 entities now use DateTime instead of DateTimeOffset"></a>The EF Core and EF 6 entities now use <code>DateTime</code> instead of <code>DateTimeOffset</code></h3><p>Due to incomplete support in the Oracle MySQL and Npgsql Entity Framework providers, <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/issues/1115">the EF Core and EF 6 entities no longer use <code>DateTimeOffset</code></a>. Developers migrating to OpenIddict 3.0 beta6 will need to add a migration to move from <code>DateTimeOffset</code> to <code>DateTime</code>.</p><h3 id="Proof-Key-for-Code-Exchange-PKCE-can-now-be-enforced-globally"><a href="#Proof-Key-for-Code-Exchange-PKCE-can-now-be-enforced-globally" class="headerlink" title="Proof Key for Code Exchange (PKCE) can now be enforced globally"></a>Proof Key for Code Exchange (PKCE) can now be enforced globally</h3><p>Previous versions of OpenIddict 3.0 already allowed making PKCE mandatory per-client, but in beta6, there's now a global option:</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">services.AddOpenIddict()</span><br><span class="line">    .AddServer(options =&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Force all client applications to use Proof Key for Code Exchange (PKCE).</span></span><br><span class="line">        options.RequireProofKeyForCodeExchange();</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure><h3 id="Tokens-no-longer-contain-a-jti-claim"><a href="#Tokens-no-longer-contain-a-jti-claim" class="headerlink" title="Tokens no longer contain a jti claim"></a>Tokens no longer contain a <code>jti</code> claim</h3><p>To make tokens lighter, a <code>jti</code> claim is no longer generated and persisted in the tokens generated by OpenIddict 3.0 beta6.</p><p>Special thanks to <a target="_blank" rel="noopener" href="https://github.com/johanndev">Johann Wimmer</a> <a target="_blank" rel="noopener" href="https://github.com/openiddict/openiddict-core/pull/1116">for his great contribution</a> to the tests projects, that are now compiled with nullable reference types enabled!</p></div><footer class="article-footer"><a data-url="https://kevinchalet.com/2020/10/27/openiddict-3-0-beta6-is-out/" data-id="clj0c62cp002jmki2adz18g5a" class="article-share-link">Share</a> <a href="/2020/10/27/openiddict-3-0-beta6-is-out/#giscus_discussion" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/authentication/" rel="tag">authentication</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/owin/" rel="tag">owin</a></li></ul></footer></div><nav id="article-nav"><a href="/2020/11/17/introducing-openiddict-3-0-s-first-release-candidate-version/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">Introducing OpenIddict 3.0&#39;s first release candidate version</div></a><a href="/2020/10/03/using-the-orchardcore-openid-management-feature-with-an-existing-openiddict-deployment/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Using the OrchardCore OpenID management feature with an existing OpenIddict deployment</div></a></nav></article><section id="comments"><div id="giscus_discussion"><script src="https://giscus.app/client.js" data-repo="kevinchalet/kevinchalet.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk2MTE2NjMwMw==" data-category="General" data-category-id="DIC_kwDOA6VS384CQu8O" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">recents</h3><div class="widget"><ul id="recent-post" class="no-thumbnail"><li><div class="item-inner"><p class="item-title"><a href="/2023/02/27/introducing-system-integration-support-for-the-openiddict-client/" class="title">Introducing system integration support for the OpenIddict client</a></p><p class="item-date"><time datetime="2023-02-27T16:00:00.000Z" itemprop="datePublished">2023-02-27</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/23/openiddict-4-0-general-availability/" class="title">OpenIddict 4.0 general availability</a></p><p class="item-date"><time datetime="2022-12-23T20:00:00.000Z" itemprop="datePublished">2022-12-23</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/12/16/getting-started-with-the-openiddict-web-providers/" class="title">Getting started with the OpenIddict web providers</a></p><p class="item-date"><time datetime="2022-12-16T15:00:00.000Z" itemprop="datePublished">2022-12-16</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/06/22/openiddict-4-0-preview1-is-out/" class="title">OpenIddict 4.0 preview1 is out</a></p><p class="item-date"><time datetime="2022-06-22T18:00:00.000Z" itemprop="datePublished">2022-06-22</time></p></div></li><li><div class="item-inner"><p class="item-title"><a href="/2022/02/25/introducing-the-openiddict-client/" class="title">Introducing the OpenIddict client</a></p><p class="item-date"><time datetime="2022-02-25T21:00:00.000Z" itemprop="datePublished">2022-02-25</time></p></div></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/development/">Development</a><span class="category-list-count">31</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/general/">General</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/" rel="tag">.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net/" rel="tag">asp.net</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core/" rel="tag">asp.net core</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asp-net-core-identity/" rel="tag">asp.net core identity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnet-contrib/" rel="tag">aspnet-contrib</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth0/" rel="tag">auth0</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authentication/" rel="tag">authentication</a><span class="tag-list-count">36</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure/" rel="tag">azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azure-ad/" rel="tag">azure ad</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/" rel="tag">cms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/component-object-model/" rel="tag">component object model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a><span class="tag-list-count">36</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okta/" rel="tag">okta</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid/" rel="tag">openid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openid-connect/" rel="tag">openid connect</a><span class="tag-list-count">35</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openiddict/" rel="tag">openiddict</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchard/" rel="tag">orchard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orchardcore/" rel="tag">orchardcore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owin/" rel="tag">owin</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/razor/" rel="tag">razor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tls/" rel="tag">tls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwp/" rel="tag">uwp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/" rel="tag">vulnerability</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-authentication-broker/" rel="tag">web authentication broker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-providers/" rel="tag">web providers</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-10/" rel="tag">windows 10</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows-media-center/" rel="tag">windows media center</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">9</span></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2016 - 2023 Kévin Chalet<br>Proudly powered by <a href="http://hexo.io/" target="_blank">Hexo</a> with <a href="http://github.com/ppoffice" target="_blank">Ruipeng Zhang</a>'s <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus theme</a> and <a href="https://www.flickr.com/photos/madison_slater/" target="_blank">Madison Slater</a>'s <a href="https://www.flickr.com/photos/madison_slater/11299339856/" target="_blank">photos</a>.</div></div></footer><script src="/js/jquery.js"></script><script src="/js/script.js"></script></div></body></html>